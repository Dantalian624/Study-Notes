## ä¸€æœŸä¸Š



### åšé¡¹ç›®çš„æµç¨‹

1. é¡¹ç›®ä»‹ç»ã€é¡¹ç›®è°ƒç ”ã€éœ€æ±‚åˆ†æ

2. æ ¸å¿ƒä¸šåŠ¡æµç¨‹

3. é¡¹ç›®è¦åšçš„åŠŸèƒ½ï¼ˆåŠŸèƒ½æ¨¡å—ï¼‰

4. æŠ€æœ¯é€‰å‹ï¼ˆæŠ€æœ¯é¢„ç ”ï¼‰

5. é¡¹ç›®åˆå§‹åŒ–

6. é¡¹ç›®å¼€å‘

7. æµ‹è¯•

8. ä¼˜åŒ–

9. ä»£ç æäº¤ã€ä»£ç å®¡æ ¸

10. äº§å“éªŒæ”¶

11. ä¸Šçº¿



å†™æ–‡æ¡£ã€æŒç»­è°ƒç ”ã€æŒç»­è®°å½•æ€»ç»“



### ç°æœ‰ç³»ç»Ÿè°ƒç ”

[HimitZH/HOJ: âš¡ğŸ”¥Hcode Online Judge(HOJ)ğŸ”¥âš¡ï¼šåŸºäºSpringCloudä¸Vueå‰åç«¯åˆ†ç¦»ï¼Œåˆ†å¸ƒå¼æ¶æ„çš„åœ¨çº¿æµ‹è¯„å¹³å°OJ (An open source online judge system base on SpringBoot, Springcloud Alibaba and Vue.js !) (github.com)](https://github.com/HimitZH/HOJ)



### OJç³»ç»Ÿçš„å¸¸ç”¨æ¦‚å¿µ

acè¡¨ç¤ºä½ çš„é¢˜ç›®é€šè¿‡ï¼Œç»“æœæ­£ç¡®

é¢˜ç›®é™åˆ¶ï¼šæ—¶é—´é™åˆ¶ã€å†…å­˜é™åˆ¶

é¢˜ç›®ä»‹ç»

é¢˜ç›®è¾“å…¥

é¢˜ç›®è¾“å‡º

é¢˜ç›®è¾“å…¥ç”¨ä¾‹

é¢˜ç›®è¾“å‡ºç”¨ä¾‹

 

æ™®é€šæµ‹è¯„ï¼šç®¡ç†å‘˜è®¾ç½®é¢˜ç›®çš„è¾“å…¥å’Œè¾“å‡ºç”¨ä¾‹ï¼Œæ¯”å¦‚æˆ‘è¾“å…¥1ï¼Œä½ è¦è¾“å‡º2æ‰æ˜¯æ­£ç¡®çš„ï¼›äº¤ç»™åˆ¤é¢˜æœºå»æ‰§è¡Œç”¨æˆ·çš„ä»£ç ï¼Œç»™ç”¨æˆ·çš„ä»£ç è¾“å…¥ç”¨ä¾‹ï¼Œæ¯”å¦‚1ï¼Œçœ‹ç”¨æˆ·ç¨‹åºçš„æ‰§è¡Œç»“æœæ˜¯å¦å’Œæ ‡å‡†ç­”æ¡ˆçš„è¾“å‡ºä¸€è‡´ã€‚ï¼ˆæ¯”å¯¹ç”¨ä¾‹æ–‡ä»¶ï¼‰

ç‰¹æ®Šæµ‹è¯„ï¼ˆSPJï¼‰ï¼šç®¡ç†å‘˜è®¾ç½®é¢˜ç›®çš„è¾“å…¥å’Œè¾“å‡ºç”¨ä¾‹ï¼Œæ¯”å¦‚æˆ‘è¾“å…¥1ï¼Œç”¨æˆ·çš„ç­”æ¡ˆåªè¦æ˜¯ >0 æˆ– <2 éƒ½æ˜¯æ­£ç¡®çš„ï¼›ç‰¹åˆ¤ç¨‹åºï¼Œä¸æ˜¯é€šè¿‡å¯¹æ¯”ç”¨ä¾‹æ–‡ä»¶æ˜¯å¦ä¸€è‡´è¿™ç§æ­»æ¿çš„ç¨‹åºæ¥æ£€éªŒï¼Œè€Œæ˜¯è¦ä¸“é—¨æ ¹æ®è¿™é“é¢˜ç›®å†™ä¸€ä¸ªç‰¹æ®Šçš„åˆ¤æ–­ç¨‹åºï¼Œç¨‹åºæ¥æ”¶é¢˜ç›®çš„è¾“å…¥ï¼ˆ1ï¼‰ã€æ ‡å‡†è¾“å‡ºç”¨ä¾‹ï¼ˆ2ï¼‰ã€ç”¨æˆ·çš„ç»“æœï¼ˆ1.5ï¼‰ï¼Œç‰¹åˆ¤ç¨‹åºæ ¹æ®è¿™äº›å€¼æ¥æ¯”è¾ƒæ˜¯å¦æ­£ç¡®ã€‚

äº¤äº’æµ‹è¯„ï¼šè®©ç”¨æˆ·è¾“å…¥ä¸€ä¸ªä¾‹å­ï¼Œå°±ç»™å‡ºä¸€ä¸ªè¾“å‡ºç»“æœï¼Œäº¤äº’æ¯”è¾ƒçµæ´»ï¼Œæ²¡åŠæ³•é€šè¿‡ç®€å•çš„ã€æ­»æ¿çš„è¾“å…¥è¾“å‡ºæ–‡ä»¶æ¥ç¡®å®šã€‚

 

ä¸èƒ½è®©ç”¨æˆ·éšä¾¿å¼•å…¥åŒ…ã€éšä¾¿éå†ã€æš´åŠ›ç ´è§£ï¼Œéœ€è¦ä½¿ç”¨æ­£ç¡®çš„ç®—æ³• --> å®‰å…¨æ€§

åˆ¤æ–­è¿‡ç¨‹æ˜¯å¼‚æ­¥çš„ --> å¼‚æ­¥åŒ–

æäº¤ä¹‹åä¼šç”Ÿæˆä¸€ä¸ªæäº¤è®°å½•ï¼Œæœ‰è¿è¡Œçš„ç»“æœä»¥åŠè¿è¡Œä¿¡æ¯ï¼ˆæ—¶é—´é™åˆ¶ã€å†…å­˜é™åˆ¶ï¼‰



### åŠŸèƒ½

1. é¢˜ç›®æµè§ˆ
   1. åˆ›å»ºé¢˜ç›®ï¼ˆç®¡ç†å‘˜ï¼‰
   2. åˆ é™¤é¢˜ç›®ï¼ˆç®¡ç†å‘˜ï¼‰
   3. ä¿®æ”¹é¢˜ç›®ï¼ˆç®¡ç†å‘˜ï¼‰
   4. æœç´¢é¢˜ç›®ï¼ˆç”¨æˆ·ï¼‰
   5. åœ¨çº¿åšé¢˜ï¼ˆç”¨æˆ·ï¼‰
   6. æäº¤é¢˜ç›®ä»£ç ï¼ˆç”¨æˆ·ï¼‰
2. ç”¨æˆ·æ¨¡å—
   1. æ³¨å†Œ
   2. ç™»å½•
3. åˆ¤é¢˜æ¨¡å—
   1. æäº¤åˆ¤é¢˜ï¼ˆç»“æœæ˜¯å¦æ­£ç¡®ä¸é”™è¯¯ï¼‰
   2. é”™è¯¯å¤„ç†ï¼ˆå†…å­˜æº¢å‡ºã€å®‰å…¨æ€§ã€è¶…æ—¶ï¼‰
   3. è‡ªä¸»å®ç° ä»£ç æ²™ç®±ï¼ˆå®‰å…¨æ²™ç®±ï¼‰
   4. å¼€æ”¾æ¥å£ï¼ˆæä¾›ä¸€ä¸ªç‹¬ç«‹çš„æ–°æœåŠ¡ï¼‰



### é¡¹ç›®æ‹“å±•æ€è·¯

1. æ”¯æŒå¤šç§è¯­è¨€
2. Remote Judge
3. å®Œå–„çš„è¯„æµ‹åŠŸèƒ½ï¼šæ™®é€šæµ‹è¯„ã€ç‰¹æ®Šæµ‹è¯„ã€äº¤äº’æµ‹è¯„ã€åœ¨çº¿è‡ªæµ‹ã€å­ä»»åŠ¡åˆ†ç»„è¯„æµ‹ã€æ–‡ä»¶IO



### æŠ€æœ¯é€‰å‹

å‰ç«¯ï¼šVue3ã€Arco Designç»„ä»¶åº“ã€æ‰‹æ’¸é¡¹ç›®æ¨¡æ¿ã€åœ¨çº¿ä»£ç ç¼–è¾‘å™¨ã€åœ¨çº¿æ–‡æ¡£æµè§ˆ

Javaè¿›ç¨‹æ§åˆ¶ã€Javaå®‰å…¨ç®¡ç†å™¨ã€éƒ¨åˆ†JVMçŸ¥è¯†ç‚¹

è™šæ‹Ÿæœºï¼ˆäº‘æœåŠ¡å™¨ï¼‰ã€Dockerï¼ˆä»£ç æ²™ç®±å®ç°ï¼‰

Spring Cloudå¾®æœåŠ¡ã€æ¶ˆæ¯é˜Ÿåˆ—



### å®ç°æ ¸å¿ƒ

ï¼ˆ1ï¼‰æƒé™æ ¡éªŒ

è°èƒ½æä»£ç ï¼Œè°ä¸èƒ½æä»£ç 

 

ï¼ˆ2ï¼‰ä»£ç æ²™ç®±

ç”¨æˆ·ä»£ç è—æ¯’ï¼šå†™ä¸ªæœ¨é©¬æ–‡ä»¶ã€ä¿®æ”¹ç³»ç»Ÿæƒé™

æ²™ç®±ï¼šéš”ç¦»çš„ã€å®‰å…¨çš„ç¯å¢ƒï¼Œç”¨æˆ·çš„ä»£ç ä¸ä¼šå½±å“åˆ°æ²™ç®±ä¹‹å¤–çš„ç³»ç»Ÿçš„è¿è¡Œ

èµ„æºåˆ†é…ï¼šç³»ç»Ÿå†…å­˜å°±2Gï¼Œç”¨æˆ·ç–¯ç‹‚å ç”¨èµ„æºå æ»¡ä½ çš„å†…å­˜ï¼Œå…¶ä»–äººå°±ç”¨ä¸äº†äº†ï¼Œæ‰€ä»¥è¦é™åˆ¶ç”¨æˆ·ç¨‹åºçš„å ç”¨èµ„æºã€‚

 

ï¼ˆ3ï¼‰åˆ¤é¢˜è§„åˆ™

é¢˜ç›®ç”¨ä¾‹çš„æ¯”å¯¹ï¼Œç»“æœçš„éªŒè¯

 

ï¼ˆ4ï¼‰ä»»åŠ¡è°ƒåº¦

æœåŠ¡å™¨èµ„æºæœ‰é™ï¼Œç”¨æˆ·è¦æ’é˜Ÿï¼ŒæŒ‰ç…§é¡ºåºä¾æ¬¡æ‰§è¡Œåˆ¤é¢˜ï¼Œè€Œä¸æ˜¯ç›´æ¥æ‹’ç»



### æ ¸å¿ƒä¸šåŠ¡æµç¨‹

<img src="C:\Users\xtt\AppData\Roaming\Typora\typora-user-images\image-20240829170413207.png" alt="image-20240829170413207" style="zoom:50%;" />

<img src="C:\Users\xtt\AppData\Roaming\Typora\typora-user-images\image-20240829170514359.png" alt="image-20240829170514359" style="zoom: 50%;" />

åˆ¤é¢˜æœåŠ¡ï¼šè·å–é¢˜ç›®ä¿¡æ¯ã€é¢„è®¡çš„è¾“å…¥è¾“å‡ºç»“æœï¼Œè¿”å›ç»™ä¸»ä¸šåŠ¡åç«¯ï¼›ç”¨æˆ·çš„ç­”æ¡ˆæ˜¯å¦æ­£ç¡®

ä»£ç æ²™ç®±ï¼šåªè´Ÿè´£è¿è¡Œä»£ç ï¼Œç»™å‡ºç»“æœï¼Œä¸ç®¡ä»€ä¹ˆç»“æœæ˜¯æ­£ç¡®çš„



### æ¶æ„è®¾è®¡

<img src="C:\Users\xtt\AppData\Roaming\Typora\typora-user-images\image-20240829170553782.png" alt="image-20240829170553782" style="zoom:50%;" />

### ä¸»æµçš„OJç³»ç»Ÿå®ç°æ–¹æ¡ˆ

å¼€å‘åŸåˆ™ï¼šèƒ½ç”¨åˆ«äººçš„å°±ä¸è¦è‡ªå·±å†™

1. ç”¨ç°æˆçš„OJç³»ç»Ÿï¼Œæ¯”å¦‚ judge0

<https://github.com/judge0/judge0>

è‡ªå·±ç”¨æºç æ¥éƒ¨ç½²ã€å…¬æœ‰äº‘ã€ç§æœ‰äº‘

 

1. ç”¨ç°æˆçš„åˆ¤é¢˜APIï¼ˆæ¯”å¦‚judge0ï¼‰ï¼Œç°æˆçš„åˆ¤é¢˜æ²™ç®±

<https://rapidapi.com/nl/judge0-official/api/judge0-ce/>

 

APIçš„ä½œç”¨ï¼šæ¥å—ä»£ç ã€è¿”å›æ‰§è¡Œç»“æœ

æ³¨å†Œã€å¼€é€šè®¢é˜…ã€æµ‹è¯•Languagesæ¥å£ã€æµ‹è¯•æ‰§è¡Œä»£ç æ¥å£submissions

å®˜æ–¹æ–‡æ¡£ <https://ce.judge0.com/#submissions-submission-post>

 

ç¤ºä¾‹æ¥å£å‚æ•°ï¼š

```json
{
 "source_code": "#include <stdio.h>\n\nint main(void) {\n char name[10];\n scanf(\"%s\", name);\n printf(\"hello, %s\n\", name);\n return 0;\n}",
 "language_id": "4",
 "stdin": "Judge0",
 "expected_output": "hello, Judge0"
}
 
```

é¢„æœŸè¿”å›ï¼š

```json
{
 "source_code": "includestdiohintmainvoidcharname10scanfsnameprintfhellosnamereturn0=",
 "language_id": 76,
 "stdin": "Judgew==",
 "expected_output": "helloJudge0=",
 "stdout": null,
 "status_id": 6,
 "created_at": "2024-07-09T13:40:07.064Z",
 "finished_at": "2024-07-09T13:40:07.731Z",
 "time": null,
 "memory": null,
 "stderr": null,
 "token": "9f51b37c-45fe-42f6-9ce1-3a80b6feaafe",
 "number_of_runs": 1,
 "cpu_time_limit": "5.0",
 "cpu_extra_time": "1.0",
 "wall_time_limit": "10.0",
 "memory_limit": 128000,
 "stack_limit": 64000,
 "max_processes_and_or_threads": 60,
 "enable_per_process_and_thread_time_limit": false,
 "enable_per_process_and_thread_memory_limit": false,
 "max_file_size": 1024,
 "compile_output": "â€¦â€¦",
 "exit_code": null,
 "exit_signal": null,
 "message": null,
 "wall_time": null,
 "compiler_options": null,
 "command_line_arguments": null,
 "redirect_stderr_to_stdout": false,
 "callback_url": null,
 "additional_files": null,
 "enable_network": false,
 "post_execution_filesystem": null,
 "status": {
  "id": 6,
  "description": "Compilation Error"
 },
 "language": {
  "id": 76,
  "name": "C++ (Clang 7.0.1)"
 }
}
```





### å‰ç«¯é¡¹ç›®åˆå§‹åŒ–

ç¯å¢ƒï¼š node v18.20.4ã€npm 10.7.0

 

åˆå§‹åŒ–ï¼š

ä½¿ç”¨vue-cliè„šæ‰‹æ¶ï¼š <https://next.cli.vuejs.org/>

å®‰è£…è„šæ‰‹æ¶å·¥å…·ï¼š npm install -g @vue/cli

æ£€æµ‹æ˜¯å¦å®‰è£…æˆåŠŸï¼š vue -V

åˆ›å»ºé¡¹ç›®ï¼š vue create oj_frontend

è¿è¡Œé¡¹ç›®



### å‰ç«¯å·¥ç¨‹åŒ–é…ç½®

è„šæ‰‹æ¶å·²ç»ä¸ºæˆ‘ä»¬é…ç½®äº†ä»£ç ç¾åŒ–ã€è‡ªåŠ¨æ ¡éªŒã€æ ¼å¼åŒ–æ’ä»¶ç­‰ï¼Œæ— éœ€å†è‡ªè¡Œé…ç½®



### å…¨å±€çŠ¶æ€ç®¡ç†

Vuex: [å¼€å§‹ | Vuex (vuejs.org)](https://vuex.vuejs.org/zh/guide/)

æ‰€æœ‰é¡µé¢å…¨å±€å…±äº«çš„å˜é‡ï¼Œè€Œä¸æ˜¯å±€é™åœ¨æŸä¸€ä¸ªé¡µé¢ä¸­ã€‚

é€‚åˆä½œä¸ºå…¨å±€çŠ¶æ€çš„æ•°æ®ï¼šå·²ç™»å½•ç”¨æˆ·ä¿¡æ¯

æœ¬è´¨ä¸Šï¼šæä¾›äº†ä¸€å¥—å¢åˆ æ”¹æŸ¥å…¨å±€å˜é‡çš„APIï¼Œåªä¸è¿‡å¯èƒ½å¤šäº†ä¸€äº›åŠŸèƒ½ï¼ˆæ¯”å¦‚æ—¶é—´æ—…è¡Œï¼‰

 <img src="C:\Users\xtt\AppData\Roaming\Typora\typora-user-images\image-20240829171006758.png" alt="image-20240829171006758" style="zoom:50%;" />



å¯ä»¥ç›´æ¥å‚è€ƒè´­ç‰©è½¦ç¤ºä¾‹ï¼š[vuex/examples/classic/shopping-cart at main Â· vuejs/vuex (github.com)](https://github.com/vuejs/vuex/tree/main/examples/classic/shopping-cart)

 

stateï¼šå­˜å‚¨çš„çŠ¶æ€ä¿¡æ¯ï¼Œæ¯”å¦‚ç”¨æˆ·ä¿¡æ¯

mutationï¼ˆå°½é‡åŒæ­¥ï¼‰ï¼šå®šä¹‰äº†å¯¹å˜é‡è¿›è¡Œå¢åˆ æ”¹æŸ¥ï¼ˆæ›´æ–°ï¼‰çš„æ–¹æ³•

actionsï¼ˆæ”¯æŒå¼‚æ­¥ï¼‰ï¼šæ‰§è¡Œå¼‚æ­¥æ“ä½œï¼Œå¹¶ä¸”è§¦å‘ mutation çš„æ›´æ”¹ï¼ˆactions è°ƒç”¨ mutationï¼‰

 

å…ˆå®šä¹‰ user æ¨¡å—ï¼š

user.tsï¼š

``` ts
import { StoreOptions } from "vuex";

export default {
  namespaced: true,
  state: () => ({
    loginUser: {
      userName: "æœªç™»å½•",
    },
  }),

  actions: {
    getLoginUser({ commit, state }, payload) {
      commit("setProducts", { userName: "Dan" });
    },
  },

  mutations: {
    updateUser(state, payload) {
      state.loginUser = payload;
    },
  },
} as StoreOptions<any>;
```



index.tsï¼š

```ts
import { createStore } from "vuex";

import user from "./user";

export default createStore({
  mutations: {},

  actions: {},

  modules: {
    user,
  },
});
```

 

è·å–çŠ¶æ€å˜é‡ï¼š

`const store = useStore();`

`store.state.user.loginUser`

 

ä¿®æ”¹çŠ¶æ€å˜é‡ï¼š

```ts
store.dispatch("user/getLoginUser", {
  userName: "Dan",
});
```



### å®ç°é€šç”¨èœå•

[Arco Design Vue](https://arco.design/vue/component/menu)

æŠŠèœå•ä¸Šçš„è·¯ç”±æ”¹æˆè¯»å–è·¯ç”±æ–‡ä»¶ï¼Œå®ç°æ›´é€šç”¨çš„åŠ¨æ€é…ç½®

 

(1) æå–é€šç”¨è·¯ç”±æ–‡ä»¶

(2) èœå•ç»„ä»¶è¯»å–è·¯ç”±ï¼ŒåŠ¨æ€æ¸²æŸ“èœå•é¡¹

(3) ç»‘å®šè·³è½¬äº‹ä»¶

(4) åŒæ­¥è·¯ç”±åˆ°èœå•é¡¹

 

é¦–å…ˆç‚¹å‡»èœå•é¡¹ > è·³è½¬æ›´æ–°è·¯ç”± > æ›´æ–°è·¯ç”±åï¼ŒåŒæ­¥å»æ›´æ–°èœå•æ çš„é«˜äº®çŠ¶æ€

```ts
const router = useRouter();
//é»˜è®¤ä¸»é¡µ
const selectedKeys = ref(["/"]);

//è·¯ç”±è·³è½¬æ—¶ï¼Œæ›´æ–°é€‰ä¸­çš„èœå•é¡¹
router.afterEach((to, from, failure) => {
  selectedKeys.value = [to.path];
});
```



### æƒé™ç®¡ç†

æˆ‘èƒ½å¤Ÿç›´æ¥ä»¥ä¸€å¥—é€šç”¨çš„æœºåˆ¶ï¼Œå»å®šä¹‰å“ªä¸ªé¡µé¢éœ€è¦å“ªäº›æƒé™ã€‚



æ€è·¯ï¼š

ï¼ˆ1ï¼‰åœ¨è·¯ç”±é…ç½®æ–‡ä»¶ï¼Œå®šä¹‰æŸä¸ªè·¯ç”±çš„è®¿é—®æƒé™

ï¼ˆ2ï¼‰åœ¨å…¨å±€é¡µé¢ç»„ä»¶ä¸­ï¼Œç»‘å®šä¸€ä¸ªå…¨å±€è·¯ç”±ç›‘å¬ã€‚æ¯æ¬¡è®¿é—®é¡µé¢æ—¶ï¼Œæ ¹æ®ç”¨æˆ·è¦è®¿é—®é¡µé¢çš„è·¯ç”±ä¿¡æ¯ï¼Œå…ˆåˆ¤æ–­ç”¨æˆ·æ˜¯å¦æœ‰è®¿é—®æƒé™

ï¼ˆ3ï¼‰å¦‚æœæœ‰ï¼Œè·³è½¬åˆ°åŸé¡µé¢ï¼›å¦‚æœæ²¡æœ‰ï¼Œæ‹¦æˆªæˆ–è·³è½¬åˆ°401é‰´æƒæˆ–ç™»å½•é¡µ



å¯ä»¥å•ç‹¬å®šä¹‰ä¸€ä¸ªæ–‡ä»¶ï¼Œæ§åˆ¶è·¯ç”±çš„æ˜¾å½±



## ä¸€æœŸä¸‹

1. å®Œå–„å‰ç«¯é€šç”¨é¡¹ç›®çš„æ¨¡æ¿
2. åç«¯é¡¹ç›®åˆå§‹åŒ–ï¼ˆä¸‡ç”¨æ¨¡æ¿ï¼‰
3. å‰ç«¯æ¥å£è°ƒç”¨ä»£ç çš„è‡ªåŠ¨ç”Ÿæˆï¼ˆé€šç”¨çš„ä¸€ä¸ªä»£ç ç”Ÿæˆæ’ä»¶ï¼‰
4. å‰åç«¯è”è°ƒ
5. å¿«é€Ÿå†™ä¸€éç™»å½•æ³¨å†Œé¡µ




### ä¼˜åŒ–é¡µé¢å¸ƒå±€

1. åº•éƒ¨ footer å¸ƒå±€ä¼˜åŒ–
2. ä¼˜åŒ– contentã€globalHeader çš„æ ·å¼
3. ä¼˜åŒ–å¯¼èˆªæ ç”¨æˆ·åç§°çš„æ¢è¡Œ




### é€šç”¨å¯¼èˆªæ ç»„ä»¶ï¼Œæ ¹æ®é…ç½®æ§åˆ¶èœå•çš„æ˜¾éš

```ts
{
    path: "/hide",
    name: "éšè—é¡µé¢",
    component: AdminView,
    meta: {
      hideInMenu: true,
    },
},
```

```vue,ts
const visibleRoutes = routes.filter((item, index) => {
  if (item.meta?.hideInMenu) {
    return false;
  }
  return true;
});

<a-menu-item v-for="item in visibleRoutes" :key="item.path">
    {{item.name}}
</a-menu-item>
```



### æ ¹æ®æƒé™éšè—

éœ€æ±‚ï¼š åªæœ‰å…·æœ‰æƒé™çš„èœå•ï¼Œæ‰å¯¹ç”¨æˆ·å¯è§
åŸç†ï¼šç±»ä¼¼ä¸Šé¢çš„æ§åˆ¶è·¯ç”±æ˜¾ç¤ºéšè—ï¼Œåªè¦åˆ¤æ–­ç”¨æˆ·æ²¡æœ‰æƒé™å°±è¿‡æ»¤æ‰



### å…¨å±€æƒé™ç®¡ç†

1ï¼‰å®šä¹‰æƒé™

```ts
/**
 * æƒé™å®šä¹‰
 */
const ACCESS_ENUM = {
  NOT_LOGIN: "notLogin",
  USER: "user",
  ADMIN: "admin",
};

export default ACCESS_ENUM;
```

2ï¼‰å®šä¹‰ä¸€ä¸ªå…¬ç”¨çš„æƒé™æ ¡éªŒæ–¹æ³•
å› ä¸ºèœå•ç»„ä»¶è¦åˆ¤æ–­æƒé™ï¼Œæƒé™æ‹¦æˆªä¹Ÿè¦ç”¨åˆ°æƒé™åˆ¤æ–­åŠŸèƒ½ï¼Œæ‰€ä»¥æŠ½ç¦»æˆå…¬å…±æ–¹æ³•

åˆ›å»ºcheckAccess.tsæ–‡ä»¶ï¼Œä¸“é—¨å®šä¹‰æ£€æµ‹æƒé™çš„å‡½æ•°ï¼š

```ts
import ACCESS_ENUM from "./accessEnum";

/**
 * æ£€æŸ¥æƒé™ ï¼ˆåˆ¤æ–­å½“å‰ç™»å½•ç”¨æˆ·æ˜¯å¦å…·æœ‰æŸä¸ªæƒé™ï¼‰
 * @param loginUser å½“å‰ç™»å½•ç”¨æˆ·
 * @param needAccess éœ€è¦æœ‰çš„æƒé™
 * @return boolean æœ‰æ— æƒé™
 */
const checkAccess = (loginUser: any, needAccess = ACCESS_ENUM.NOT_LOGIN) => {
  //è·å–å½“å‰ç™»å½•ç”¨æˆ·å…·æœ‰çš„æƒé™ï¼ˆå¦‚æœæ²¡æœ‰loginUserï¼Œåˆ™è¡¨ç¤ºæœªç™»å½•ï¼‰
  const loginUserAccess = loginUser?.userRole ?? ACCESS_ENUM.NOT_LOGIN;
  if (needAccess === ACCESS_ENUM.NOT_LOGIN) {
    return true;
  }
  //å¦‚æœç”¨æˆ·ç™»å½•æ‰èƒ½è®¿é—®
  if (needAccess === ACCESS_ENUM.USER) {
    //å¦‚æœç”¨æˆ·æ²¡ç™»é™†ï¼Œé‚£ä¹ˆè¡¨ç¤ºæ— æƒé™
    if (loginUserAccess !== ACCESS_ENUM.NOT_LOGIN) {
      return false;
    }
  }
  //å¦‚æœéœ€è¦ç®¡ç†å‘˜æƒé™
  if (needAccess === ACCESS_ENUM.ADMIN) {
    //å¦‚æœä¸ä¸ºç®¡ç†å‘˜ï¼Œè¡¨ç¤ºæ— æƒé™
    if (loginUserAccess !== ACCESS_ENUM.ADMIN) {
      return false;
    }
  }
  return true;
};

export default checkAccess;
```

3ï¼‰ä¿®æ”¹ GlobalHeader åŠ¨æ€èœå•ç»„ä»¶ï¼Œæ ¹æ®æƒé™æ¥è¿‡æ»¤èœå•
æ³¨æ„ï¼Œè¿™é‡Œä½¿ç”¨è®¡ç®—å±æ€§ï¼Œæ˜¯ä¸ºäº†å½“ç™»å½•ç”¨æˆ·ä¿¡æ¯å‘ç”Ÿå˜æ›´æ—¶ï¼Œè§¦å‘èœå•æ çš„é‡æ–°æ¸²æŸ“ï¼Œå±•ç¤ºæ–°å¢æƒé™çš„èœå•é¡¹

```ts
const visibleRoutes = computed(() => {
  return routes.filter((item, index) => {
    if (item.meta?.hideInMenu) {
      return false;
    }
    // æ ¹æ®æƒé™è¿‡æ»¤èœå•
    if (
      !checkAccess(store.state.user.loginUser, item?.meta?.access as string)
    ) {
      return false;
    }
    return true;
  });
});
```



### å…¨å±€é¡¹ç›®å…¥å£

app.vue ä¸­é¢„ç•™ä¸€ä¸ªå¯ä»¥ç¼–å†™å…¨å±€åˆå§‹åŒ–é€»è¾‘çš„ä»£ç ï¼š

```ts
const doInit = () => {
  console.log("hello æ¬¢è¿æ¥åˆ°æˆ‘çš„é¡¹ç›®");
};
onMounted(() => {
  doInit();
});
```



### åç«¯é¡¹ç›®åˆå§‹åŒ–

æŠŠé€šç”¨åç«¯æ¡†æ¶è¿è¡Œ

1ï¼‰æ‰“å¼€ springboot-init åç«¯é¡¹ç›®æ¨¡æ¿
2ï¼‰å…¨å±€æ›¿æ¢é¡¹ç›®åç§°ï¼ˆoj-backendï¼‰
3ï¼‰å…¨å±€æ›¿æ¢åŒ…åï¼ˆdantalian.danojï¼‰
4ï¼‰æ‰§è¡Œ create_table.sql è„šæœ¬ï¼Œä¿®æ”¹æ•°æ®åº“åï¼ˆdanojï¼‰
5ï¼‰ä¿®æ”¹ç«¯å£å·
6ï¼‰ä¿®æ”¹ application.yml ä¸­çš„æ•°æ®åº“é…ç½®



### é¡¹ç›®æ¨¡æ¿

1ï¼‰README.md
2ï¼‰sql/create_table.sql å®šä¹‰äº†æ•°æ®åº“çš„åˆå§‹åŒ–å»ºåº“å»ºè¡¨è¯­å¥
3ï¼‰sql/post_es_mapping.json å¸–å­è¡¨åœ¨ ES ä¸­çš„å»ºè¡¨å‘½ä»¤
4ï¼‰aop æ‹¥æœ‰å…¨å±€æƒé™æ ¡éªŒã€å…¨å±€æ—¥å¿—è®°å½•
5ï¼‰common ä¸‡ç”¨ç±»ï¼Œæ¯”å¦‚é€šç”¨å“åº”ç±»
6ï¼‰config æ‹¥æœ‰æ¥æ”¶ application.yml ä¸­çš„å‚æ•°ï¼Œåˆå§‹åŒ–ä¸€äº›å®¢æˆ·ç«¯çš„é…ç½®ç±»ï¼ˆæ¯”å¦‚å¯¹è±¡å®¢æˆ·å­˜å‚¨å®¢æˆ·ç«¯ï¼‰
7ï¼‰constant å®šä¹‰å¸¸é‡
8ï¼‰controller æ¥æ”¶è¯·æ±‚
9ï¼‰esdao ç±»ä¼¼ mybatis çš„ mapperï¼Œç”¨äºæ“ä½œ ES
10ï¼‰exception å¼‚å¸¸å¤„ç†ç›¸å…³
11ï¼‰job ä»»åŠ¡ç›¸å…³ï¼ˆå®šæ—¶ä»»åŠ¡ã€å•æ¬¡ä»»åŠ¡ï¼‰
12ï¼‰manager æœåŠ¡å±‚ï¼Œä¸€èˆ¬æ˜¯å®šä¹‰ä¸€äº›å…¬ç”¨çš„æœåŠ¡ã€å¯¹æ¥ç¬¬ä¸‰æ–¹ API ç­‰
13ï¼‰mapper mybatisçš„æ•°æ®åº“è®¿é—®å±‚ï¼Œç”¨äºæ“ä½œæ•°æ®åº“
14ï¼‰model æ•°æ®æ¨¡å‹ã€å®ä½“ç±»ã€åŒ…è£…ç±»ã€æšä¸¾å€¼
15ï¼‰service æœåŠ¡å±‚ï¼Œç”¨äºç¼–å†™ä¸šåŠ¡é€»è¾‘
16ï¼‰utils å·¥å…·ç±»ï¼Œå„ç§å…¬ç”¨æ–¹æ³•
17ï¼‰wxmp å…¬ä¼—å·ç›¸å…³çš„åŒ…
18ï¼‰test å•å…ƒæµ‹è¯•
19ï¼‰MainApplication.java é¡¹ç›®å¯åŠ¨å…¥å£
20ï¼‰Dockerfile ç”¨äºæ„å»º Docker é•œåƒ



### å‰åç«¯è”è°ƒ

å‰ç«¯å’Œåç«¯æ€ä¹ˆè¿æ¥èµ·æ¥ï¼Ÿ&nbsp;&nbsp;&nbsp;&nbsp; æ¥å£/è¯·æ±‚ 
å‰ç«¯å‘é€è¯·æ±‚è°ƒç”¨åç«¯æ¥å£

1ï¼‰å®‰è£…è¯·æ±‚å·¥å…·ç±» Axios 
å®˜æ–¹æ–‡æ¡£ï¼š<https://axios-http.com/docs/intro> 
ä»£ç ï¼š `npm install axios`

2ï¼‰ç¼–å†™è°ƒç”¨åç«¯çš„ä»£ç  
ä¼ ç»Ÿæƒ…å†µä¸‹ï¼Œæ¯ä¸ªè¯·æ±‚éƒ½è¦å•ç‹¬ç¼–å†™ä»£ç ã€‚è‡³å°‘å¾—å†™ä¸€ä¸ªè¯·æ±‚è·¯å¾„ 

ä½¿ç”¨è‡ªåŠ¨ç”Ÿæˆå·¥å…·ï¼š<https://github.com/ferdikoomen/openapi-typescript-codegen> 
å®‰è£…ï¼š`npm install openapi-typescript-codegen --save-dev`
ç”Ÿæˆï¼š`node node_modules/openapi-typescript-codegen/bin/index.js --input http://localhost:8121/api/v2/api-docs --output ./generated --client axios`

3ï¼‰ä½¿ç”¨ç”Ÿæˆçš„ Service ä»£ç ï¼Œç›´æ¥è°ƒç”¨å‡½æ•°å‘é€è¯·æ±‚å³å¯ï¼Œæ¯”å¦‚è·å–ç™»å½•ä¿¡æ¯

```ts
const res = await UserControllerService.getLoginUserUsingGet();
      if (res.code === 0) {
        commit("updateUser", res.data);
      } else {
        commit("updateUser", {
          ...state.loginUser,
          userRole: ACCESS_ENUM.NOT_LOGIN,
        });
      }
```



å¦‚æœæƒ³è¦è‡ªå®šä¹‰è¯·æ±‚å‚æ•° ï¼š

1ï¼‰ä½¿ç”¨ä»£ç ç”Ÿæˆå™¨æä¾›çš„å…¨å±€å‚æ•°ä¿®æ”¹å¯¹è±¡ï¼š

```ts
export const OpenAPI: OpenAPIConfig = {
    BASE: 'http://localhost:8121',
    VERSION: '1.0',
    WITH_CREDENTIALS: false,
    CREDENTIALS: 'include',
    TOKEN: undefined,
    USERNAME: undefined,
    PASSWORD: undefined,
    HEADERS: undefined,
    ENCODE_PATH: undefined,
};
```

[æ–‡æ¡£](https://github.com/ferdikoomen/openapi-typescript-codegen/wiki/OpenAPI-object)

`WITH_CREDENTIALS: false`ï¼šè¡¨ç¤ºå®¢æˆ·ç«¯ä»£ç ä¸­ç¦ç”¨å‡­æ®ä¼ é€’ï¼Œå¦‚æœéœ€è¦å®ç°åŸºäºcookiesçš„ç”¨æˆ·ç™»å½•ï¼Œéœ€è¦å°†å…¶æ”¹æˆ trueã€‚

2ï¼‰ç›´æ¥å®šä¹‰ axios è¯·æ±‚åº“çš„å…¨å±€å‚æ•°ï¼Œæ¯”å¦‚å…¨å±€è¯·æ±‚å“åº”æ‹¦æˆªå™¨

[æ–‡æ¡£](https://axios-http.com/docs/interceptors)

ç¤ºä¾‹ï¼š

```ts
// Add a request interceptor
import axios from "axios";

axios.interceptors.request.use(
  function (config) {
    // Do something before request is sent
    return config;
  },
  function (error) {
    // Do something with request error
    return Promise.reject(error);
  }
);

// Add a response interceptor
axios.interceptors.response.use(
  function (response) {
    console.log("å“åº”", response);
    // Any status code that lie within the range of 2xx cause this function to trigger
    // Do something with response data
    return response;
  },
  function (error) {
    // Any status codes that falls outside the range of 2xx cause this function to trigger
    // Do something with response error
    return Promise.reject(error);
  }
);

```



### ç”¨æˆ·ç™»å½•

#### è‡ªåŠ¨ç™»å½•

1ï¼‰åœ¨ store/user.ts ç¼–å†™è·å–è¿œç¨‹ç™»å½•ç”¨æˆ·ä¿¡æ¯çš„ä»£ç 

```ts
actions: {
    // ä»è¿œç¨‹è¯·æ±‚è·å–ç™»å½•ä¿¡æ¯
    async getLoginUser({ commit, state }, payload) {
      const res = await UserControllerService.getLoginUserUsingGet();
      if (res.code === 0) {
        commit("updateUser", res.data);
      } else {
        commit("updateUser", {
          ...state.loginUser,
          userRole: ACCESS_ENUM.NOT_LOGIN,
        });
      }
    },
  },
```

2ï¼‰åœ¨ä¸€ä¸ªå…¨å±€çš„ä½ç½®è§¦å‘ getLoginUser  å‡½æ•°çš„æ‰§è¡Œ

1. è·¯ç”±æ‹¦æˆª
2. å…¨å±€é¡µé¢å…¥å£ app.vue
3. å…¨å±€é€šç”¨å¸ƒå±€ï¼ˆæ‰€æœ‰é¡µé¢éƒ½å…±äº«çš„ç»„ä»¶ï¼‰



### å…¨å±€æƒé™ç®¡ç†ä¼˜åŒ–

1ï¼‰æ–°å»º access/index.ts æ–‡ä»¶ï¼ŒæŠŠåŸæœ‰çš„è·¯ç”±æ‹¦æˆªã€æƒé™æ ¡éªŒé€»è¾‘æ”¾åœ¨ç‹¬ç«‹çš„æ–‡ä»¶ä¸­

ä¼˜åŠ¿ï¼šåªè¦ä¸å¼•å…¥ã€å°±ä¸ä¼šå¼€å¯ã€ä¸ä¼šå¯¹é¡¹ç›®æœ‰å½±å“

2ï¼‰ç¼–å†™æƒé™ç®¡ç†å’Œè‡ªåŠ¨ç™»å½•é€»è¾‘

å¦‚æœæ²¡ç™»å½•è¿‡ï¼Œè‡ªåŠ¨ç™»å½•ï¼š

```ts
const loginUser = store.state.user.loginUser;
  // å¦‚æœä¹‹å‰æ²¡ç™»å½•è¿‡ï¼Œè‡ªåŠ¨ç™»å½•
  if (!loginUser || !loginUser.userRole) {
    // åŠ awaitæ˜¯ä¸ºäº†ç­‰ç”¨æˆ·ç™»å½•æˆåŠŸä¹‹åï¼Œå†æ‰§è¡Œåç»­çš„ä»£ç 
    await store.dispatch("user/getLoginUser");
  }
```

å¦‚æœç”¨æˆ·è®¿é—®çš„é¡µé¢ä¸éœ€è¦ç™»å½•ï¼Œåˆ™ä¸éœ€è¦å¼ºåˆ¶è·³è½¬åˆ°ç™»å½•é¡µ

access/index.ts ï¼š

```ts
import router from "@/router";
import store from "@/store";
import ACCESS_ENUM from "./accessEnum";
import checkAccess from "./checkAccess";

router.beforeEach(async (to, from, next) => {
  console.log("è·å–ç™»å½•ç”¨æˆ·ä¿¡æ¯", store.state.user.loginUser);

  const loginUser = store.state.user.loginUser;
  // å¦‚æœä¹‹å‰æ²¡ç™»å½•è¿‡ï¼Œè‡ªåŠ¨ç™»å½•
  if (!loginUser || !loginUser.userRole) {
    // åŠ awaitæ˜¯ä¸ºäº†ç­‰ç”¨æˆ·ç™»å½•æˆåŠŸä¹‹åï¼Œå†æ‰§è¡Œåç»­çš„ä»£ç 
    await store.dispatch("user/getLoginUser");
  }
  const needAccess = (to.meta?.access as string) ?? ACCESS_ENUM.NOT_LOGIN;
  // è¦è·³è½¬çš„é¡µé¢å¿…é¡»è¦ç™»å½•
  if (needAccess !== ACCESS_ENUM.NOT_LOGIN) {
    // å¦‚æœæ²¡ç™»å½•ï¼Œè·³è½¬åˆ°ç™»å½•é¡µé¢
    if (!loginUser || !loginUser.userRole) {
      next(`/user/login?redirect=${to.fullPath}`);
      return;
    }
  }
  // å¦‚æœå·²ç»ç™»å½•ä½†æ˜¯æƒé™ä¸è¶³ï¼Œé‚£ä¹ˆè·³è½¬åˆ°æ— æƒé™é¡µé¢
  if (!checkAccess(loginUser, needAccess)) {
    next("/noAuth");
  }

  next();
});

```



### æ”¯æŒå¤šå¥—å¸ƒå±€

1ï¼‰å† routes è·¯ç”±æ–‡ä»¶ä¸­æ–°å»ºä¸€å¥—ç”¨æˆ·è·¯ç”±ï¼Œä½¿ç”¨ vue-router è‡ªå¸¦çš„å­è·¯ç”±æœºåˆ¶ï¼Œå®ç°å¸ƒå±€å’ŒåµŒå¥—è‡ªç”±

```ts
export const routes: Array<RouteRecordRaw> = [
  {
    path: "/user",
    name: "ç”¨æˆ·",
    component: UserLayout,
    children: [
      {
        path: "/user/login",
        name: "ç”¨æˆ·ç™»å½•",
        component: UserLoginView,
      },
      {
        path: "/user/register",
        name: "ç”¨æˆ·æ³¨å†Œ",
        component: UserRegisterView,
      },
    ],
  },
```

2ï¼‰æ–°å»º UserLayoutã€UserLoginViewã€UserRegisterView é¡µé¢ï¼Œå¹¶ä¸”å† routes ä¸­å¼•å…¥

3ï¼‰åœ¨ app.vue æ ¹é¡µé¢æ–‡ä»¶ï¼Œæ ¹æ®è·¯ç”±å»åŒºåˆ†å¤šå¥—å¸ƒå±€

```html
<template v-if="route.path.startsWith('/user')">
	<router-view />
</template>
<template v-else>
	<BasicLayout />
</template>
```



### ç™»å½•é¡µé¢å¼€å‘





## äºŒæœŸ



### åº“è¡¨è®¾è®¡

#### ç”¨æˆ·è¡¨

åªæœ‰ç®¡ç†å‘˜æ‰èƒ½å‘å¸ƒå’Œç®¡ç†é¢˜ç›®ï¼Œæ™®é€šç”¨æˆ·åªèƒ½çœ‹é¢˜

```sql
-- ç”¨æˆ·è¡¨
create table if not exists user
(
    id           bigint auto_increment comment 'id' primary key,
    userAccount  varchar(256)                           not null comment 'è´¦å·',
    userPassword varchar(512)                           not null comment 'å¯†ç ',
    unionId      varchar(256)                           null comment 'å¾®ä¿¡å¼€æ”¾å¹³å°id',
    mpOpenId     varchar(256)                           null comment 'å…¬ä¼—å·openId',
    userName     varchar(256)                           null comment 'ç”¨æˆ·æ˜µç§°',
    userAvatar   varchar(1024)                          null comment 'ç”¨æˆ·å¤´åƒ',
    userProfile  varchar(512)                           null comment 'ç”¨æˆ·ç®€ä»‹',
    userRole     varchar(256) default 'user'            not null comment 'ç”¨æˆ·è§’è‰²ï¼šuser/admin/ban',
    createTime   datetime     default CURRENT_TIMESTAMP not null comment 'åˆ›å»ºæ—¶é—´',
    updateTime   datetime     default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment 'æ›´æ–°æ—¶é—´',
    isDelete     tinyint      default 0                 not null comment 'æ˜¯å¦åˆ é™¤',
    index idx_unionId (unionId)
) comment 'ç”¨æˆ·' collate = utf8mb4_unicode_ci;
```



#### é¢˜ç›®è¡¨

é¢˜ç›®æ ‡é¢˜

é¢˜ç›®å†…å®¹ï¼šå­˜æ”¾é¢˜ç›®çš„ä»‹ç»ã€è¾“å…¥è¾“å‡ºæç¤ºã€æè¿°ã€å…·ä½“çš„è¯¦æƒ…

é¢˜ç›®æ ‡ç­¾ï¼ˆjsonæ•°ç»„å­—ç¬¦ä¸²ï¼‰ï¼šæ ˆã€é˜Ÿåˆ—ã€é“¾è¡¨ã€ç®€å•ã€ä¸­ç­‰ã€å›°éš¾

é¢˜ç›®ç­”æ¡ˆï¼šç®¡ç†å‘˜/ç”¨æˆ·è®¾ç½®çš„æ ‡å‡†ç­”æ¡ˆ

æäº¤æ•°ã€é€šè¿‡é¢˜ç›®çš„äººæ•°ç­‰ï¼šä¾¿äºåˆ†æç»Ÿè®¡ï¼ˆå¯ä»¥è€ƒè™‘æ ¹æ®é€šè¿‡ç‡è‡ªåŠ¨ç»™é¢˜ç›®æ‰“éš¾æ˜“åº¦æ ‡ç­¾ï¼‰



åˆ¤é¢˜ç›¸å…³å­—æ®µï¼š

>å¦‚æœè¯´é¢˜ç›®ä¸æ˜¯å¾ˆå¤æ‚ï¼Œç”¨ä¾‹æ–‡ä»¶å¤§å°ä¸å¤§çš„è¯ï¼Œå¯ä»¥ç›´æ¥å­˜åœ¨æ•°æ®åº“è¡¨é‡Œ
>
>ä½†æ˜¯å¦‚æœç”¨ä¾‹æ–‡ä»¶æ¯”è¾ƒå¤§ï¼Œ>512kb å»ºè®®å•ç‹¬å­˜æ”¾åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œæ•°æ®åº“ä¸­åªä¿å­˜æ–‡ä»¶ url ï¼ˆç±»ä¼¼å­˜å‚¨ç”¨æˆ·å¤´åƒï¼‰



* è¾“å…¥ç”¨ä¾‹ï¼š1ã€2
* è¾“å‡ºç”¨ä¾‹ï¼š3ã€4
* æ—¶é—´é™åˆ¶
* å†…å­˜é™åˆ¶



judgeConfig åˆ¤é¢˜é…ç½®ï¼ˆjson å¯¹è±¡ï¼‰ï¼š

* æ—¶é—´é™åˆ¶ timeLimit

* å†…å­˜é™åˆ¶ memoryLimit

  

judgeCase åˆ¤é¢˜ç”¨ä¾‹ï¼ˆjsonæ•°ç»„ï¼‰ï¼š

* æ¯ä¸€ä¸ªå…ƒç´ æ˜¯ï¼šä¸€ä¸ªè¾“å…¥ç”¨ä¾‹å¯¹åº”ä¸€ä¸ªè¾“å‡ºç”¨ä¾‹

```json
[
    {
        "input": "1 2",
        "output": "3 4"
    },
    {
        "input": "1 3",
        "output": "2 4"
    }
]
```



å­˜ json çš„å¥½å¤„ï¼šä¾¿äºæ‰©å±•ï¼Œåªéœ€è¦æ”¹å˜å¯¹è±¡å†…éƒ¨çš„å­—æ®µï¼Œè€Œä¸ç”¨ä¿®æ”¹æ•°æ®åº“è¡¨ï¼ˆå¯èƒ½ä¼šå½±å“æ•°æ®åº“ï¼‰

```json
{
    "timeLimit": 1000,
    "memoryLimit": 1000,
    "stackLimit": 1000
}
```



é¢˜ç›®è¡¨ï¼š

```sql
-- é¢˜ç›®è¡¨
create table if not exists question
(
    id          bigint auto_increment comment 'id' primary key,
    title       varchar(512)                       null comment 'æ ‡é¢˜',
    content     text                               null comment 'å†…å®¹',
    tags        varchar(1024)                      null comment 'æ ‡ç­¾åˆ—è¡¨ï¼ˆjson æ•°ç»„ï¼‰',
    answer      text                               null comment 'é¢˜ç›®ç­”æ¡ˆ',
    submitNum   int      default 0                 not null comment 'é¢˜ç›®æäº¤æ•°',
    acceptedNum int      default 0                 not null comment 'é¢˜ç›®é€šè¿‡æ•°',
    judgeCase   text                               null comment 'åˆ¤é¢˜ç”¨ä¾‹ï¼ˆjson æ•°ç»„ï¼‰',
    judgeConfig text                               null comment 'åˆ¤é¢˜é…ç½®ï¼ˆjson å¯¹è±¡ï¼‰',
    thumbNum    int      default 0                 not null comment 'ç‚¹èµæ•°',
    favourNum   int      default 0                 not null comment 'æ”¶è—æ•°',
    userId      bigint                             not null comment 'åˆ›å»ºç”¨æˆ· id',
    createTime  datetime default CURRENT_TIMESTAMP not null comment 'åˆ›å»ºæ—¶é—´',
    updateTime  datetime default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment 'æ›´æ–°æ—¶é—´',
    isDelete    tinyint  default 0                 not null comment 'æ˜¯å¦åˆ é™¤',
    index idx_userId (userId)
) comment 'é¢˜ç›®' collate = utf8mb4_unicode_ci;
```



#### é¢˜ç›®æäº¤è¡¨

å“ªä¸ªç”¨æˆ·æäº¤äº†å“ªé“é¢˜ç›®ï¼Œå­˜æ”¾åˆ¤é¢˜ç»“æœç­‰



æäº¤ç”¨æˆ· idï¼šuserId

é¢˜ç›® idï¼šquestionId

ç¼–ç¨‹è¯­è¨€ï¼šlanguage

ç”¨æˆ·ä»£ç ï¼šcode

åˆ¤é¢˜çŠ¶æ€ï¼šstatusï¼ˆ0 - å¾…åˆ¤é¢˜ã€1 - åˆ¤é¢˜ä¸­ã€2 - æˆåŠŸã€3 - å¤±è´¥ï¼‰

åˆ¤é¢˜ä¿¡æ¯ï¼ˆåˆ¤é¢˜è¿‡ç¨‹ä¸­å¾—åˆ°çš„ä¸€äº›ä¿¡æ¯ï¼Œæ¯”å¦‚ç¨‹åºå¤±è´¥çš„åŸå› ã€ç¨‹åºæ‰§è¡Œæ¶ˆè€—çš„æ—¶é—´ç©ºé—´ï¼‰ï¼šjudgeInfoï¼ˆjson å¯¹è±¡ï¼Œå•ä½msã€kbï¼‰

```json
{
    "message": "ç¨‹åºæ‰§è¡Œä¿¡æ¯",
    "time": 1000,
    "memory": 1000, 
}
```

åˆ¤é¢˜ä¿¡æ¯æšä¸¾å€¼ï¼š

* Accepted æˆåŠŸ
* Wrong Answer ç­”æ¡ˆé”™è¯¯
* Compile Error ç¼–è¯‘é”™è¯¯
* Memory Limit Exceeded å†…å­˜æº¢å‡º
* Time Limit Exceeded è¶…æ—¶
* Presentation Error å±•ç¤ºé”™è¯¯
* Output Limit Exceeded è¾“å‡ºæº¢å‡º
* Waiting ç­‰å¾…ä¸­
* Dangerous Operation å±é™©æ“ä½œ
* Runtime Error è¿è¡Œé”™è¯¯ï¼ˆç”¨æˆ·ç¨‹åºçš„é—®é¢˜ï¼‰
* System Error ç³»ç»Ÿé”™è¯¯ï¼ˆåšç³»ç»Ÿäººçš„é—®é¢˜ï¼‰



```sql
-- é¢˜ç›®æäº¤è¡¨
create table if not exists question_submit
(
    id         bigint auto_increment comment 'id' primary key,
    language   varchar(128)                       not null comment 'ç¼–ç¨‹è¯­è¨€',
    code       text                               not null comment 'ç”¨æˆ·ä»£ç ',
    judgeInfo  text                               null comment 'åˆ¤é¢˜ä¿¡æ¯ï¼ˆjson å¯¹è±¡ï¼‰',
    status     int      default 0                 not null comment 'åˆ¤é¢˜çŠ¶æ€ï¼ˆ0å¾…åˆ¤é¢˜ã€1åˆ¤é¢˜ä¸­ã€2æˆåŠŸã€3å¤±è´¥ï¼‰',
    questionId bigint                             not null comment 'é¢˜ç›® id',
    userId     bigint                             not null comment 'åˆ›å»ºç”¨æˆ· id',
    createTime datetime default CURRENT_TIMESTAMP not null comment 'åˆ›å»ºæ—¶é—´',
    updateTime datetime default CURRENT_TIMESTAMP not null on update CURRENT_TIMESTAMP comment 'æ›´æ–°æ—¶é—´',
    isDelete   tinyint  default 0                 not null comment 'æ˜¯å¦åˆ é™¤',
    index idx_postId (questionId),
    index idx_userId (userId)
) comment 'é¢˜ç›®æäº¤è¡¨';
```



tipsï¼š

ä»€ä¹ˆæƒ…å†µä¸‹è¦åŠ ç´¢å¼•ï¼Ÿå¦‚ä½•é€‰æ‹©ç»™å“ªä¸ªå­—æ®µåŠ ç´¢å¼•ï¼Ÿ

é¦–å…ˆä»ä¸šåŠ¡å‡ºå‘ï¼Œæ— è®ºæ˜¯å•ä¸ªç´¢å¼•è¿˜æ˜¯è”åˆç´¢å¼•ï¼Œéƒ½è¦ä»ä½ å®é™…çš„æŸ¥è¯¢è¯­å¥ã€å­—æ®µæšä¸¾å€¼çš„åŒºåˆ†åº¦ã€å­—æ®µçš„ç±»å‹è€ƒè™‘ï¼ˆwhere æ¡ä»¶æŒ‡å®šçš„å­—æ®µï¼‰

æ¯”å¦‚ï¼šwhere userId = 1 and questionId = 2

å¯ä»¥é€‰æ‹©æ ¹æ® userId å’Œ questionId åˆ†åˆ«å»ºç«‹ç´¢å¼•ï¼ˆéœ€è¦åˆ†åˆ«æ ¹æ®è¿™ä¸¤ä¸ªå­—æ®µå•ç‹¬æŸ¥è¯¢ï¼‰ï¼›ä¹Ÿå¯ä»¥é€‰æ‹©ç»™è¿™ä¸¤ä¸ªå­—æ®µå»ºç«‹è”åˆç´¢å¼•ï¼ˆæ‰€æŸ¥è¯¢çš„å­—æ®µæ˜¯ç»‘å®šåœ¨ä¸€èµ·çš„ï¼‰

åŸåˆ™ä¸Šï¼šèƒ½ä¸ç”¨ç´¢å¼•å°±ä¸ç”¨ï¼›èƒ½ç”¨å•ä¸ªç´¢å¼•å°±åˆ«ç”¨è”åˆ/å¤šä¸ªç´¢å¼•ï¼›ä¸è¦ç»™æ²¡åŒºåˆ†åº¦çš„å­—æ®µåŠ ç´¢å¼•ï¼ˆæ¯”å¦‚æ€§åˆ«ï¼‰ã€‚å› ä¸ºç´¢å¼•ä¹Ÿæ˜¯è¦å ç”¨ç©ºé—´çš„



### åç«¯æ¥å£å¼€å‘

#### åç«¯å¼€å‘æµç¨‹

1ï¼‰æ ¹æ®åŠŸèƒ½è®¾è®¡åº“è¡¨

2ï¼‰è‡ªåŠ¨ç”Ÿæˆå¯¹æ•°æ®åº“åŸºæœ¬çš„å¢åˆ æ”¹æŸ¥ï¼ˆmapper å’Œ service å±‚çš„åŸºæœ¬åŠŸèƒ½ï¼‰

3ï¼‰ç¼–å†™ Controller å±‚ï¼Œå®ç°åŸºæœ¬çš„å¢åˆ æ”¹æŸ¥å’Œæƒé™æ ¡éªŒï¼ˆå¤åˆ¶ç²˜è´´ï¼‰

4ï¼‰æ ¹æ®ä¸šåŠ¡å®šåˆ¶å¼€å‘æ–°çš„åŠŸèƒ½ï¼Œç¼–å†™æ–°çš„ä»£ç 



æ›´å¥½çš„æ–¹æ³•ï¼šç¼–å†™è‡ªå·±çš„ä»£ç ç”Ÿæˆå™¨



#### ä»£ç ç”Ÿæˆæ–¹æ³•

1ï¼‰å®‰è£… MybatisX æ’ä»¶

2ï¼‰æ ¹æ®é¡¹ç›®å»è°ƒæ•´ç”Ÿæˆé…ç½®ï¼Œå»ºè®®ç”Ÿæˆä»£ç åˆ°ç‹¬ç«‹çš„åŒ…ï¼Œä¸è¦å½±å“è€çš„é¡¹ç›®

<img src="C:\Users\xtt\AppData\Roaming\Typora\typora-user-images\image-20240806143917769.png" alt="image-20240806143917769" style="zoom: 50%;" />

3ï¼‰æŠŠä»£ç ä»ç”ŸæˆåŒ…ä¸­ç§»åˆ°å®é™…é¡¹ç›®å¯¹åº”ç›®å½•ä¸­

4ï¼‰æ‰¾ç›¸ä¼¼çš„ä»£ç å»å¤åˆ¶ Controller

* å•è¡¨å»å¤åˆ¶å•è¡¨ Controllerï¼ˆæ¯”å¦‚ question => postï¼‰
* å…³è”è¡¨å»å¤åˆ¶å…³è”è¡¨ï¼ˆæ¯”å¦‚ question_submit => post_thumb)

5ï¼‰å¤åˆ¶å®ä½“ç±»ç›¸å…³çš„ DTOã€VOã€æšä¸¾å€¼å­—æ®µï¼ˆç”¨äºæ¥æ”¶å‰ç«¯è¯·æ±‚ã€ä¸šåŠ¡é—´ä¼ é€’ï¼‰ï¼Œå¤åˆ¶ä¹‹åè°ƒæ•´å¯¹åº”çš„å­—æ®µ

updateRequest å’Œ editRequest çš„åŒºåˆ«ï¼šå‰è€…æ˜¯ç»™ç®¡ç†å‘˜æ›´æ–°ç”¨çš„ï¼Œå¯ä»¥æŒ‡å®šæ›´å¤šå­—æ®µï¼›åè€…æ˜¯ç»™æ™®é€šç”¨æˆ·ä½¿ç”¨çš„ï¼Œåªèƒ½æŒ‡å®šéƒ¨åˆ†å­—æ®µ

6ï¼‰ä¸ºäº†æ›´æ–¹ä¾¿åœ°å¤„ç† json å­—æ®µä¸­çš„æŸä¸ªå­—æ®µï¼Œéœ€è¦ç»™å¯¹åº”çš„ json å­—æ®µç¼–å†™ç‹¬ç«‹çš„ç±»ï¼Œæ¯”å¦‚ judgeConfigã€judgeInfoã€judgeCase

```java
/**
 * é¢˜ç›®ç”¨ä¾‹
 */
@Data
public class JudgeCase {

    /**
     * è¾“å…¥ç”¨ä¾‹
     */
    private String input;

    /**
     * è¾“å‡ºç”¨ä¾‹
     */
    private String output;
}
```



tipsï¼š

ä»€ä¹ˆæƒ…å†µä¸‹è¦åŠ ä¸šåŠ¡å‰ç¼€ï¼Ÿä»€ä¹ˆæƒ…å†µå¸ƒå±€ï¼Ÿ

åŠ ä¸šåŠ¡å‰ç¼€çš„å¥½å¤„ï¼Œé˜²æ­¢å¤šä¸ªè¡¨éƒ½æœ‰ç±»ä¼¼çš„ç±»ï¼Œäº§ç”Ÿå†²çªï¼›ä¸åŠ çš„å‰æï¼Œå› ä¸ºå¯èƒ½è¿™ä¸ªç±»æ˜¯å¤šä¸ªä¸šåŠ¡ä¹‹é—´å…±äº«çš„ï¼Œèƒ½å¤Ÿä¿è¯å”¯ä¸€



å®šä¹‰ VO ç±»ï¼šä½œç”¨æ˜¯ä¸“é—¨ç»™å‰ç«¯è¿”å›å¯¹è±¡ï¼Œå¯ä»¥èŠ‚çº¦ç½‘ç»œä¼ è¾“å¤§å°ã€æˆ–è€…è¿‡æ»¤å­—æ®µï¼ˆè„±æ•ï¼‰ã€ä¿è¯å®‰å…¨æ€§ã€‚æ¯”å¦‚ judgeCaseã€answerå­—æ®µä¸€å®šè¦åˆ ï¼Œä¸èƒ½ç›´æ¥ç»™ç”¨æˆ·ç­”æ¡ˆ



7ï¼‰æ ¡éªŒ Controller å±‚çš„ä»£ç ï¼Œçœ‹çœ‹é™¤äº†è¦è°ƒç”¨çš„æ–¹æ³•ç¼ºå¤±å¤–ï¼Œè¿˜æœ‰æ— æŠ¥é”™

8ï¼‰å®ç° Service å±‚çš„ä»£ç ï¼Œä»å¯¹åº”çš„å·²ç»ç¼–å†™å¥½çš„å®ç°ç±»å¤åˆ¶ç²˜è´´ï¼Œå…¨å±€æ›¿æ¢ï¼ˆæ¯”å¦‚ question => postï¼‰

9ï¼‰ç¼–å†™ QuestionVO çš„ json/å¯¹è±¡ è½¬æ¢å·¥å…·ç±»

10ï¼‰ç”¨åŒæ ·çš„æ–¹æ³•ï¼Œç¼–å†™ questionSubmit æäº¤ç±»ï¼Œè¿™æ¬¡å‚è€ƒ postThumb ç›¸å…³ä»£ç 

11ï¼‰ç¼–å†™æšä¸¾ç±»

```java
public enum QuestionSubmitLanguageEnum {

    JAVA("java", "java"),
    CPLUSPLUS("c++", "c++"),
    GOLANG("golang", "golang");

    private final String text;

    private final String value;

    QuestionSubmitLanguageEnum(String text, String value) {
        this.text = text;
        this.value = value;
    }

    /**
     * è·å–å€¼åˆ—è¡¨
     *
     * @return
     */
    public static List<String> getValues() {
        return Arrays.stream(values()).map(item -> item.value).collect(Collectors.toList());
    }

    /**
     * æ ¹æ® value è·å–æšä¸¾
     *
     * @param value
     * @return
     */
    public static QuestionSubmitLanguageEnum getEnumByValue(String value) {
        if (ObjectUtils.isEmpty(value)) {
            return null;
        }
        for (QuestionSubmitLanguageEnum anEnum : QuestionSubmitLanguageEnum.values()) {
            if (anEnum.value.equals(value)) {
                return anEnum;
            }
        }
        return null;
    }

    public String getValue() {
        return value;
    }

    public String getText() {
        return text;
    }
}
```

ç¼–å†™å¥½åŸºæœ¬ä»£ç åï¼Œè®°å¾—é€šè¿‡ Swagger æˆ–è€…ç¼–å†™å•å…ƒæµ‹è¯•å»éªŒè¯ã€‚



tips:

ä¸ºäº†é˜²æ­¢ç”¨æˆ·æŒ‰ç…§ id é¡ºåºçˆ¬å–é¢˜ç›®ï¼Œå»ºè®®æŠŠ id çš„ç”Ÿæˆè§„åˆ™æ”¹ä¸º ASSIGN_ID è€Œä¸æ˜¯ä» 1 å¼€å§‹è‡ªå¢

```java
	/**
     * id
     */
    @TableId(type = IdType.ASSIGN_ID)
    private Long id;
```



#### æŸ¥è¯¢æäº¤ä¿¡æ¯

åŠŸèƒ½ï¼šèƒ½å¤Ÿæ ¹æ®ç”¨æˆ· id ã€é¢˜ç›® idã€ç¼–ç¨‹è¯­è¨€ï¼Œå»æŸ¥è¯¢æäº¤è®°å½•

æ³¨æ„äº‹é¡¹ï¼šä»…æœ¬äººå’Œç®¡ç†å‘˜èƒ½çœ‹è§è‡ªå·±ï¼ˆæäº¤ userId å’Œç™»å½• userId ä¸åŒï¼‰æäº¤çš„ä»£ç 



å®ç°æ–¹æ¡ˆï¼šå…ˆæŸ¥è¯¢ï¼Œå†æ ¹æ®æƒé™å»è„±æ•

```java
@Override
public QuestionSubmitVO getQuestionSubmitVO(QuestionSubmit questionSubmit, User loginUser) {
    QuestionSubmitVO questionSubmitVO = QuestionSubmitVO.objToVo(questionSubmit);
    // è„±æ•ï¼šä»…æœ¬äººå’Œç®¡ç†å‘˜èƒ½çœ‹è§è‡ªå·±ï¼ˆæäº¤ userId å’Œç™»å½• userId ä¸åŒï¼‰æäº¤çš„ä»£ç 
    long userId = loginUser.getId();
    if (userId != questionSubmit.getUserId() && !userService.isAdmin(loginUser)){
        questionSubmitVO.setCode(null);
    }
    return questionSubmitVO;
}
```









## ä¸‰æœŸ



### è®¡åˆ’

å‰ç«¯å¼€å‘ä¸ºä¸»ï¼š

1ï¼‰ç”¨æˆ·æ³¨å†Œé¡µé¢

2ï¼‰åˆ›å»ºé¢˜ç›®é¡µé¢ï¼ˆç®¡ç†å‘˜ï¼‰

3ï¼‰é¢˜ç›®ç®¡ç†é¡µé¢ï¼ˆç®¡ç†å‘˜ï¼‰

* æŸ¥çœ‹
* åˆ é™¤
* ä¿®æ”¹
* å¿«æ·åˆ›å»º

4ï¼‰é¢˜ç›®åˆ—è¡¨é¡µï¼ˆç”¨æˆ·ï¼‰

5ï¼‰é¢˜ç›®è¯¦æƒ…é¡µ

* åˆ¤é¢˜çŠ¶æ€æŸ¥çœ‹

6ï¼‰é¢˜ç›®æäº¤åˆ—è¡¨é¡µ



> æ‰©å±•ï¼šæäº¤ç»Ÿè®¡é¡µã€ç”¨æˆ·ä¸ªäººé¡µ



### æ¥å…¥è¦ç”¨åˆ°çš„ç»„ä»¶

å…ˆæ¥å…¥å¯èƒ½è¦ç”¨çš„ç»„ä»¶ï¼Œå†å»å†™é¡µé¢ï¼Œé¿å…å› ä¸ºåç»­ä¾èµ–å†²çªã€æ•´åˆç»„ä»¶å¤±è´¥å¸¦æ¥çš„è¿”å·¥



#### Markdown ç¼–è¾‘å™¨

ä¸€å¥—é€šç”¨çš„æ–‡æœ¬ç¼–è¾‘è¯­æ³•ï¼Œå¯ä»¥åœ¨å„å¤§ç½‘ç«™ä¸ŠåŒæ„æ ‡å‡†ã€æ¸²æŸ“å‡ºç»Ÿä¸€çš„æ ·å¼ï¼Œæ¯”è¾ƒç®€å•ä¸€äº›



[å¼€æºç¼–è¾‘å™¨ bytemd](https://github.com/bytedance/bytemd)

é˜…è¯»å®˜æ–¹æ–‡æ¡£ï¼Œä¸‹è½½ç¼–è¾‘å™¨ä¸»ä½“ã€gfmï¼ˆè¡¨æ ¼æ”¯æŒï¼‰æ’ä»¶ã€highlightï¼ˆä»£ç é«˜äº®ï¼‰æ’ä»¶

```shell
npm install @bytemd/vue-next
npm install @bytemd/plugin-gfm
npm install @bytemd/plugin-highlight
```

æ–°å»º MdEdior ç»„ä»¶ï¼Œç¼–å†™ä»£ç ï¼š

```vue
<template>
  <Editor :value="value" :plugins="plugins" @change="handleChange" />
</template>

<script setup lang="ts">
import gfm from "@bytemd/plugin-gfm";
import highlight from "@bytemd/plugin-highlight";
import { Editor, Viewer } from "@bytemd/vue-next";
import { ref } from "vue";

const plugins = [
  gfm(),
  highlight(),
  // Add more plugins here
];

const value = ref("");
const handleChange = (v: string) => {
  value.value = v;
};
</script>
```



éšè—ç¼–è¾‘å™¨ä¸­ä¸éœ€è¦çš„æ“ä½œå›¾æ ‡ï¼š

```css
.bytemd-toolbar-icon.bytemd-tippy.bytemd-tippy-right:last-child {
    display: none;
}
```



è¦æŠŠ MdEditor å½“å‰è¾“å…¥çš„å€¼æš´éœ²ç»™çˆ¶ç»„ä»¶ï¼Œä¾¿äºçˆ¶ç»„ä»¶å»ä½¿ç”¨ï¼ŒåŒæ—¶ä¹Ÿæ˜¯æé«˜ç»„ä»¶çš„é€šç”¨æ€§ï¼Œéœ€è¦å®šä¹‰å±æ€§ï¼ŒæŠŠ value å’Œ handleChange äº‹ä»¶äº¤ç»™çˆ¶ç»„ä»¶å»ç®¡ç†

MdEditor.vueï¼š

```ts
/**
 * å®šä¹‰ç»„ä»¶å±æ€§ç±»å‹
 */
interface Props {
  value: string;
  handleChange: (v: string) => void;
}

/**
 * ç»™ç»„ä»¶æŒ‡å®šåˆå§‹å€¼
 */
const props = withDefaults(defineProps<Props>(), {
  value: () => "",
  handleChange: (v: string) => {
    console.log(v);
  },
});
```



#### ä»£ç ç¼–è¾‘å™¨

å¾®è½¯å®˜æ–¹ç¼–è¾‘å™¨ï¼š[microsoft/monaco-editor](https://github.com/microsoft/monaco-editor)

å®˜æ–¹æ•™ç¨‹ï¼š[monaco-editor/docs/integrate-esm.md](https://github.com/microsoft/monaco-editor/blob/main/docs/integrate-esm.md)

1ï¼‰å®‰è£…ç¼–è¾‘å™¨

```shell
npm install monaco-editor
```

2ï¼‰vue-cli é¡¹ç›®ï¼ˆwebpacké¡¹ç›®ï¼‰æ•´åˆ monaco-editor

å…ˆå®‰è£…[monaco-editor-webpack-plugin](https://github.com/microsoft/monaco-editor/tree/main/webpack-plugin)

```shell
npm install monaco-editor-webpack-plugin
```

åœ¨ vue.config.js ä¸­é…ç½® webpack æ’ä»¶ï¼š

å…¨é‡åŠ è½½ï¼š

```ts
const { defineConfig } = require("@vue/cli-service");
const MonacoWebpackPlugin = require("monaco-editor-webpack-plugin");

module.exports = defineConfig({
  transpileDependencies: true,
  lintOnSave: false, //å…³é—­eslintæ ¡éªŒ
  chainWebpack(config) {
    config.plugin("monaco").use(new MonacoWebpackPlugin());
  },
});
```

æŒ‰éœ€åŠ è½½ï¼š

```ts
module.exports = defineConfig({
  chainWebpack: (config) => {
    config.plugin("monaco-editor").use(MonacoWebpackPlugin, [
      {
        // Languages are loaded on demand at runtime
        languages: ['json', 'go', 'css', 'html', 'java', 'javascript', 'less', 'markdown', 'mysql', 'php', 'python', 'scss', 'shell', 'redis', 'sql', 'typescript', 'xml'], // ['abap', 'apex', 'azcli', 'bat', 'cameligo', 'clojure', 'coffee', 'cpp', 'csharp', 'csp', 'css', 'dart', 'dockerfile', 'ecl', 'fsharp', 'go', 'graphql', 'handlebars', 'hcl', 'html', 'ini', 'java', 'javascript', 'json', 'julia', 'kotlin', 'less', 'lexon', 'lua', 'm3', 'markdown', 'mips', 'msdax', 'mysql', 'objective-c', 'pascal', 'pascaligo', 'perl', 'pgsql', 'php', 'postiats', 'powerquery', 'powershell', 'pug', 'python', 'r', 'razor', 'redis', 'redshift', 'restructuredtext', 'ruby', 'rust', 'sb', 'scala', 'scheme', 'scss', 'shell', 'solidity', 'sophia', 'sql', 'st', 'swift', 'systemverilog', 'tcl', 'twig', 'typescript', 'vb', 'xml', 'yaml'],

        features: ['format', 'find', 'contextmenu', 'gotoError', 'gotoLine', 'gotoSymbol', 'hover' , 'documentSymbols'] //['accessibilityHelp', 'anchorSelect', 'bracketMatching', 'caretOperations', 'clipboard', 'codeAction', 'codelens', 'colorPicker', 'comment', 'contextmenu', 'coreCommands', 'cursorUndo', 'dnd', 'documentSymbols', 'find', 'folding', 'fontZoom', 'format', 'gotoError', 'gotoLine', 'gotoSymbol', 'hover', 'iPadShowKeyboard', 'inPlaceReplace', 'indentation', 'inlineHints', 'inspectTokens', 'linesOperations', 'linkedEditing', 'links', 'multicursor', 'parameterHints', 'quickCommand', 'quickHelp', 'quickOutline', 'referenceSearch', 'rename', 'smartSelect', 'snippets', 'suggest', 'toggleHighContrast', 'toggleTabFocusMode', 'transpose', 'unusualLineTerminators', 'viewportSemanticTokens', 'wordHighlighter', 'wordOperations', 'wordPartOperations']
      }
    ]);
  },
});
```



å®˜æ–¹ç¤ºä¾‹æ•™ç¨‹ï¼š[Monaco Editor](https://microsoft.github.io/monaco-editor/playground.html?source=v0.50.0#example-creating-the-editor-hello-world)

æŠ€æœ¯åšå®¢å‚è€ƒï¼š[vsCode ä¹‹ Monaco Editor åœ¨ vue-cli3.0 ä¸­çš„ä½¿ç”¨æ–¹æ³•](http://zhenglinglu.cn/pages/e488ab/)

æ³¨æ„ï¼Œ monaco editor åœ¨è¯»å†™å€¼çš„æ—¶å€™ï¼Œè¦ä½¿ç”¨ toRawï¼ˆç¼–è¾‘å™¨å®ä¾‹ï¼‰çš„è¯­æ³•æ¥æ‰§è¡Œæ“ä½œï¼Œå¦åˆ™ä¼šå¡æ­»

CodeEditor.vueï¼š

```vue
<template>
  <div id="code-editor" ref="codeEditorRef" style="min-height: 400px" />
  {{ value }}
  <a-button @click="fillValue">å¡«å……å€¼</a-button>
</template>

<script setup lang="ts">
import * as monaco from "monaco-editor";
import { onMounted, ref, toRaw } from "vue";

const codeEditorRef = ref();
const codeEditor = ref();
const value = ref("hello world");

const fillValue = () => {
  if (!codeEditor.value) {
    return;
  }
  toRaw(codeEditor.value).setValue("æ–°çš„å€¼");
};

onMounted(() => {
  if (!codeEditorRef.value) {
    return;
  }
  // Hover on each property to see its docs!
  codeEditor.value = monaco.editor.create(codeEditorRef.value, {
    value: value.value,
    language: "java",
    automaticLayout: true,
    colorDecorators: true,
    minimap: {
      enabled: true,
    },
    readOnly: false,
    theme: "vs",
    // lineNumbers: "off",
    // roundedSelection: false,
    // scrollBeyondLastLine: false,
  });

  // ç¼–è¾‘ ç›‘å¬å†…å®¹å˜åŒ–
  codeEditor.value.onDidChangeModelContent(() => {
    console.log("ç›®å‰å†…å®¹ä¸ºï¼š", toRaw(codeEditor.value).getValue());
  });
});
</script>
```

åŒ Md ç¼–è¾‘å™¨ä¸€æ ·ï¼Œä¹Ÿè¦æ¥æ”¶çˆ¶ç»„ä»¶çš„ä¼ å€¼ã€æŠŠæ˜¾ç¤ºçš„è¾“å…¥äº¤ç»™çˆ¶ç»„ä»¶å»æ§åˆ¶ï¼Œè®©çˆ¶ç»„ä»¶å®æ—¶å¾—åˆ°ç”¨æˆ·è¾“å…¥çš„ä»£ç ï¼š

```ts
/**
 * å®šä¹‰ç»„ä»¶å±æ€§ç±»å‹
 */
interface Props {
  value: string;
  handleChange: (v: string) => void;
}

/**
 * ç»™ç»„ä»¶æŒ‡å®šåˆå§‹å€¼
 */
const props = withDefaults(defineProps<Props>(), {
  value: () => "",
  handleChange: (v: string) => {
    console.log(v);
  },
});
```



> é¡¹ç›®æ‰©å±•ï¼šç”¨ diff editor å¯¹æ¯”ç”¨æˆ·ä»£ç å’Œæ ‡å‡†ç­”æ¡ˆçš„åŒºåˆ«





### é¡µé¢å¼€å‘



#### åˆ›å»ºé¢˜ç›®é¡µé¢

é‡æ–°æ ¹æ®åç«¯ç”Ÿæˆå‰ç«¯è¯·æ±‚ä»£ç ï¼š

```shell
node node_modules/openapi-typescript-codegen/bin/index.js --input http://localhost:8121/api/v2/api-docs --output ./generated --client axios
```

é‡æ–°ç”Ÿæˆåè¦è®°å¾—ä¿®æ”¹ OpenAPI.tsä¸­çš„ WITH_CREDENTIALS ä¸º true é˜²æ­¢æ— æ³•ç™»å½•



éœ€è¦ç”¨æˆ·è¾“å…¥çš„å€¼

```js
{
  "answer": "ç­”æ¡ˆ",
  "content": "å†…å®¹",
  "judgeCase": [
    {
      "input": "1 2",
      "output": "3 4"
    }
  ],
  "judgeConfig": {
    "memoryLimit": 1000,
    "stackLimit": 1000,
    "timeLimit": 1000
  },
  "tags": ["æ ˆ"],
  "title": "A"
}
```



tips:

vscode ä¸­è‡ªå®šä¹‰ä»£ç æ¨¡æ¿ï¼šæ–‡ä»¶=>é¦–é€‰é¡¹=>é…ç½®ä»£ç ç‰‡æ®µ=>æ–°å»ºå…¨å±€ä»£ç ç‰‡æ®µæ–‡ä»¶

```ts
{
	// Place your å…¨å±€ snippets here. Each snippet is defined under a snippet name and has a scope, prefix, body and 
	// description. Add comma separated ids of the languages where the snippet is applicable in the scope field. If scope 
	// is left empty or omitted, the snippet gets applied to all languages. The prefix is what is 
	// used to trigger the snippet and the body will be expanded and inserted. Possible variables are: 
	// $1, $2 for tab stops, $0 for the final cursor position, and ${1:label}, ${2:another} for placeholders. 
	// Placeholders with the same ids are connected.
	// Example:
	"Print to console": {
		"scope": "vue,javascript,typescript",
		"prefix": "myvuepage",
		"body": [
			"<template>",
			"\t<div id=\"$1${TM_FILENAME_BASE}\"></div>",
			"</template>",
			"",
			"<script setup lang=\"ts\">",
			"$2",
			"</script>",
			"",
			"<style scoped>",
			"#$1${TM_FILENAME_BASE} {",
			"",
			"}",
			"</style>",
		],
		"description": "æˆ‘çš„vueæ¨¡æ¿é¡µé¢"
	}
}
```

åœ¨éœ€è¦ä½¿ç”¨çš„åœ°æ–¹è¾“å…¥è®¾ç½®çš„ prefix å³ myvuepage å³å¯ç”Ÿæˆ body ä¸­çš„æ¨¡æ¿ä»£ç 



ä½¿ç”¨è¡¨å•ç»„ä»¶ï¼Œå…ˆå¤åˆ¶ç¤ºä¾‹ä»£ç ï¼Œå†ä¿®æ”¹ï¼š[ArcoDesign Formè¡¨å•](https://arco.design/vue/component/form)

æ­¤å¤„æˆ‘ä»¬ç”¨åˆ°äº†åµŒå¥—è¡¨å•å’ŒåŠ¨æ€å¢å‡è¡¨å•ï¼š[ArcoDesign åµŒå¥—æ•°æ®](https://arco.design/vue/component/form#nest)	[ArcoDesign åŠ¨æ€è¡¨å•](https://arco.design/vue/component/form#dynamic)



æ³¨æ„ï¼Œæˆ‘ä»¬è‡ªå®šä¹‰çš„ä»£ç ç¼–è¾‘å™¨ä¸ä¼šè¢«ç»„ä»¶åº“è¯†åˆ«ï¼Œéœ€è¦æ‰‹åŠ¨æŒ‡å®š value å’Œ handleChange å‡½æ•°





#### é¢˜ç›®ç®¡ç†é¡µé¢

1ï¼‰ä½¿ç”¨è¡¨æ ¼ç»„ä»¶ï¼š[ArcoDesign Table](https://arco.design/vue/component/table#custom)ï¼ˆéœ€è¦æ‰¾åˆ°è‡ªå®šä¹‰æ“ä½œçš„ç¤ºä¾‹ï¼‰

2ï¼‰æŸ¥è¯¢æ•°æ®

3ï¼‰å®šä¹‰è¡¨æ ¼åˆ—

4ï¼‰åŠ è½½æ•°æ®

5ï¼‰è°ƒæ•´æ ¼å¼

æ¯”å¦‚ json æ ¼å¼ä¸å¥½çœ‹ï¼Œæœ‰ä¸¤ç§æ–¹æ³•è°ƒæ•´ï¼š

1. ä½¿ç”¨ç»„ä»¶åº“è‡ªå¸¦çš„è¯­æ³•ï¼Œè‡ªåŠ¨æ ¼å¼åŒ–
2. å®Œå…¨è‡ªå®šä¹‰æ¸²æŸ“ï¼Œæƒ³å±•ç¤ºä»€ä¹ˆå°±å±•ç¤ºä»€ä¹ˆ

6ï¼‰æ·»åŠ åˆ é™¤ã€æ›´æ–°æ“ä½œ

åˆ é™¤åæ›´æ–°ï¼šæ‰§è¡Œ loadData åˆ·æ–°





#### æ›´æ–°é¡µé¢å¼€å‘

ç­–ç•¥ï¼šç”±äºæ›´æ–°å’Œåˆ›å»ºéƒ½æ˜¯ç›¸åŒçš„è¡¨å•ï¼Œå®Œå…¨æ²¡å¿…è¦å¼€å‘/å¤åˆ¶ä¸¤éï¼Œå¯ä»¥ç›´æ¥å¤ç”¨é¡µé¢

åŒºåˆ†ä¸¤ä¸ªé¡µé¢ï¼š

1. è·¯ç”±ï¼ˆ/add/question å’Œ /update/questionï¼‰
2. è¯·æ±‚å‚æ•°ï¼ˆ id=1 ï¼‰



æ›´æ–°é¡µé¢ç›¸è¾ƒäºåˆ›å»ºé¡µé¢ï¼š

1ï¼‰åœ¨åŠ è½½é¡µé¢æ—¶ï¼Œæ›´æ–°é¡µé¢è¦åŠ è½½ä¹‹å‰çš„æ•°æ®

2ï¼‰åœ¨æäº¤æ—¶ï¼Œè¯·æ±‚çš„åœ°å€ä¸åŒ







## å››æœŸ

### è®¡åˆ’

1. å‰ç«¯é¡µé¢å¼€å‘ï¼ˆé¢˜ç›®æµè§ˆé¡µã€é¢˜ç›®åˆ—è¡¨æœç´¢é¡µï¼‰
2. åç«¯åˆ¤é¢˜æ¨¡å—çš„é¢„å¼€å‘ï¼ˆ 2 - 4 ç§è®¾è®¡æ¨¡å¼ï¼‰ï¼Œè·‘é€šæ•´ä¸ªé¡¹ç›®çš„å‰åç«¯æµç¨‹



### å‰ç«¯é¡µé¢å¼€å‘

#### ç°æœ‰ä»£ç ä¼˜åŒ–

1ï¼‰å…ˆå¤„ç†èœå•é¡¹çš„æƒé™æ§åˆ¶å’Œæ˜¾ç¤ºéšè—

å¦‚æ›´æ–°é¢˜ç›®ï¼š

```ts
{
    path: "/update/question",
    name: "æ›´æ–°é¢˜ç›®",
    component: AddQuestionView,
    meta: {
      access: [ACCESS_ENUM.USER, ACCESS_ENUM.ADMIN],
      hideInMenu: true,
    },
  },
```



2ï¼‰ç®¡ç†é¡µé¢åˆ†é¡µé—®é¢˜çš„ä¿®å¤

åœ¨åˆ†é¡µé¡µå·æ”¹å˜æ—¶ï¼Œè§¦å‘äº‹ä»¶ @page-change ï¼Œæ”¹å˜ searchParams çš„å€¼ï¼Œå¹¶ä¸”é€šè¿‡ watchEffect ç›‘å¬ searchParams çš„æ”¹å˜ï¼Œå®ç°äº†é¡µå·å˜åŒ–æ—¶è§¦å‘æ•°æ®çš„é‡æ–°åŠ è½½



3ï¼‰ä¿®å¤åˆ·æ–°é¡µé¢æœªç™»å½•çš„é—®é¢˜

src/access/index.tsï¼š

```ts
if (!loginUser || !loginUser.userRole) {
    // åŠ awaitæ˜¯ä¸ºäº†ç­‰ç”¨æˆ·ç™»å½•æˆåŠŸä¹‹åï¼Œå†æ‰§è¡Œåç»­çš„ä»£ç 
    await store.dispatch("user/getLoginUser");
    loginUser = store.state.user.loginUser;
  }
```



#### é¢˜ç›®åˆ—è¡¨æœç´¢é¡µ

è¡¨æ ¼ç»„ä»¶ï¼š[ArcoDesign Table](https://arco.design/vue/component/table#custom)

1ï¼‰å¤åˆ¶ç®¡ç†é¢˜ç›®é¡µçš„è¡¨æ ¼

2ï¼‰ä¿ç•™éœ€è¦çš„ columns å­—æ®µ

3ï¼‰è‡ªå®šä¹‰è¡¨æ ¼åˆ—çš„æ¸²æŸ“

æ ‡ç­¾ï¼šä½¿ç”¨ Tags ç»„ä»¶

é€šè¿‡ç‡ï¼šè‡ªè¡Œè®¡ç®—

åˆ›å»ºæ—¶é—´ï¼šä½¿ç”¨ moment åº“è¿›è¡Œæ ¼å¼åŒ–ï¼š[Moment.js | Docs](https://momentjs.com/docs/#/displaying/)

æ“ä½œæŒ‰é’®ï¼šè¡¥å……è·³è½¬åˆ°åšé¢˜é¡µé¢ toQuestionPage

4ï¼‰ç¼–å†™æœç´¢è¡¨å•ï¼Œä½¿ç”¨ form çš„ layout = inline å¸ƒå±€ï¼Œè®©ç”¨æˆ·çš„è¾“å…¥å’Œ searchParams åŒæ­¥ï¼Œå¹¶ä¸”ç»™æœç´¢æŒ‰é’®ç»‘å®šä¿®æ”¹ searchParamsï¼Œè¢« watchEffect ç›‘å¬åˆ°ï¼Œè§¦å‘æŸ¥è¯¢



#### é¢˜ç›®æµè§ˆé¡µ

1ï¼‰å…ˆå®šä¹‰åŠ¨æ€å‚æ•°è·¯ç”±ï¼Œå¼€å¯ props ä¸º true ï¼Œå¯ä»¥åœ¨é¡µé¢çš„ props ä¸­ç›´æ¥è·å–åˆ°åŠ¨æ€å‚æ•°ï¼ˆé¢˜ç›® idï¼‰

```ts
{
    path: "/view/question/:id",
    name: "åœ¨çº¿åšé¢˜",
    component: ViewQuestionView,
    props: true,
    meta: {
      access: [ACCESS_ENUM.USER, ACCESS_ENUM.ADMIN],
      hideInMenu: true,
    },
  },
```



2ï¼‰å®šä¹‰å¸ƒå±€ï¼šå·¦ä¾§æ˜¯é¢˜ç›®ä¿¡æ¯ï¼Œå³ä¾§æ˜¯ä»£ç ç¼–è¾‘å™¨

é¢˜ç›®ä¿¡æ¯ï¼š

* tabs åˆ‡æ¢å±•ç¤ºçš„å†…å®¹
* å®šä¹‰ MdViewer ç»„ä»¶å±•ç¤ºé¢˜ç›®å†…å®¹
* ä½¿ç”¨ descriptions ç»„ä»¶å±•ç¤ºåˆ¤é¢˜é…ç½® [ArcoDesign Descriptions](https://arco.design/vue/component/descriptions)

ä»£ç ç¼–è¾‘å™¨ï¼š

* ä½¿ç”¨ select ç»„ä»¶è®©ç”¨æˆ·é€‰æ‹©ç¼–ç¨‹è¯­è¨€
* åœ¨ä»£ç ç¼–è¾‘å™¨ä¸­ç›‘å¬å±æ€§çš„å˜åŒ–ï¼Œæ³¨æ„ç›‘å¬ props è¦ä½¿ç”¨ç®­å¤´å‡½æ•°[vue3ä½¿ç”¨watchç›‘å¬propsä¸¤å¤§å‘](https://www.jianshu.com/p/3570b7df3d1f)

> todoï¼šä»£ç ç¼–è¾‘å™¨æ²¡æœ‰æ›´æ”¹è¯­è¨€





### åˆ¤é¢˜æœºæ¨¡å—é¢„å¼€å‘

ç›®çš„ï¼šè·‘é€šå®Œæ•´çš„ä¸šåŠ¡æµç¨‹



#### æ¢³ç†åˆ¤é¢˜æ¨¡å—å’Œä»£ç æ²™ç®±çš„å…³ç³»

åˆ¤é¢˜æ¨¡å—ï¼šè°ƒç”¨ä»£ç æ²™ç®±ï¼ŒæŠŠä»£ç å’Œè¾“å…¥äº¤ç»™ä»£ç æ²™ç®±å»æ‰§è¡Œ

ä»£ç æ²™ç®±ï¼šåªè´Ÿè´£æ¥æ”¶ä»£ç å’Œè¾“å…¥ï¼Œè¿”å›ç¼–è¯‘è¿è¡Œçš„ç»“æœï¼Œä¸è´Ÿè´£åˆ¤é¢˜

è¿™ä¸¤ä¸ªæ¨¡å—å®Œå…¨è§£è€¦

![image-20240829193549686](C:\Users\xtt\AppData\Roaming\Typora\typora-user-images\image-20240829193549686.png)

> ä¸ºä»€ä¹ˆä»£ç æ²™ç®±è¦æ¥æ”¶å’Œè¾“å‡ºä¸€ç»„è¿è¡Œç”¨ä¾‹ï¼Ÿ
>
> å‰æï¼šæˆ‘ä»¬çš„æ¯é“é¢˜ç›®æœ‰å¤šç»„æµ‹è¯•ç”¨ä¾‹
>
> å¦‚æœæ˜¯æ¯ä¸ªç”¨ä¾‹å•ç‹¬è°ƒç”¨ä¸€æ¬¡ä»£ç æ²™ç®±ï¼Œä¼šè°ƒç”¨å¤šæ¬¡æ¥å£ã€éœ€è¦å¤šæ¬¡ç½‘ç»œä¼ è¾“ã€ç¨‹åºè¦å¤šæ¬¡ç¼–è¯‘ã€è®°å½•ç¨‹åºçš„æ‰§è¡ŒçŠ¶æ€ï¼ˆé‡å¤çš„ä»£ç ä¸é‡å¤ç¼–è¯‘ï¼‰
>
> è¿™æ˜¯ä¸€ç§å¾ˆå¸¸è§çš„æ€§èƒ½ä¼˜åŒ–æ–¹æ³•ï¼æ‰¹å¤„ç†



#### ä»£ç æ²™ç®±å¼€å‘

1ï¼‰å®šä¹‰ä»£ç æ²™ç®±çš„æ¥å£ï¼Œæé«˜é€šç”¨æ€§ï¼Œä¹‹åæˆ‘ä»¬çš„é¡¹ç›®ä»£ç åªè°ƒç”¨æ¥å£ï¼Œä¸è°ƒç”¨å…·ä½“çš„å®ç°ç±»ï¼Œä½¿ç”¨å…¶ä»–çš„ä»£ç æ²™ç®±å®ç°ç±»æ—¶ï¼Œå°±ä¸ç”¨å»ä¿®æ”¹åç§°ï¼Œä¾¿äºæ‰©å±•ã€‚

> ä»£ç æ²™ç®±çš„è¯·æ±‚æ¥å£ä¸­ï¼ŒtimeLimit å¯åŠ æˆ–ä¸åŠ ï¼Œå¯è‡ªè¡Œæ‰©å±•ï¼Œå³æ—¶ä¸­æ–­ç¨‹åº

æ‰©å±•æ€è·¯ï¼šå¢åŠ ä¸€ä¸ªæŸ¥çœ‹ä»£ç æ²™ç®±çŠ¶æ€çš„æ¥å£



2ï¼‰å®šä¹‰å¤šç§ä¸åŒçš„ä»£ç æ²™ç®±å®ç°ï¼š

* ç¤ºä¾‹ä»£ç æ²™ç®±ï¼šä»…ä¸ºäº†è·‘é€šä¸šåŠ¡æµç¨‹

* è¿œç¨‹ä»£ç æ²™ç®±ï¼šå®é™…è°ƒç”¨æ¥å£çš„æ²™ç®±

* ç¬¬ä¸‰æ–¹ä»£ç æ²™ç®±ï¼šè°ƒç”¨ç½‘ä¸Šç°æˆçš„ä»£ç æ²™ç®± [criyle/go-judge: Sandbox Server in REST / gRPC API](https://github.com/criyle/go-judge)



3ï¼‰ç¼–å†™å•å…ƒæµ‹è¯•ï¼ŒéªŒè¯å•ä¸ªä»£ç æ²™ç®±çš„æ‰§è¡Œ

```java
@SpringBootTest
class CodeSandboxTest {

    @Test
    void executeCode() {
        CodeSandbox codeSandbox = new ExampleCodeSandbox();
        String code = "int main() { }";
        String language = QuestionSubmitLanguageEnum.JAVA.getValue();
        List<String> inputList = Arrays.asList("1 2","3 4");
        ExecuteCodeRequest executeCodeRequest = ExecuteCodeRequest.builder()
                .code(code)
                .language(language)
                .inputList(inputList)
                .build();
        ExecuteCodeResponse executeCodeResponse = codeSandbox.executeCode(executeCodeRequest);
        Assertions.assertNotNull(executeCodeResponse);
    }
}
```



ç°åœ¨çš„é—®é¢˜åœ¨äº new æŸä¸ªæ²™ç®±çš„ä»£ç æ˜¯å†™æ­»çš„ï¼Œå¦‚æœé¡¹ç›®è¦æ”¹ç”¨å…¶ä»–æ²™ç®±ï¼Œå¯èƒ½éœ€è¦ä¿®æ”¹å¾ˆå¤šçš„ä»£ç 



4ï¼‰ä½¿ç”¨å·¥å‚æ¨¡å¼ï¼Œæ ¹æ®ç”¨æˆ·ä¼ å…¥çš„å­—ç¬¦ä¸²å‚æ•°ï¼Œæ¥ç”Ÿæˆå¯¹åº”çš„ä»£ç æ²™ç®±å®ç°ç±»

æ­¤å¤„ä½¿ç”¨é™æ€å·¥å‚æ¨¡å¼ï¼Œå®ç°æ¯”è¾ƒç®€å•ï¼Œç¬¦åˆéœ€æ±‚

```java
/**
 * ä»£ç æ²™ç®±åˆ›å»ºå·¥å‚ï¼ˆæ ¹æ®å­—ç¬¦ä¸²å‚æ•°åˆ›å»ºæŒ‡å®šçš„ä»£ç æ²™ç®±å®ä¾‹ï¼‰
 */
public class CodeSandboxFactory {

    /**
     * åˆ›å»ºä»£ç æ²™ç®±å®ä¾‹
     *
     * @param type æ²™ç®±ç±»å‹
     * @return
     */
    public static CodeSandbox newInstance(String type) {
        switch (type) {
            case "example":
                return new ExampleCodeSandbox();
            case "remote":
                return new RemoteCodeSandbox();
            case "thirdParty":
                return new ThirdPartyCodeSandbox();
            default:
                return new ExampleCodeSandbox();
        }
    }
}
```

> æ‰©å±•æ€è·¯ï¼šå¦‚æœç¡®å®šä»£ç æ²™ç®±å®ä¾‹ä¸ä¼šå‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜ã€å¯å¤ç”¨ï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨å•ä¾‹å·¥å‚æ¨¡å¼

ç”±æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥æ ¹æ®å­—ç¬¦ä¸²åŠ¨æ€ç”Ÿæˆå®ä¾‹ï¼Œæé«˜äº†é€šç”¨æ€§ï¼š

```java
public static void main(String[] args) {
        Scanner scanner = new Scanner(System.in);
        while (scanner.hasNext()) {
            String type = scanner.next();
            CodeSandbox codeSandbox = CodeSandboxFactory.newInstance(type);
            String code = "int main() { }";
            String language = QuestionSubmitLanguageEnum.JAVA.getValue();
            List<String> inputList = Arrays.asList("1 2","3 4");
            ExecuteCodeRequest executeCodeRequest = ExecuteCodeRequest.builder()
                    .code(code)
                    .language(language)
                    .inputList(inputList)
                    .build();
            ExecuteCodeResponse executeCodeResponse = codeSandbox.executeCode(executeCodeRequest);
        }
    }
```



5ï¼‰å‚æ•°é…ç½®åŒ–ï¼ŒæŠŠé¡¹ç›®ä¸­çš„ä¸€äº›å¯äº¤ç»™ç”¨æˆ·å»è‡ªå®šä¹‰çš„é€‰é¡¹æˆ–å­—ç¬¦ä¸²ï¼Œå†™åˆ°é…ç½®æ–‡ä»¶ä¸­ã€‚è¿™æ ·å¼€å‘è€…åªéœ€è¦æ”¹é…ç½®æ–‡ä»¶ï¼Œè€Œä¸éœ€è¦å»çœ‹ä½ çš„é¡¹ç›®ä»£ç å°±èƒ½å¤Ÿè‡ªå®šä¹‰ä½¿ç”¨ä½ é¡¹ç›®çš„æ›´å¤šåŠŸèƒ½ã€‚

application.yml é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šå˜é‡ï¼š

```yml
# ä»£ç æ²™ç®±é…ç½®
codesandbox:
  type: remote
```

åœ¨ Spring çš„ Bean ä¸­é€šè¿‡ @Value æ³¨è§£è¯»å–ï¼š

```java
@Value("${codesandbox.type:example}")
private String type;
```



6ï¼‰ä»£ç æ²™ç®±èƒ½åŠ›å¢å¼º

æ¯”å¦‚ï¼šæˆ‘ä»¬éœ€è¦åœ¨è°ƒç”¨ä»£ç æ²™ç®±å‰ï¼Œè¾“å‡ºè¯·æ±‚å‚æ•°æ—¥å¿—ï¼›åœ¨ä»£ç æ²™ç®±è°ƒç”¨åï¼Œè¾“å‡ºå“åº”ç»“æœæ—¥å¿—ï¼Œä¾¿äºç®¡ç†å‘˜å»åˆ†æã€‚

å¯ä½¿ç”¨ä»£ç†æ¨¡å¼ï¼Œæä¾›ä¸€ä¸ª Proxyï¼Œæ¥å¢å¼ºä»£ç æ²™ç®±çš„èƒ½åŠ›ï¼ˆä»£ç†æ¨¡å¼çš„ä½œç”¨å°±æ˜¯å¢å¼ºèƒ½åŠ›ï¼‰

åŸæœ¬ï¼šéœ€è¦ç”¨æˆ·è°ƒç”¨å¤šæ¬¡

<img src="C:\Users\xtt\AppData\Roaming\Typora\typora-user-images\image-20240830223928452.png" alt="image-20240830223928452" style="zoom: 80%;" />

ä½¿ç”¨ä»£ç†åï¼šä¸ä»…ä¸ç”¨æ”¹å˜åŸæœ¬çš„ä»£ç æ²™ç®±å®ç°ç±»ï¼Œè€Œä¸”å¯¹è°ƒç”¨è€…æ¥è¯´ï¼Œè°ƒç”¨æ–¹å¼å‡ ä¹æ²¡æœ‰æ”¹å˜ï¼Œä¹Ÿä¸éœ€è¦åœ¨æ¯ä¸ªè°ƒç”¨æ²™ç®±çš„åœ°æ–¹å»å†™ç»Ÿè®¡ä»£ç 

<img src="C:\Users\xtt\AppData\Roaming\Typora\typora-user-images\image-20240830223954182.png" alt="image-20240830223954182" style="zoom:80%;" />

ä½¿ç”¨æ–¹å¼ï¼š

```java
CodeSandbox codeSandbox = CodeSandboxFactory.newInstance(type);
codeSandbox = new CodeSandboxProxy(codeSandbox);
```



7ï¼‰å®ç°ç¤ºä¾‹çš„ä»£ç æ²™ç®±

```java
/**
 * ç¤ºä¾‹ä»£ç æ²™ç®±ï¼ˆä»…ä¸ºäº†è·‘é€šä¸šåŠ¡æµç¨‹ï¼‰
 */
public class ExampleCodeSandbox implements CodeSandbox {
    @Override
    public ExecuteCodeResponse executeCode(ExecuteCodeRequest executeCodeRequest) {
        List<String> inputList = executeCodeRequest.getInputList();
        ExecuteCodeResponse executeCodeResponse = new ExecuteCodeResponse();
        executeCodeResponse.setOutputList(inputList);
        executeCodeResponse.setMessage("æµ‹è¯•æ‰§è¡ŒæˆåŠŸ");
        executeCodeResponse.setStatus(QuestionSubmitStatusEnum.SUCCEED.getValue());
        JudgeInfo judgeInfo = new JudgeInfo();
        judgeInfo.setMessage(JudgeInfoMessageEnum.ACCEPTED.getText());
        judgeInfo.setMemory(100L);
        judgeInfo.setTime(100L);
        executeCodeResponse.setJudgeInfo(judgeInfo);
        return executeCodeResponse;
    }
}
```



**tips**ï¼šLombok Builder æ³¨è§£

å®ä½“ç±»åŠ ä¸Šï¼š

```java
@Data
@Builder
@NoArgsConstructor
@AllArgsConstructor
public class ExecuteCodeRequest {
    private List<String> inputList;

    private String code;

    private String language;
}
```

å¯ä»¥ä½¿ç”¨é“¾å¼çš„æ–¹å¼æ›´æ–¹ä¾¿åœ°ç»™å¯¹è±¡èµ‹å€¼ï¼š

```java
ExecuteCodeRequest executeCodeRequest = ExecuteCodeRequest.builder()
                .code(code)
                .language(language)
                .inputList(inputList)
                .build();
```



### åˆ¤é¢˜æœåŠ¡å®Œæ•´ä¸šåŠ¡æµç¨‹å®ç°

åˆ¤é¢˜æœåŠ¡ä¸šåŠ¡æµç¨‹ï¼š 

1ï¼‰ä¼ å…¥é¢˜ç›®çš„æäº¤ idï¼Œè·å–åˆ°å¯¹åº”çš„é¢˜ç›®ã€æäº¤ä¿¡æ¯ï¼ˆåŒ…å«ä»£ç ã€ç¼–ç¨‹è¯­è¨€ç­‰ï¼‰

2ï¼‰å¦‚æœé¢˜ç›®æäº¤çŠ¶æ€ä¸ä¸ºç­‰å¾…ä¸­ï¼Œå°±ä¸ç”¨é‡å¤æ‰§è¡Œ

3ï¼‰æ›´æ”¹åˆ¤é¢˜ï¼ˆé¢˜ç›®æäº¤ï¼‰çš„çŠ¶æ€ä¸ºâ€ åˆ¤é¢˜ä¸­ â€œï¼Œé˜²æ­¢é‡å¤æ‰§è¡Œï¼Œä¹Ÿèƒ½è®©ç”¨æˆ·å³æ—¶çœ‹åˆ°çŠ¶æ€

4ï¼‰è°ƒç”¨æ²™ç®±ï¼Œè·å–åˆ°æ‰§è¡Œç»“æœ

5ï¼‰æ ¹æ®æ²™ç®±çš„æ‰§è¡Œç»“æœï¼Œè®¾ç½®é¢˜ç›®çŠ¶æ€å’Œä¿¡æ¯



åˆ¤æ–­é€»è¾‘ï¼š

1. å…ˆåˆ¤æ–­æ²™ç®±æ‰§è¡Œçš„ç»“æœè¾“å‡ºæ•°é‡æ˜¯å¦å’Œé¢„æœŸè¾“å‡ºæ•°é‡ç›¸ç­‰
2. ä¾æ¬¡åˆ¤æ–­æ¯ä¸€é¡¹è¾“å‡ºå’Œé¢„æœŸè¾“å‡ºæ˜¯å¦ç›¸ç­‰
3. åˆ¤æ–­é¢˜ç›®çš„é™åˆ¶æ˜¯å¦ç¬¦åˆè¦æ±‚
4. å¯èƒ½è¿˜æœ‰å…¶ä»–çš„å¼‚å¸¸è¾“å‡º



#### ç­–ç•¥æ¨¡å¼ä¼˜åŒ–åˆ¤é¢˜ä»£ç 

æˆ‘ä»¬çš„åˆ¤é¢˜ç­–ç•¥å¯èƒ½ä¼šæœ‰å¾ˆå¤šç§ï¼Œæ¯”å¦‚ï¼šæˆ‘ä»¬çš„ä»£ç æ²™ç®±æœ¬èº«æ‰§è¡Œç¨‹åºéœ€è¦æ¶ˆè€—æ—¶é—´ï¼Œè¿™ä¸ªæ—¶é—´å¯èƒ½ä¸åŒçš„ç¼–ç¨‹è¯­è¨€æ˜¯ä¸åŒçš„ï¼Œæ¯”å¦‚æ²™ç®±æ‰§è¡Œ Java è¦é¢å¤–èŠ± 10 ç§’

æˆ‘ä»¬å¯ä»¥é‡‡ç”¨ç­–ç•¥æ¨¡å¼ï¼Œé’ˆå¯¹ä¸åŒçš„æƒ…å†µï¼Œå®šä¹‰ç‹¬ç«‹çš„ç­–ç•¥ï¼Œè€Œä¸æ˜¯æŠŠæ‰€æœ‰çš„åˆ¤é¢˜é€»è¾‘ã€if...else ä»£ç å…¨éƒ¨æ··åœ¨ä¸€èµ·å†™



é¦–å…ˆç¼–å†™é»˜è®¤åˆ¤é¢˜æ¨¡å—

å¦‚æœé€‰æ‹©æŸç§åˆ¤é¢˜ç­–ç•¥çš„è¿‡ç¨‹æ¯”è¾ƒå¤æ‚ï¼Œéƒ½å†™åœ¨è°ƒç”¨åˆ¤é¢˜æœåŠ¡çš„ä»£ç ä¸­ï¼Œä»£ç ä¼šè¶Šæ¥è¶Šå¤æ‚ï¼Œä¼šæœ‰å¾ˆå¤š if...elseï¼Œæ‰€ä»¥å»ºè®®å•ç‹¬å†™ä¸€ä¸ªåˆ¤æ–­ç­–ç•¥çš„ç±»

```java
JudgeStrategy judgeStrategy = new DefaultJudgeStrategy();
        if(language.equals("java")){
            judgeStrategy = new JavaLanguageJudgeStrategy();
        }
        JudgeInfo judgeInfo = judgeStrategy.dojudge(judgeContext);
```

å®šä¹‰ JudgeManagerï¼Œç›®çš„æ˜¯å°½é‡ç®€åŒ–å¯¹åˆ¤é¢˜åŠŸèƒ½çš„è°ƒç”¨ï¼Œè®©è°ƒç”¨æ–¹æœ€ç®€å•

```java
/**
 * åˆ¤é¢˜ç®¡ç†ï¼ˆç®€åŒ–è°ƒç”¨ï¼‰
 */
@Service
public class JudgeManager {

    /**
     * æ‰§è¡Œåˆ¤é¢˜
     * @param judgeContext
     * @return
     */
    JudgeInfo dojudge(JudgeContext judgeContext){
        QuestionSubmit questionSubmit = judgeContext.getQuestionSubmit();
        String language = questionSubmit.getLanguage();

        JudgeStrategy judgeStrategy = new DefaultJudgeStrategy();
        if("java".equals(language)){
            judgeStrategy = new JavaLanguageJudgeStrategy();
        }
        return judgeStrategy.dojudge(judgeContext);
    }
}
```





## äº”æœŸ

### è®¡åˆ’

1. å†å²é—®é¢˜ä¿®å¤
2. Java åŸç”Ÿå®ç°ä»£ç æ²™ç®±
3. Docker å®ç°ä»£ç æ²™ç®±



### å†å²é—®é¢˜ä¿®å¤

ä»£ç ç¼–è¾‘å™¨åˆ‡æ¢è¯­è¨€å¤±è´¥é—®é¢˜

è§£å†³ï¼šç›‘å¬ language å±æ€§ï¼ŒåŠ¨æ€æ›´æ”¹ç¼–è¾‘å™¨çš„è¯­è¨€

```ts
watch(() => props.language, () => {
  if (codeEditor.value) {
    monaco.editor.setModelLanguage(toRaw(codeEditor.value).getModel(), props.language)
  }
})
```



### ä»£ç æ²™ç®±å®ç°

ä»£ç æ²™ç®±ï¼šåªè´Ÿè´£æ¥æ”¶ä»£ç å’Œè¾“å…¥ï¼Œè¿”å›ç¼–è¯‘è¿è¡Œçš„ç»“æœï¼Œä¸è´Ÿè´£åˆ¤é¢˜ï¼ˆå¯ä½œä¸ºç‹¬ç«‹çš„é¡¹ç›®/æœåŠ¡ï¼Œæä¾›ç»™å…¶ä»–çš„éœ€è¦æ‰§è¡Œä»£ç çš„é¡¹ç›®å»ä½¿ç”¨ï¼‰

ä»¥ Java ç¼–ç¨‹è¯­è¨€ä¸ºä¸»ï¼Œå®ç°ä»£ç æ²™ç®±ï¼Œé‡è¦çš„æ˜¯å­¦æ€æƒ³ã€å­¦å…³é”®æµç¨‹

> æ‰©å±•ï¼šå¯ä»¥è‡ªè¡Œå®ç° C++ è¯­è¨€çš„ä»£ç æ²™ç®±



æ–°å»ºä¸€ä¸ª Spring Boot Web é¡¹ç›®ï¼Œæœ€ç»ˆè¿™ä¸ªé¡¹ç›®è¦æä¾›ä¸€ä¸ªèƒ½å¤Ÿæ‰§è¡Œä»£ç ã€æ“ä½œä»£ç æ²™ç®±çš„æ¥å£

é€‰æ‹© java 8ï¼Œspringboot 2.7

ç¼–å†™å¯åŠ¨é…ç½®ï¼š

```yaml
server:
  port: 8090
```

ç¼–å†™æµ‹è¯•æ¥å£ï¼ŒéªŒè¯èƒ½å¦è®¿é—®ï¼š

```java
package com.dan.danojcodesandbox.controller;

import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;

@RestController("/")
public class MainController {

    @GetMapping("/health")
    public String healthCheck() {
        return "OK";
    }
}
```



#### Java åŸç”Ÿå®ç°ä»£ç æ²™ç®±

åŸç”Ÿï¼šå°½å¯èƒ½ä¸å€ŸåŠ©ç¬¬ä¸‰æ–¹åº“å’Œä¾èµ–ï¼Œç”¨æœ€å¹²å‡€ã€æœ€åŸå§‹çš„æ–¹å¼å®ç°ä»£ç æ²™ç®±

ä»£ç æ²™ç®±éœ€è¦ï¼šæ¥æ”¶ä»£ç  => ç¼–è¯‘ä»£ç ï¼ˆjavacï¼‰ => æ‰§è¡Œä»£ç ï¼ˆjavaï¼‰



ç¼–å†™ç¤ºä¾‹ä»£ç ï¼Œæ³¨æ„è¦å»åŒ…åï¼Œæ”¾åˆ° resources ç›®å½•ä¸‹ï¼š

```java
public class SimpleCompute {
    public static void main(String[] args) {
        int a = Integer.parseInt(args[0]);
        int b = Integer.parseInt(args[1]);
        System.out.println("ç»“æœ:" + (a + b));
    }
}
```



ç¼–è¯‘ä»£ç ï¼š

```shell
javac .\SimpleCompute.java
```

ç¼–è¯‘åçš„ç¨‹åºä¸­æ–‡ä¹±ç ï¼š

å‘½ä»¤è¡Œç»ˆç«¯çš„ç¼–ç æ˜¯ GBKï¼Œå’Œ java ä»£ç æ–‡ä»¶æœ¬èº«çš„ç¼–ç  UTF-8 ä¸ä¸€è‡´ï¼Œå¯¼è‡´ä¹±ç 

åœ¨ javac ååŠ  -encoding utf-8 ï¼š

```shell
javac -encoding utf-8 .\SimpleCompute.java
```

æ‰§è¡Œï¼š

```shell
java -cp C:\project\OJ_System\oj-code-sandbox\src\main\resources\testCode\simpleComputeArgs SimpleCompute 1 2  
```



å®é™… OJ ç³»ç»Ÿä¸­ï¼Œå¯¹ç”¨æˆ·è¾“å…¥çš„ä»£ç ä¼šæœ‰ä¸€å®šçš„è¦æ±‚ï¼Œä¾¿äºç³»ç»Ÿç»Ÿä¸€åœ°å¤„ç†ã€‚æ‰€ä»¥æ­¤å¤„ï¼Œæˆ‘ä»¬æŠŠç”¨æˆ·è¾“å…¥ä»£ç çš„ç±»åé™åˆ¶ä¸º Mainï¼ˆå‚è€ƒPojï¼‰ï¼Œå‡å°‘ç±»åä¸ä¸€è‡´çš„é£é™©ï¼Œè€Œä¸”ä¸ç”¨ä»ç”¨æˆ·ä»£ç ä¸­æå–ç±»åï¼Œæ›´æ–¹ä¾¿

ç¤ºä¾‹ Main.javaï¼š

```java
public class Main {
    public static void main(String[] args) {
        int a = Integer.parseInt(args[0]);
        int b = Integer.parseInt(args[1]);
        System.out.println("ç»“æœ:" + (a + b));
    }
}
```

å®é™…æ‰§è¡Œï¼š

```shell
javac -encoding utf-8 .\Main.java
java -cp . Main 1 2
```



#### æ ¸å¿ƒæµç¨‹å®ç°

æ ¸å¿ƒå®ç°æ€è·¯ï¼šç”¨ç¨‹åºä»£æ›¿äººå·¥ï¼Œç”¨ç¨‹åºæ¥æ“ä½œå‘½ä»¤è¡Œï¼Œå»ç¼–è¯‘æ‰§è¡Œä»£ç 

Java è¿›ç¨‹æ‰§è¡Œç®¡ç†ç±»ï¼šProcess

1. æŠŠç”¨æˆ·çš„ä»£ç ä¿å­˜ä¸ºæ–‡ä»¶
2. ç¼–è¯‘ä»£ç ï¼Œå¾—åˆ° class æ–‡ä»¶
3. æ‰§è¡Œä»£ç ï¼Œå¾—åˆ°è¾“å‡ºç»“æœ
4. æ”¶é›†æ•´ç†è¾“å‡ºç»“æœ
5. æ–‡ä»¶æ¸…ç†
6. é”™è¯¯å¤„ç†ï¼Œæå‡ç¨‹åºå¥å£®æ€§



##### 1ï¼‰æŠŠç”¨æˆ·çš„ä»£ç ä¿å­˜ä¸ºæ–‡ä»¶

å¼•å…¥ Hutool å·¥å…·ç±»ï¼š

```xml
<!-- https://hutool.cn/docs/index.html#/-->
<dependency>
    <groupId>cn.hutool</groupId>
    <artifactId>hutool-all</artifactId>
    <version>5.8.8</version>
</dependency>
```

æ–°å»ºç›®å½•ï¼Œæ¯ä¸ªç”¨æˆ·çš„ä»£ç éƒ½å­˜æ”¾åœ¨ç‹¬ç«‹ç›®å½•ä¸‹ï¼Œä¾¿äºç»´æŠ¤ï¼š

```java
List<String> inputList = executeCodeRequest.getInputList();
String code = executeCodeRequest.getCode();
String language = executeCodeRequest.getLanguage();

String userDir = System.getProperty("user.dir");
String globalCodePathName = userDir + File.separator + GLOBAL_CODE_DIR_NAME;
// åˆ¤æ–­å…¨å±€ä»£ç ç›®å½•æ˜¯å¦å­˜åœ¨ï¼Œæ²¡æœ‰åˆ™æ–°å»º
if(!FileUtil.exist(globalCodePathName)){
    FileUtil.mkdir(globalCodePathName);
}

// æŠŠç”¨æˆ·çš„ä»£ç éš”ç¦»å­˜æ”¾
String userCodeParentPath = globalCodePathName + File.separator + UUID.randomUUID();
String userCodePath = userCodeParentPath+File.separator + GLOBAL_JAVA_CLASS_NAME;
File userCodeFile = FileUtil.writeString(code, userCodePath, StandardCharsets.UTF_8);
```



##### 2ï¼‰ç¼–è¯‘ä»£ç ï¼Œå¾—åˆ° class æ–‡ä»¶

Java æ‰§è¡Œç¨‹åºï¼š

```java
String compileCmd = String.format("javac -encoding utf-8 %s", userCodeFile.getAbsolutePath());
Process compileProcess = Runtime.getRuntime().exec(compileCmd);
```

Java è·å–æ§åˆ¶å°çš„è¾“å‡ºï¼Œé€šè¿‡ exitValue åˆ¤æ–­ç¨‹åºæ˜¯å¦æ­£å¸¸è¿”å›ï¼Œä» inputStream å’Œ errorStream è·å–æ§åˆ¶å°è¾“å‡ºï¼š

```java
int exitValue = compileProcess.waitFor();
// æ­£å¸¸é€€å‡º
if (exitValue == 0) {
    System.out.println("ç¼–è¯‘æˆåŠŸ");
    // åˆ†æ‰¹è·å–è¿›ç¨‹çš„è¾“å‡º
    BufferedReader bufferedReader = new BufferedReader(new InputStreamReader(compileProcess.getInputStream()));
    StrBuilder compileOutputStringBuilder = new StrBuilder();
    // é€è¡Œè¯»å–
    String compileOutputLine;
    while ((compileOutputLine = bufferedReader.readLine()) != null) {
        compileOutputStringBuilder.append(compileOutputLine);
    }
    System.out.println(compileOutputStringBuilder);
} else {
    // å¼‚å¸¸é€€å‡º
    System.out.println("ç¼–è¯‘å¤±è´¥ï¼Œé”™è¯¯ç ï¼š" + exitValue);
    // åˆ†æ‰¹è·å–è¿›ç¨‹çš„æ­£å¸¸è¾“å‡º
    BufferedReader bufferedReader = new BufferedReader(new InputStreamReader(compileProcess.getInputStream()));
    StrBuilder compileOutputStringBuilder = new StrBuilder();
    // é€è¡Œè¯»å–
    String compileOutputLine;
    while ((compileOutputLine = bufferedReader.readLine()) != null) {
        compileOutputStringBuilder.append(compileOutputLine);
    }

    // åˆ†æ‰¹è·å–è¿›ç¨‹çš„é”™è¯¯è¾“å‡º
    BufferedReader errorBufferedReader = new BufferedReader(new InputStreamReader(compileProcess.getErrorStream()));
    StrBuilder errorCompileOutputStringBuilder = new StrBuilder();
    // é€è¡Œè¯»å–
    String errorCompileOutputLine;
    while ((errorCompileOutputLine = errorBufferedReader.readLine()) != null) {
        errorCompileOutputStringBuilder.append(errorCompileOutputLine);
    }
    System.out.println(compileOutputStringBuilder);
}

```

ç¼–å†™ä¸€ä¸ªå·¥å…·ç±»ï¼Œæ‰§è¡Œè¿›ç¨‹ï¼Œå¹¶ä¸”è·å–è¾“å‡º

```java
package com.dantalian.ojcodesandbox.utils;

import cn.hutool.core.text.StrBuilder;
import com.dantalian.ojcodesandbox.model.ExecuteMessage;

import java.io.BufferedReader;
import java.io.InputStreamReader;

/**
 * è¿›ç¨‹å·¥å…·ç±»
 */
public class ProcessUtils {

    /**
     * æ‰§è¡Œè¿›ç¨‹å¹¶è·å–ä¿¡æ¯
     * @param process
     * @return
     */
    public static ExecuteMessage runProcessAndGetMessage(Process process, String opName) {
        ExecuteMessage executeMessage = new ExecuteMessage();
        try {
            // ç­‰å¾…ç¨‹åºæ‰§è¡Œï¼Œè·å–é”™è¯¯ç 
            int exitValue = process.waitFor();
            executeMessage.setExitValue(exitValue);
            
            // æ­£å¸¸é€€å‡º
            if (exitValue == 0) {
                System.out.println(opName + "æˆåŠŸ");
                // åˆ†æ‰¹è·å–è¿›ç¨‹çš„è¾“å‡º
                BufferedReader bufferedReader = new BufferedReader(new InputStreamReader(process.getInputStream()));
                StrBuilder compileOutputStringBuilder = new StrBuilder();
                // é€è¡Œè¯»å–
                String compileOutputLine;
                while ((compileOutputLine = bufferedReader.readLine()) != null) {
                    compileOutputStringBuilder.append(compileOutputLine);
                }
                executeMessage.setMessage(compileOutputStringBuilder.toString());
                System.out.println(compileOutputStringBuilder);
            } else {
                // å¼‚å¸¸é€€å‡º
                System.out.println(opName + "å¤±è´¥ï¼Œé”™è¯¯ç ï¼š" + exitValue);
                // åˆ†æ‰¹è·å–è¿›ç¨‹çš„æ­£å¸¸è¾“å‡º
                BufferedReader bufferedReader = new BufferedReader(new InputStreamReader(process.getInputStream()));
                StrBuilder compileOutputStringBuilder = new StrBuilder();
                // é€è¡Œè¯»å–
                String compileOutputLine;
                while ((compileOutputLine = bufferedReader.readLine()) != null) {
                    compileOutputStringBuilder.append(compileOutputLine);
                }

                // åˆ†æ‰¹è·å–è¿›ç¨‹çš„é”™è¯¯è¾“å‡º
                BufferedReader errorBufferedReader = new BufferedReader(new InputStreamReader(process.getErrorStream()));
                StrBuilder errorCompileOutputStringBuilder = new StrBuilder();
                // é€è¡Œè¯»å–
                String errorCompileOutputLine;
                while ((errorCompileOutputLine = errorBufferedReader.readLine()) != null) {
                    errorCompileOutputStringBuilder.append(errorCompileOutputLine);
                }
                executeMessage.setErrorMessage(compileOutputStringBuilder.toString());
                System.out.println(compileOutputStringBuilder);
            }
        } catch (Exception e){
            e.printStackTrace();
        }
        return executeMessage;
    }
}


```



##### 3ï¼‰æ‰§è¡Œä»£ç ï¼Œå¾—åˆ°è¾“å‡ºç»“æœ

å‡ºç°ä¹±ç ï¼ŒåŠ  -Dfile.encoding=UTF-8ï¼š

```shell
java -Dfile.encoding=UTF-8 -cp %s Main %s
```

å¾ˆå¤š OJ éƒ½æ˜¯ ACM æ¨¡å¼ï¼Œéœ€è¦å’Œç”¨æˆ·äº¤äº’çš„æ–¹å¼ï¼Œè®©ç”¨æˆ·ä¸æ–­åœ°è¾“å…¥å†…å®¹å¹¶è·å–è¾“å‡ºï¼Œæ¯”å¦‚ï¼š

```java
import java.io.*;
import java.util.Scanner;

public class Main {
    public static void main(String[] args) throws Exception {
        Scanner cin = new Scanner(System.in);
        int a = cin.nextInt(), b = cin.nextInt();
        System.out.println(a + b);
    }
}
```

å¯¹äºæ­¤ç±»ç¨‹åºï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨OutputStream å‘ç¨‹åºç»ˆç«¯å‘é€ï¼Œå¹¶åŠæ—¶è·å–ç»“æœï¼Œæ³¨æ„æœ€åè¦å…³é—­æµé‡Šæ”¾èµ„æºï¼š

```java
/**
* æ‰§è¡Œäº¤äº’å¼è¿›ç¨‹å¹¶è·å–ä¿¡æ¯
* @param process
* @return
*/
public static ExecuteMessage runInteractProcessAndGetMessage(Process process, String args) {
    ExecuteMessage executeMessage = new ExecuteMessage();
    try {
        // å‘æ§åˆ¶å°è¾“å…¥ç¨‹åº
        OutputStream outputStream = process.getOutputStream();
        OutputStreamWriter outputStreamWriter = new OutputStreamWriter(outputStream);
        String[] s = args.split(" ");
        outputStreamWriter.write(StrUtil.join("\n",s) + "\n");
        // ç›¸å½“äºæŒ‰å›è½¦
        outputStreamWriter.flush();

        // åˆ†æ‰¹è·å–è¿›ç¨‹çš„è¾“å‡º
        InputStream inputStream = process.getInputStream();
        BufferedReader bufferedReader = new BufferedReader(new InputStreamReader(inputStream));
        StrBuilder compileOutputStringBuilder = new StrBuilder();
        // é€è¡Œè¯»å–
        String compileOutputLine;
        while ((compileOutputLine = bufferedReader.readLine()) != null) {
            compileOutputStringBuilder.append(compileOutputLine);
        }
        executeMessage.setMessage(compileOutputStringBuilder.toString());
        // å›æ”¶èµ„æº
        outputStreamWriter.close();
        outputStream.close();
        inputStream.close();
        process.destroy();
    } catch (Exception e){
        e.printStackTrace();
    }
    return executeMessage;
}
```



##### 4ï¼‰æ•´ç†è¾“å‡º

è·å–ç¨‹åºæ‰§è¡Œæ—¶é—´ï¼Œä½¿ç”¨ spring çš„ StopWatch è·å–ä¸€æ®µç¨‹åºçš„æ‰§è¡Œæ—¶é—´ï¼š

```java
StopWatch stopWatch = new StopWatch();
stopWatch.start();
// æ­¤å¤„æ˜¯ä¸€æ®µç¨‹åº
stopWatch.stop();
long lastTaskTimeMillis = stopWatch.getLastTaskTimeMillis();
executeMessage.setTime(lastTaskTimeMillis);
```

æ­¤å¤„æˆ‘ä»¬ä½¿ç”¨æœ€å¤§å€¼æ¥ç»Ÿè®¡æ—¶é—´ï¼š

```java
// å–ç”¨æ—¶æœ€å¤§å€¼ï¼Œä¾¿äºåˆ¤æ–­æ˜¯å¦è¶…æ—¶
long maxTime = 0;
for (ExecuteMessage executeMessage : executeMessageList) {
    // Â·Â·Â·
    Long time = executeMessage.getTime();
    if (time != null) {
        maxTime = Math.max(maxTime, time);
    }
}
```



##### 5ï¼‰æ–‡ä»¶æ¸…ç†

é˜²æ­¢æœåŠ¡å™¨ç©ºé—´ä¸è¶³ï¼š

```java
// 5. æ–‡ä»¶æ¸…ç†
if (userCodeFile.getParentFile() != null) {
    boolean del = FileUtil.del(userCodeParentPath);
    System.out.println("åˆ é™¤" + (del ? "æˆåŠŸ" : "å¤±è´¥"));
}
```



##### 6ï¼‰é”™è¯¯å¤„ç†

å°è£…ä¸€ä¸ªé”™è¯¯å¤„ç†æ–¹æ³•ï¼Œå½“ç¨‹åºæŠ›å‡ºå¼‚å¸¸æ—¶ï¼Œç›´æ¥è¿”å›é”™è¯¯å“åº”ï¼š

```java
/**
* è·å–é”™è¯¯å“åº”
* @param e
* @return
*/
private ExecuteCodeResponse getErrorResponse(Throwable e) {
    ExecuteCodeResponse executeCodeResponse = new ExecuteCodeResponse();
    executeCodeResponse.setMessage(e.getMessage());
    // è¡¨ç¤ºä»£ç æ²™ç®±é”™è¯¯
    executeCodeResponse.setStatus(2);
    executeCodeResponse.setJudgeInfo(new JudgeInfo());
    return executeCodeResponse;
}
```



#### å¼‚å¸¸æƒ…å†µæ¼”ç¤º



åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæ ¸å¿ƒæµç¨‹å·²ç»å®ç°ï¼Œä½†æ˜¯æƒ³è¦ä¸Šçº¿çš„è¯ï¼Œå¹¶ä¸å®‰å…¨

ç”¨æˆ·æäº¤æ¶æ„ä»£ç æ€ä¹ˆåŠ



##### 1ï¼‰æ‰§è¡Œé˜»å¡ï¼Œå ç”¨èµ„æºä¸é‡Šæ”¾

æ—¶é—´ä¸Š

```java
/**
 * æ— é™ç¡çœ ï¼ˆé˜»å¡ç¨‹åºæ‰§è¡Œï¼‰
 */
public class SleepError {
    public static void main(String[] args) throws InterruptedException {
        long ONE_HOUR = 60 * 60 * 1000;
        Thread.sleep(ONE_HOUR);
        System.out.println("ç¡å®Œäº†");
    }
}
```

è¦æŠŠå†™å¥½çš„ä»£ç å¤åˆ¶åˆ° resources ä¸­ï¼Œå¹¶ä¸”è¦æŠŠç±»åæ”¹ä¸º Mainï¼ŒæŠŠåŒ…åå»æ‰



##### 2ï¼‰å ç”¨å†…å­˜ï¼Œä¸é‡Šæ”¾

ç©ºé—´ä¸Š

```java
import java.util.ArrayList;
import java.util.List;

/**
 * æ— é™å ç”¨ç©ºé—´ï¼ˆæµªè´¹ç³»ç»Ÿå†…å­˜ï¼‰
 */
public class Main {
    public static void main(String[] args) throws InterruptedException {
        List<byte[]> bytes = new ArrayList<>();
        while (true) {
            bytes.add(new byte[10000]);
        }
    }
}
```

å®é™…è¿è¡Œä¸­ï¼Œæˆ‘ä»¬ä¼šå‘ç°ï¼Œå†…å­˜å ç”¨åˆ°è¾¾ä¸€å®šç©ºé—´åï¼Œç¨‹åºå°±ä¼šè‡ªåŠ¨æŠ¥é”™ï¼šjava.lang.OutOfMemoryError: Java heap space

è¿™æ˜¯ JVM çš„ä¸€ä¸ªä¿æŠ¤æœºåˆ¶

> JVisualIVM æˆ– JConsole å·¥å…·ï¼Œå¯ä»¥è¿æ¥åˆ° JVM è™šæ‹Ÿæœºä¸Šæ¥å¯è§†åŒ–æŸ¥çœ‹è¿è¡ŒçŠ¶æ€

<img src="C:\Users\xtt\AppData\Roaming\Typora\typora-user-images\image-20240910155612425.png" alt="image-20240910155612425" style="zoom:50%;" />



##### 3ï¼‰è¯»æ–‡ä»¶ï¼Œæ–‡ä»¶ä¿¡æ¯æ³„éœ²

ç›´æ¥é€šè¿‡ç›¸å¯¹è·¯å¾„è·å–æ–‡ä»¶

```java
import java.io.File;
import java.io.IOException;
import java.nio.file.Files;
import java.nio.file.Paths;
import java.util.List;

/**
 * è¯»å–æœåŠ¡å™¨æ–‡ä»¶ï¼ˆæ–‡ä»¶ä¿¡æ¯æ³„éœ²ï¼‰
 */
public class Main {
    public static void main(String[] args) throws InterruptedException, IOException {
        String userDir = System.getProperty("user.dir");
        String filePath = userDir + File.separator + "src/main/resources/application.yml";
        List<String> allLines = Files.readAllLines(Paths.get(filePath));
        System.out.println(String.join("\n", allLines));
    }
}
```



##### 4ï¼‰å†™æ–‡ä»¶ï¼Œè¶Šæƒæ¤å…¥æœ¨é©¬

å‡è®¾æœ‰ä¸€ä¸ªæœ¨é©¬ç¨‹åºï¼šjava -version 2>&1

```java
import java.io.File;
import java.io.IOException;
import java.nio.file.Files;
import java.nio.file.Paths;
import java.util.Arrays;


/**
 * å‘æœåŠ¡å™¨å†™æ–‡ä»¶ï¼ˆæ¤å…¥å±é™©ç¨‹åºï¼‰
 */
public class Main {
    public static void main(String[] args) throws InterruptedException, IOException {
        String userDir = System.getProperty("user.dir");
        String filePath = userDir + File.separator + "src/main/resources/æœ¨é©¬ç¨‹åº.bat";
        String errorProgram = "java -version 2>&1";
        Files.write(Paths.get(filePath), Arrays.asList(errorProgram));
        System.out.println("å†™æœ¨é©¬æˆåŠŸï¼Œä½ å®Œäº†å“ˆå“ˆ");
    }
}
```



##### 5ï¼‰è¿è¡Œå…¶ä»–ç¨‹åº

ç›´æ¥é€šè¿‡ Process æ‰§è¡Œå±é™©ç¨‹åºï¼Œæˆ–è€…ç”µè„‘ä¸Šçš„å…¶ä»–ç¨‹åºï¼š

```java
import java.io.BufferedReader;
import java.io.File;
import java.io.IOException;
import java.io.InputStreamReader;

/**
 * è¿è¡Œå…¶ä»–ç¨‹åºï¼ˆæ¯”å¦‚å±é™©æœ¨é©¬ï¼‰
 */
public class Main {
    public static void main(String[] args) throws InterruptedException, IOException {
        String userDir = System.getProperty("user.dir");
        String filePath = userDir + File.separator + "src/main/resources/æœ¨é©¬ç¨‹åº.bat";
        Process process = Runtime.getRuntime().exec(filePath);
        process.waitFor();
        // åˆ†æ‰¹è·å–è¿›ç¨‹çš„è¾“å‡º
        BufferedReader bufferedReader = new BufferedReader(new InputStreamReader(process.getInputStream()));
        // é€è¡Œè¯»å–
        String compileOutputLine;
        while ((compileOutputLine = bufferedReader.readLine()) != null) {
            System.out.println(compileOutputLine);
        }
        System.out.println("æ‰§è¡Œå¼‚å¸¸ç¨‹åºæˆåŠŸ");
    }
}

```



##### 6ï¼‰æ‰§è¡Œé«˜å±å‘½ä»¤

ç”šè‡³éƒ½ä¸ç”¨å†™æœ¨é©¬æ–‡ä»¶ï¼Œç›´æ¥æ‰§è¡Œç³»ç»Ÿè‡ªå¸¦çš„å±é™©å‘½ä»¤

æ¯”å¦‚åˆ é™¤æœåŠ¡å™¨çš„æ‰€æœ‰æ–‡ä»¶

æ¯”å¦‚æ‰§è¡Œ dirï¼ˆwindowsï¼‰ã€Isï¼ˆlinuxï¼‰è·å–ç³»ç»Ÿä¸Šæ‰€æœ‰çš„æ–‡ä»¶ä¿¡æ¯



#### å¦‚ä½•è§£å†³å¼‚å¸¸æƒ…å†µ

1ï¼‰è¶…æ—¶æ§åˆ¶

2ï¼‰é™åˆ¶ç»™ç”¨æˆ·åˆ†é…çš„èµ„æº

3ï¼‰é™åˆ¶ä»£ç  - é»‘ç™½åå•

4ï¼‰é™åˆ¶ç”¨æˆ·çš„æ“ä½œæƒé™ï¼ˆæ–‡ä»¶ã€ç½‘ç»œã€æ‰§è¡Œï¼‰

5ï¼‰è¿è¡Œç¯å¢ƒéš”ç¦»



##### 1ï¼‰è¶…æ—¶æ§åˆ¶

é€šè¿‡åˆ›å»ºä¸€ä¸ªå®ˆæŠ¤çº¿ç¨‹ï¼Œè¶…æ—¶åè‡ªåŠ¨ä¸­æ–­ process å®ç°ï¼š

```java
// è¶…æ—¶æ§åˆ¶
new Thread(() -> {
    try {
        Thread.sleep(TIME_OUT);
        System.out.println("è¶…æ—¶äº†ï¼Œä¸­æ–­");
        runProcess.destroy();
    } catch (InterruptedException e) {
        throw new RuntimeException(e);
    }
}).start();
```



##### 2ï¼‰é™åˆ¶èµ„æºåˆ†é…

ä¸èƒ½è®©æ¯ä¸ª java è¿›ç¨‹çš„æ‰§è¡Œå ç”¨çš„ JVM æœ€å¤§å †å†…å­˜éƒ½å’Œç³»ç»Ÿçš„ä¸€è‡´ï¼Œå®é™…ä¸Šåº”è¯¥å°ä¸€ç‚¹ï¼Œæ¯”å¦‚ 256MB

åœ¨å¯åŠ¨ java æ—¶ï¼Œå¯ä»¥æŒ‡å®š JVM çš„å‚æ•°ï¼š -Xmx256mï¼ˆæœ€å¤§å †ç©ºé—´å¤§å°ï¼‰ -Xmsï¼ˆåˆå§‹å †ç©ºé—´å¤§å°ï¼‰

```shell
java -Xmx256m
```

æ³¨æ„ -Xmx å‚æ•°ã€JVMçš„å †å†…å­˜é™åˆ¶ï¼Œä¸ç­‰äºç³»ç»Ÿå®é™…å ç”¨çš„æœ€å¤§èµ„æºï¼Œå¯èƒ½ä¼šè¶…å‡ºã€‚

<img src="C:\Users\xtt\AppData\Roaming\Typora\typora-user-images\image-20240910212833527.png" alt="image-20240910212833527" style="zoom:50%;" />

å¦‚æœéœ€è¦æ›´ä¸¥æ ¼çš„å†…å­˜é™åˆ¶ï¼Œè¦åœ¨ç³»ç»Ÿå±‚é¢å»é™åˆ¶ï¼Œè€Œä¸æ˜¯ JVM å±‚é¢çš„é™åˆ¶

å¦‚æœæ—¶ Linux ç³»ç»Ÿï¼Œå¯ä»¥ä½¿ç”¨ cgroup æ¥å®ç°å¯¹æŸä¸ªè¿›ç¨‹çš„ CPUã€å†…å­˜ç­‰èµ„æºçš„åˆ†é…



##### 3ï¼‰é™åˆ¶ä»£ç  - é»‘ç™½åå•

å…ˆå®šä¹‰ä¸€ä¸ªé»‘ç™½åå•ï¼Œæ¯”å¦‚å“ªäº›æ“ä½œæ˜¯ç¦æ­¢çš„ï¼Œå¯ä»¥å°±æ˜¯ä¸€ä¸ªåˆ—è¡¨ï¼š

```java
private static final List<String> blackList = Arrays.asList("Files","exec");
```

HuTool å­—å…¸æ ‘å·¥å…·ç±»ï¼šWordTreeï¼Œå¯ä»¥ç”¨**æ›´å°‘çš„ç©ºé—´**å­˜å‚¨æ›´å¤šçš„æ•æ„Ÿè¯æ±‡ï¼Œå®ç°**æ›´é«˜æ•ˆ**çš„æ•æ„Ÿè¯æŸ¥æ‰¾ï¼š

å­—å…¸æ ‘åŸç†ï¼š

<img src="C:\Users\xtt\AppData\Roaming\Typora\typora-user-images\image-20240910222753503.png" alt="image-20240910222753503" style="zoom: 67%;" />

1ï¼‰å…ˆåˆå§‹åŒ–

```java
private static final WordTree WORD_TREE;

static {
    // åˆå§‹åŒ–å­—å…¸æ ‘
    WORD_TREE = new WordTree();
    WORD_TREE.addWords(blackList);
}
```

2ï¼‰æ ¡éªŒ

```java
// æ ¡éªŒä»£ç ä¸­æ˜¯å¦åŒ…å«é»‘åå•ä¸­çš„å‘½ä»¤
if(WORD_TREE.isMatch(code)){
    System.out.println("åŒ…å«æ•æ„Ÿè¯");
    return null;
}
```

ç¼ºç‚¹ï¼š

1. æ— æ³•éå†æ‰€æœ‰çš„é»‘åå•
2. ä¸åŒçš„ç¼–ç¨‹è¯­è¨€å¯¹åº”çš„é¢†åŸŸã€å…³é”®è¯éƒ½ä¸ä¸€æ ·ï¼Œäººå·¥é™åˆ¶æˆæœ¬å¾ˆå¤§



##### 4ï¼‰é™åˆ¶ç”¨æˆ·çš„æ“ä½œæƒé™

é™åˆ¶ç”¨æˆ·å¯¹æ–‡ä»¶ã€å†…å­˜ã€CPUã€ç½‘ç»œç­‰èµ„æºçš„æ“ä½œå’Œæ—¶é—´

Java å®‰å…¨ç®¡ç†å™¨ï¼ˆSecurity Managerï¼‰æ˜¯ Java æä¾›çš„ä¿æŠ¤ JVMã€Java å®‰å…¨çš„æœºåˆ¶ï¼Œå¯ä»¥å®ç°æ›´ä¸¥æ ¼çš„èµ„æºå’Œæ“ä½œé™åˆ¶

ç¼–å†™å®‰å…¨ç®¡ç†å™¨ï¼Œåªéœ€è¦ç»§æ‰¿ SecurityManagerï¼š

æ‰€æœ‰æƒé™æ”¾å¼€ï¼š

```java
package com.dantalian.ojcodesandbox.security;

import java.security.Permission;

/**
 * é»˜è®¤å®‰å…¨ç®¡ç†å™¨
 */
public class DefaultSecurityManager extends SecurityManager {
    
    // æ£€æŸ¥æ‰€æœ‰çš„æƒé™
    @Override
    public void checkPermission(Permission perm) {
        System.out.println("é»˜è®¤ä¸åšä»»ä½•é™åˆ¶");
        System.out.println(perm);
        // super.checkPermission(perm);
    }
}
```

æ‰€æœ‰æƒé™æ‹’ç»ï¼š

```java
package com.dantalian.ojcodesandbox.security;

import java.security.Permission;

/**
 * é»˜è®¤å®‰å…¨ç®¡ç†å™¨
 */
public class DefaultSecurityManager extends SecurityManager {
    
    // æ£€æŸ¥æ‰€æœ‰çš„æƒé™
    @Override
    public void checkPermission(Permission perm) {
        System.out.println("é»˜è®¤ä¸åšä»»ä½•é™åˆ¶");
        System.out.println(perm);
        // super.checkPermission(perm);
    }
}
```

é™åˆ¶è¯»æƒé™ï¼š

```java
// æ£€æµ‹ç¨‹åºæ˜¯å¦å…è®¸è¯»æ–‡ä»¶
@Override
public void checkRead(String file) {
    if(file.contains("C:\\project\\OJ_System\\oj-code-sandbox")){
        return;
    }
    throw new SecurityException("checkRead æƒé™å¼‚å¸¸ï¼š" + file);
}
```

å®é™…æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬åªéœ€è¦é™åˆ¶å­ç¨‹åºçš„æƒé™å³å¯ï¼Œæ²¡å¿…è¦é™åˆ¶å¼€å‘è€…è‡ªå·±å†™çš„ç¨‹åº

åœ¨è¿è¡Œ java ç¨‹åºæ—¶ï¼ŒæŒ‡å®šå®‰å…¨ç®¡ç†å™¨ï¼š

```shell
java -Xmx4096m -Dfile.encoding=UTF-8 -cp %s;%s -Djava.security.manager=MySecurityManager Main %s
```



##### 5ï¼‰è¿è¡Œç¯å¢ƒéš”ç¦»

ç³»ç»Ÿå±‚é¢ä¸Šï¼ŒæŠŠç”¨æˆ·ç¨‹åºå°è£…åˆ°æ²™ç®±é‡Œå’Œå®¿ä¸»æœºï¼ˆæˆ‘ä»¬çš„ç”µè„‘/æœåŠ¡å™¨ï¼‰éš”ç¦»å¼€

Docker å®¹å™¨æŠ€æœ¯å®ç°ï¼ˆåº•å±‚æ˜¯ç”¨ cgroupã€namespaceç­‰æ–¹å¼å®ç°çš„ï¼‰







## å…­æœŸ

### è®¡åˆ’

1. è®²è§£ Docker çš„æ¦‚å¿µ

2. Docker çš„åŸºæœ¬ç”¨æ³•

   a. å‘½ä»¤è¡Œçš„ç”¨æ³•

   b. Java æ“ä½œ Docker

3. ä½¿ç”¨ Docker å®ç°ä»£ç æ²™ç®±
4. æ€ä¹ˆæå‡ Docker æ²™ç®±çš„å®‰å…¨æ€§



### Docker å®¹å™¨æŠ€æœ¯

ä¸ºä»€ä¹ˆè¦ç”¨ Docker å®¹å™¨æŠ€æœ¯ï¼Ÿä¸ºäº†æå‡ç³»ç»Ÿçš„å®‰å…¨æ€§ï¼ŒæŠŠç¨‹åºå’Œå®¿ä¸»æœºè¿›è¡Œéš”ç¦»ï¼Œä½¿å¾—æŸä¸ªç¨‹åºï¼ˆåº”ç”¨ï¼‰çš„æ‰§è¡Œä¸ä¼šå½±å“åˆ°ç³»ç»Ÿæœ¬èº«

Docker æŠ€æœ¯å¯ä»¥å®ç°ç¨‹åºå’Œå®¿ä¸»æœºçš„éš”ç¦»

ä»€ä¹ˆæ˜¯å®¹å™¨ï¼Ÿ

ç†è§£ä¸ºå¯¹ä¸€ç³»åˆ—åº”ç”¨ç¨‹åºã€æœåŠ¡å’Œç¯å¢ƒçš„å°è£…ï¼Œä»è€ŒæŠŠç¨‹åºè¿è¡Œåœ¨ä¸€ä¸ªéš”ç¦»çš„ã€å¯†é—­çš„ã€éšç§çš„ç©ºé—´å†…ï¼Œå¯¹å¤–æ•´ä½“æä¾›æœåŠ¡

å¯ä»¥æŠŠä¸€ä¸ªå®¹å™¨ç†è§£ä¸ºä¸€ä¸ªæ–°çš„ç”µè„‘ï¼ˆå®šåˆ¶åŒ–çš„æ“ä½œç³»ç»Ÿï¼‰

<img src="C:\Users\xtt\AppData\Roaming\Typora\typora-user-images\image-20240914195554136.png" alt="image-20240914195554136" style="zoom:50%;" />



#### Docker åŸºæœ¬æ¦‚å¿µ

é•œåƒï¼šç”¨æ¥åˆ›å»ºå®¹å™¨çš„å®‰è£…åŒ…ï¼Œå¯ä»¥ç†è§£ä¸ºiç»™ç”µè„‘å®‰è£…æ“ä½œç³»ç»Ÿçš„ç³»ç»Ÿé•œåƒ

å®¹å™¨ï¼šé€šè¿‡é•œåƒæ¥åˆ›å»ºçš„ä¸€å¥—è¿è¡Œç¯å¢ƒï¼Œä¸€ä¸ªå®¹å™¨é‡Œå¯ä»¥è¿è¡Œå¤šä¸ªç¨‹åºï¼Œå¯ä»¥ç†è§£ä¸ºä¸€ä¸ªç”µè„‘ç¤ºå®ä¾‹

Docker fileï¼šåˆ¶ä½œé•œåƒçš„æ–‡ä»¶ï¼Œå¯ä»¥ç†è§£ä¸ºåˆ¶ä½œé•œåƒçš„ä¸€ä¸ªæ¸…å•

<img src="C:\Users\xtt\AppData\Roaming\Typora\typora-user-images\image-20240914195620183.png" alt="image-20240914195620183" style="zoom:50%;" />

é•œåƒä»“åº“ï¼šå­˜æ”¾é•œåƒçš„ä»“åº“ï¼Œç”¨æˆ·å¯ä»¥ä»ä»“åº“ä¸‹è½½ç°æˆçš„é•œåƒï¼Œä¹Ÿå¯ä»¥æŠŠåšå¥½çš„é•œåƒæ”¾åˆ°ä»“åº“é‡Œ

æ¨èä½¿ç”¨ docker å®˜æ–¹çš„é•œåƒä»“åº“ï¼š[Docker Hub Container Image Library](https://hub.docker.com/)



#### Docker å®ç°åŸç†

1ï¼‰Docker è¿è¡Œåœ¨ Linux å†…æ ¸ä¸Š
2ï¼‰CGroups å®ç°äº†å®¹å™¨çš„èµ„æºéš”ç¦»ï¼Œåº•å±‚æ˜¯ Linux Cgroup å‘½ä»¤ï¼Œèƒ½å¤Ÿæ§åˆ¶è¿›ç¨‹ä½¿ç”¨çš„èµ„æº
3ï¼‰Network ç½‘ç»œï¼šå®ç°å®¹å™¨çš„ç½‘ç»œéš”ç¦»ï¼Œdocker å®¹å™¨å†…éƒ¨çš„ç½‘ç»œäº’ä¸å½±å“
4ï¼‰Namespaces å‘½åç©ºé—´ï¼šå¯ä»¥æŠŠè¿›ç¨‹éš”ç¦»åœ¨ä¸åŒçš„å‘½åç©ºé—´ä¸‹ï¼Œæ¯ä¸ªå®¹å™¨ä»–éƒ½å¯ä»¥æœ‰è‡ªå·±çš„å‘½åç©ºé—´ï¼Œä¸åŒçš„å‘½åç©ºé—´ä¸‹çš„è¿›ç¨‹äº’ä¸å½±å“ã€‚
5ï¼‰Storage å­˜å‚¨ç©ºé—´ï¼šå®¹å™¨å†…çš„æ–‡ä»¶æ˜¯ç›¸äº’éš”ç¦»çš„ï¼Œä¹Ÿå¯ä»¥å»ä½¿ç”¨å®¿ä¸»æœºçš„æ–‡ä»¶

<img src="C:\Users\xtt\AppData\Roaming\Typora\typora-user-images\image-20240914195648046.png" alt="image-20240914195648046" style="zoom:50%;" />

> docker composeï¼šæ˜¯ä¸€ç§åŒæ—¶å¯åŠ¨å¤šä¸ªå®¹å™¨çš„é›†ç¾¤æ“ä½œå·¥å…·ï¼ˆå®¹å™¨ç®¡ç†å·¥å…·ï¼‰,ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¼€å‘è€…ä»…åšäº†è§£å³å¯ï¼Œå®é™…ä½¿ç”¨ docker compose æ—¶å»ç™¾åº¦é…ç½®æ–‡ä»¶ã€‚



#### å®‰è£… Docker

ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸å»ºè®®åœ¨ Windows ç³»ç»Ÿä¸Šå®‰è£…

Windows æœ¬èº«å°±è‡ªå¸¦äº†ä¸€ä¸ªè™šæ‹Ÿæœº WSLï¼Œä½†æ˜¯ä¸æ¨èï¼Œä¸å¦‚ä¸€ä¸ªä¸“ä¸šçš„ã€éš”ç¦»çš„è™šæ‹Ÿæœºæ–¹ä¾¿

æ¨èä½¿ç”¨è™šæ‹Ÿæœº VMware Workstation Proï¼Œæ•™ç¨‹ï¼š[ä¿å§†çº§ Linux è¿œç¨‹å¼€å‘æ•™ç¨‹](https://www.bilibili.com/video/BV1h94y1k7Jf/?spm_id_from=333.337.search-card.all.click&vd_source=d23e3e9e8df3fe60e61380b6b2784cdc)

ubuntu ä¸‹è½½åœ°å€ï¼š[Ubuntu Releases](https://releases.ubuntu.com/)ï¼Œä¸‹è½½ Ubuntu 18.04.6 LTS (Bionic Beaver) ç‰ˆæœ¬

> åœ¨è·Ÿè§†é¢‘æ•™ç¨‹æ—¶é‡åˆ°çš„é—®é¢˜åŠè§£å†³æ–¹æ³•ï¼š
>
> 1. åœ¨æœ¬æœº IDEA ä¸­ç›´æ¥æ“ä½œè¿œç¨‹ Linux ç³»ç»Ÿæ—¶ï¼Œæˆ‘ä»¬ä½¿ç”¨ `mvn spring-boot:run` å‘½ä»¤å¯åŠ¨æµ‹è¯•é¡¹ç›®æ—¶ï¼Œ maven ä¾èµ–ä¸‹è½½ç¼“æ…¢
>
>    è§£å†³ï¼šåœ¨ IDEA çš„ Remote Host ä¸­æ“ä½œ ubuntu ç³»ç»Ÿçš„æ–‡ä»¶ï¼Œæ‰“å¼€ /etc/maven/settings.xmlï¼Œè®¾ç½®é•œåƒä¸ºé˜¿é‡Œé•œåƒ
>
>    ```xml
>    <mirror>
>        <id>aliyunmaven</id>
>        <mirrorOf>*</mirrorOf>
>        <name>é˜¿é‡Œäº‘å…¬å…±ä»“åº“</name>
>        <url>https://maven.aliyun.com/repository/public</url>
>    </mirror>
>    ```
>
> 2. åŒæ ·æ˜¯åœ¨æœ¬æœº IDEA ä¸­ç›´æ¥æ“ä½œè¿œç¨‹ Linux ç³»ç»Ÿä½¿ç”¨ `mvn spring-boot:run` å‘½ä»¤å¯åŠ¨æµ‹è¯•é¡¹ç›®æ—¶ï¼Œç»ˆç«¯ä¸­æç¤ºâ€œ BUILD SUCCESS â€ï¼Œä½†æ˜¯é¡¹ç›®å¹¶æœªå¯åŠ¨
>
>    è§£å†³ï¼šé—®é¢˜åœ¨äºæˆ‘ä½¿ç”¨çš„æµ‹è¯•é¡¹ç›®æ˜¯ IDEA è‡ªåŠ¨ç”Ÿæˆçš„ä¸€ä¸ª springboot é¡¹ç›®ï¼Œåœ¨ pom.xml é»˜è®¤çš„ä¸»ç±»é…ç½®ä¸­ skip å±æ€§è®¾ç½®ä¸ºäº† trueï¼Œmaven ä¼šè·³è¿‡å¯¼è‡´æ‰¾ä¸åˆ°ä¸»ç±»ï¼Œåº”æ”¹ä¸º false
>
>    ```xml
>    <configuration>
>        <mainClass>com.dantalian.testwinlinux.TestWinLinuxApplication</mainClass>
>        <skip>false</skip>
>    </configuration>
>    ```
>
> 3. åœ¨ä½¿ç”¨çº¯è¿œç¨‹å¼€å‘æ—¶ï¼Œåˆ›å»º ssh è¿æ¥å IDEA ä¼šä¸º Linux è™šæ‹Ÿæœºå®‰è£… IDEAï¼Œæˆ‘æœ¬æœºä½¿ç”¨çš„æ˜¯ç ´è§£ç‰ˆ IDEAï¼Œå®‰è£…å¥½è¿œç¨‹ IDEA æ‰“å¼€æ—¶å¯èƒ½ä¼šæç¤ºé€‰æ‹©è¯ä¹¦ï¼Œé—®é¢˜å°±åœ¨äºå¦‚ä½•å°†è¿œç¨‹çš„ IDEA ä¹Ÿç ´è§£
>
>    è§£å†³ï¼šç»è¿‡å¤šæ¬¡å°è¯•æ€»ç»“å‡ºäº†è§£å†³æ–¹æ¡ˆï¼Œåœ¨æç¤ºé€‰æ‹©è¯ä¹¦çš„é¡µé¢ç›´æ¥é€€å‡ºï¼Œå…³é—­æ‰€æœ‰çš„ JetBrains è½¯ä»¶ï¼Œè¿è¡Œç ´è§£å·¥å…·ç›®å½•ä¸‹çš„ /Crack/å¸è½½.batï¼Œå®Œæˆåå°† Crack æ–‡ä»¶å¤¹åˆ é™¤ï¼Œå†è§£å‹ Crack.zip é‡æ–°è·å–åˆ°å…¨æ–°çš„ç ´è§£å·¥å…·ï¼Œæ¥ä¸‹æ¥æŒ‰ç…§æµç¨‹è¿›è¡Œè½¯ä»¶çš„ç ´è§£å³å¯
>
> 4. è¿œç¨‹æ‰“å¼€é¡¹ç›®ä¸€ç›´å¡åœ¨ resolving maven dependencies
>
>    è§£å†³ï¼šæ‰“å¼€ IDEA çš„ File > Settings > Build, Execution, Deployment > Build Tools > Maven ï¼Œä¿®æ”¹ maven home path ä¸º /etc/mavenï¼Œä¿®æ”¹ user settings file ä¸º /etc/maven/settings.xmlï¼Œé‡æ–°åŠ è½½ maven



#### Docker å¸¸ç”¨æ“ä½œ - å‘½ä»¤è¡Œ

1ï¼‰æŸ¥çœ‹å‘½ä»¤ç”¨æ³•ï¼š`docker --help`

â€‹      æŸ¥çœ‹å…·ä½“å­å‘½ä»¤çš„ç”¨æ³•ï¼š`docker run --help`

2ï¼‰ä»è¿œç¨‹ä»“åº“æ‹‰å–ç°æˆçš„é•œåƒ

```shell
docker pull [OPTIONS] NAME[:TAG|@DIGEST]
```

ç¤ºä¾‹ï¼š

```shell
docker pull hello-world
```

> æŠ¥é”™ï¼šError response fron daenon: Get "<https://registry-1.docker.io/v2/>" : net/http: request canceled while waiting for connection (client.Tineout exceeded while awaiting headers)
>
> è§£å†³ï¼šå‡ºç°æ­¤é—®é¢˜æ˜¯å› ä¸ºé˜¿é‡Œã€è…¾è®¯ç­‰dockeré•œåƒåœ°å€å…¨ä¸èƒ½ç”¨äº†ï¼Œè®¾ç½®åˆ«çš„é•œåƒåœ°å€ï¼Œåé‡å¯
>
> å‚è€ƒï¼š[VUE Ubuntu Dockerå‘å¸ƒ - å°å®…åšå®¢](http://www.bilibili996.com/Course?id=a04190d6f6d94e6080821a21ed53448d)
>
> [okatu-loli/docker-mirror-list: æ”¶é›†äº†ä¸€äº›å…¬å¼€çš„dockeré•œåƒåœ°å€ï¼Œå®šæ—¶æ›´æ–°](https://github.com/okatu-loli/docker-mirror-list)
>
> ```shell
> sudo tee /etc/docker/daemon.json <<-'EOF'
> {
>   "registry-mirrors": [
>       "https://docker.m.daocloud.io",
>       "https://dockerhub.azk8s.cn",
>       "https://dockerproxy.com",
>       "https://docker.1panel.live",
>       "https://hub.rat.dev/",
>       "https://docker.chenby.cn",
>       "https://docker.m.daocloud.io"
>   ]
> }
> EOF
> sudo systemctl daemon-reload
> sudo systemctl restart docker
> ```

3ï¼‰æ ¹æ®é•œåƒåˆ›å»ºå®¹å™¨å®ä¾‹ï¼š

```shell
docker create [OPTIONS] IMAGE [COMMAND] [ARG...]
```

å¯åŠ¨å®ä¾‹ï¼Œå¾—åˆ°å®¹å™¨å®ä¾‹ containerIdï¼š

```shell
sudo docker create hello-world
```

4ï¼‰æŸ¥çœ‹å®¹å™¨çŠ¶æ€ï¼š

```shell
sudo docker ps -a
```

5ï¼‰å¯åŠ¨å®¹å™¨ï¼š

```shell
docker start [OPTIONS] CONTAINER [CONTAINER...]
```

å¯åŠ¨ç¤ºä¾‹ï¼š

```shell
sudo docker start brave_lichterman
```

6ï¼‰æŸ¥çœ‹æ—¥å¿—ï¼š

```shell
docker logs [OPTIONS] CONTAINER
```

ç¤ºä¾‹ï¼š

```shell
sudo docker logs brave_lichterman
```

7ï¼‰åˆ é™¤å®¹å™¨å®ä¾‹ï¼š

```shell
docker rm [OPTIONS] CONTAINER [CONTAINER...]
```

ç¤ºä¾‹ï¼š

```shell
sudo docker rm brave_lichterman
```

8ï¼‰åˆ é™¤é•œåƒï¼š

```shell
docker rmi [OPTIONS] IMAGE [IMAGE...]
```

ç¤ºä¾‹ï¼š

```shell
sudo docker rmi hello-world
```

9ï¼‰å…¶ä»–ï¼šæ„é€ é•œåƒï¼ˆbuildï¼‰ã€æ¨é€é•œåƒï¼ˆpushï¼‰ã€è¿è¡Œå®¹å™¨ï¼ˆrunï¼‰ã€æ‰§è¡Œå®¹å™¨å‘½ä»¤ï¼ˆexecï¼‰ç­‰



#### Java æ“ä½œ Docker

ä½¿ç”¨ Docker-Javaï¼š[docker-java/docker-java: Java Docker API Client](https://github.com/docker-java/docker-java)

å®˜æ–¹æ–‡æ¡£ï¼š[docker-java/docs/getting_started.md at main Â· docker-java/docker-java](https://github.com/docker-java/docker-java/blob/main/docs/getting_started.md)

å…ˆå¼•å…¥ä¾èµ–ï¼š

```xml
<!-- https://mvnrepository.com/artifact/com.github.docker-java/docker-java -->
<dependency>
    <groupId>com.github.docker-java</groupId>
    <artifactId>docker-java</artifactId>
    <version>3.3.0</version>
</dependency>
<!-- https://mvnrepository.com/artifact/com.github.docker-java/docker-java-transport-httpclient5 -->
<dependency>
    <groupId>com.github.docker-java</groupId>
    <artifactId>docker-java-transport-httpclient5</artifactId>
    <version>3.3.0</version>
</dependency>
```

DockerClientConfig ï¼šç”¨äºå®šä¹‰åˆå§‹åŒ– DockerClient çš„é…ç½®ï¼ˆç±»æ¯” MySQL çš„è¿æ¥ã€çº¿ç¨‹æ•°é…ç½®ï¼‰

DockerHttpClientï¼ˆä¸æ¨èä½¿ç”¨ï¼‰ï¼šç”¨äºå‘ Docker å®ˆæŠ¤è¿›ç¨‹ï¼ˆæ“ä½œ Docker çš„æ¥å£ï¼‰å‘é€è¯·æ±‚çš„å®¢æˆ·ç«¯ï¼Œåº•å±‚å°è£…ï¼Œä½ è¦è‡ªå·±æ„å»ºè¯·æ±‚å‚æ•°ï¼ˆç®€å•åœ°ç†è§£æˆ JDBCï¼‰

DockerClientï¼ˆæ¨èï¼‰ï¼šæ˜¯çœŸæ­£å’Œ Docker å®ˆæŠ¤è¿›ç¨‹äº¤äº’çš„ã€æœ€æ–¹ä¾¿çš„SDKï¼Œé«˜å±‚å°è£…ï¼Œå¯¹DockerHttpClientå†è¿›è¡Œäº†ä¸€å±‚å°è£…ï¼ˆç†è§£æˆ  Mybatisï¼‰ï¼Œæä¾›äº†ç°æˆçš„å¢åˆ æ”¹æŸ¥



#### Linux Docker è¿œç¨‹å¼€å‘

ä½¿ç”¨ IDEA Development å…ˆä¸Šä¼ ä»£ç åˆ° Linuxï¼Œç„¶åä½¿ç”¨ JetBrains è¿œç¨‹å¼€å‘å®Œå…¨è¿æ¥ Linux å®æ—¶å¼€å‘

1ï¼‰æ‹‰å–é•œåƒï¼š

```java
// è·å–é»˜è®¤çš„ Docker Client
DockerClient dockerClient = DockerClientBuilder.getInstance().build();
// æ‹‰å–é•œåƒ
String image = "nginx:latest";
PullImageCmd pullImageCmd = dockerClient.pullImageCmd(image);
PullImageResultCallback pullImageResultCallback = new PullImageResultCallback(){
    @Override
    public void onNext(PullResponseItem item) {
        System.out.println("ä¸‹è½½é•œåƒï¼š" + item.getStatus());
        super.onNext(item);
    }
};
pullImageCmd
    .exec(pullImageResultCallback)
    .awaitCompletion();
System.out.println("ä¸‹è½½å®Œæˆ");
```

> æŠ¥é”™ï¼š java.net.SocketException: æƒé™ä¸å¤Ÿ
>
> è§£å†³ï¼š`sudo usermod -aG docker dantalian` å°†ç”¨æˆ·æ·»åŠ åˆ°dockerç»„ï¼Œé‡å¯è™šæ‹Ÿæœºï¼Œé‡å¯ IDEA

2ï¼‰åˆ›å»ºå®¹å™¨ï¼š

```java
// åˆ›å»ºå®¹å™¨
CreateContainerCmd containerCmd = dockerClient.createContainerCmd(image);
CreateContainerResponse createContainerResponse = containerCmd
    .withCmd("echo", "Hello Docker")
    .exec();
System.out.println(createContainerResponse);
```

3ï¼‰æŸ¥çœ‹å®¹å™¨çŠ¶æ€ï¼š

```java
//æŸ¥çœ‹å®¹å™¨çŠ¶æ€
ListContainersCmd listContainersCmd = dockerClient.listContainersCmd();
List<Container> containerList = listContainersCmd.withShowAll(true).exec();
for (Container container : containerList) {
    System.out.println(container);
}
```

4ï¼‰å¯åŠ¨å®¹å™¨ï¼š

```java
// å¯åŠ¨å®¹å™¨
dockerClient.startContainerCmd(containerId).exec();
```

5ï¼‰æŸ¥çœ‹æ—¥å¿—ï¼š

```java
// æŸ¥çœ‹æ—¥å¿—
LogContainerResultCallback logContainerResultCallback = new LogContainerResultCallback(){
    @Override
    public void onNext(Frame item) {
        System.out.println("æ—¥å¿—ï¼š" + new String(item.getPayload()));
        super.onNext(item);
    }
};
// é˜»å¡ç­‰å¾…æ—¥å¿—è¾“å‡º
dockerClient.logContainerCmd(containerId)
    .withStdErr(true)
    .withStdOut(true)
    .exec(logContainerResultCallback)
    .awaitCompletion();
```

6ï¼‰åˆ é™¤å®¹å™¨ï¼š

```java
// åˆ é™¤å®¹å™¨
dockerClient.removeContainerCmd(containerId).withForce(true).exec();
```

7ï¼‰åˆ é™¤é•œåƒï¼š

```java
// åˆ é™¤é•œåƒ
dockerClient.removeImageCmd(image).exec();
```



### Docker å®ç°ä»£ç æ²™ç®±

å®ç°æµç¨‹ï¼šdocker å¤åˆ¶è¿è¡Œ java ç¨‹åºï¼Œå¹¶ä¸”å¾—åˆ°ç»“æœ

1. æŠŠç”¨æˆ·çš„ä»£ç ä¿å­˜ä¸ºæ–‡ä»¶
2. ç¼–è¯‘ä»£ç ï¼Œå¾—åˆ° class æ–‡ä»¶
3. æŠŠç¼–è¯‘å¥½çš„æ–‡ä»¶ä¸Šä¼ åˆ°å®¹å™¨ç¯å¢ƒå†…
4. åœ¨å®¹å™¨ä¸­æ‰§è¡Œä»£ç ï¼Œå¾—åˆ°è¾“å‡ºç»“æœ
5. æ”¶é›†æ•´ç†è¾“å‡ºç»“æœ
6. æ–‡ä»¶æ¸…ç†
7. é”™è¯¯å¤„ç†ï¼Œæå‡ç¨‹åºå¥å£®æ€§



> æ‰©å±•ï¼šæ¨¡æ¿æ–¹æ³•è®¾è®¡æ¨¡å¼ï¼Œå®šä¹‰åŒä¸€å¥—å®ç°æµç¨‹ï¼Œè®©ä¸åŒçš„å­ç±»å»è´Ÿè´£ä¸åŒæµç¨‹ä¸­çš„å…·ä½“å®ç°ã€‚æ‰§è¡Œæ­¥éª¤ä¸€æ ·ï¼Œæ¯ä¸ªæ­¥éª¤çš„å®ç°æ–¹å¼ä¸ä¸€æ ·ã€‚



#### 3ã€åˆ›å»ºå®¹å™¨ï¼Œä¸Šä¼ ç¼–è¯‘æ–‡ä»¶

è‡ªå®šä¹‰å®¹å™¨çš„ä¸¤ç§æ–¹å¼ï¼š

1ï¼‰åœ¨å·²æœ‰é•œåƒçš„åŸºç¡€ä¸Šå†æ‰©å……ï¼šæ¯”å¦‚æ‹‰å–ç°æˆçš„ Java ç¯å¢ƒï¼ˆåŒ…å« jdkï¼‰ï¼Œå†æŠŠç¼–è¯‘åçš„æ–‡ä»¶å¤åˆ¶åˆ°å®¹å™¨é‡Œã€‚é€‚åˆæ–°é¡¹ç›®è·‘é€šæµç¨‹

2ï¼‰å®Œå…¨è‡ªå®šä¹‰å®¹å™¨ï¼šé€‚åˆæ¯”è¾ƒæˆç†Ÿçš„é¡¹ç›®ï¼Œæ¯”å¦‚å°è£…å¤šä¸ªè¯­è¨€çš„ç¯å¢ƒå’Œå®ç°

æ€è€ƒï¼šæˆ‘ä»¬æ˜¯æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹éƒ½å•ç‹¬åˆ›å»ºä¸€ä¸ªå®¹å™¨ï¼Œæ¯ä¸ªå®¹å™¨åªæ‰§è¡Œä¸€æ¬¡ java å‘½ä»¤ï¼Ÿæ­¤ä¸¾æµªè´¹æ€§èƒ½ï¼Œæ‰€ä»¥è¦åˆ›å»ºä¸€ä¸ª**å¯äº¤äº’**çš„å®¹å™¨ï¼Œèƒ½æ¥æ”¶å¤šæ¬¡è¾“å…¥å¹¶ä¸”è¾“å‡º

åˆ›å»ºå®¹å™¨æ—¶ï¼Œå¯ä»¥æŒ‡å®šæ–‡ä»¶è·¯å¾„ï¼ˆVolumnï¼‰æ˜ å°„ï¼Œä½œç”¨æ˜¯æŠŠæœ¬åœ°çš„æ–‡ä»¶åŒæ­¥åˆ°å®¹å™¨ä¸­ï¼Œå¯ä»¥è®©å®¹å™¨è®¿é—®ã€‚

> ä¹Ÿå¯ä»¥å«å®¹å™¨æŒ‚è½½ç›®å½•

```java
HostConfig hostConfig = new HostConfig();
hostConfig.setBinds(new Bind(userCodeParentPath, new Volume("/app")));
```



#### 4ã€å¯åŠ¨å®¹å™¨ï¼Œæ‰§è¡Œä»£ç 

Docker æ‰§è¡Œå®¹å™¨å‘½ä»¤ï¼ˆæ“ä½œå·²å¯åŠ¨å®¹å™¨ï¼‰

```shell
docker exec [OPTIONS] CONTAINER COMMAND [ARG...]
```

ç¤ºä¾‹æ‰§è¡Œï¼š

```shell
docker exec fervent_hugle java -cp /app Main 1 3
```

æ³¨æ„ï¼Œè¦æŠŠå‘½ä»¤æŒ‰ç…§ç©ºæ ¼æ‹†åˆ†ï¼Œä½œä¸ºä¸€ä¸ªæ•°ç»„ä¼ é€’ï¼Œå¦åˆ™å¯èƒ½ä¼šè¢«è¯†åˆ«ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè€Œä¸æ˜¯å¤šä¸ªå‚æ•°ã€‚

åˆ›å»ºå‘½ä»¤ï¼š

```java
String[] inputArgsArray = inputArgs.split(" ");
String[] cmdArray = ArrayUtil.append(new String[]{"java", "-cp", "/app", "Main", "1", "3"}, inputArgsArray) ;
ExecCreateCmdResponse execCreateCmdResponse = dockerClient.execCreateCmd(containerId)
    .withCmd(cmdArray)
    .withAttachStderr(true)
    .withAttachStdin(true)
    .withAttachStdout(true)
    .exec();
```

æ‰§è¡Œå‘½ä»¤ï¼š

```java
System.out.println("åˆ›å»ºæ‰§è¡Œå‘½ä»¤ï¼š" + execCreateCmdResponse);
String execId = execCreateCmdResponse.getId();
ExecStartResultCallback execStartResultCallback = new ExecStartResultCallback() {
    @Override
    public void onNext(Frame frame) {
        StreamType streamType = frame.getStreamType();
        if(streamType.STDERR.equals(streamType)){
            System.out.println("è¾“å‡ºé”™è¯¯ç»“æœï¼š" + new String(frame.getPayload()));
        }else {
            System.out.println("è¾“å‡ºç»“æœï¼š" + new String(frame.getPayload()));
        }
        super.onNext(frame);
    }
};
try {
    dockerClient.execStartCmd(execId).exec(execStartResultCallback).awaitCompletion();
} catch (InterruptedException e) {
    System.out.println("ç¨‹åºæ‰§è¡Œå¼‚å¸¸ ");
    throw new RuntimeException(e);
}
```

å°½é‡å¤ç”¨ä¹‹å‰çš„ ExecuteMessage æ¨¡å¼ï¼Œå†å¼‚æ­¥æ¥å£ä¸­å¡«å……æ­£å¸¸å’Œå¼‚å¸¸ä¿¡æ¯

è·å–ç¨‹åºæ‰§è¡Œæ—¶é—´ï¼šå’Œ java åŸç”Ÿå®ç°ä¸€æ ·ï¼Œä½¿ç”¨ StopWatch åœ¨æ‰§è¡Œå‰åç»Ÿè®¡æ—¶é—´

è·å–ç¨‹åºå ç”¨å†…å­˜ï¼š

ç¨‹åºå ç”¨çš„å†…å­˜æ¯ä¸ªæ—¶åˆ»éƒ½åœ¨å˜åŒ–ï¼Œæ‰€ä»¥ä¸å¯èƒ½è·å–åˆ°æ‰€æœ‰æ—¶é—´ç‚¹çš„å†…å­˜

æˆ‘ä»¬è¦åšçš„æ˜¯å®šä¹‰ä¸€ä¸ªå‘¨æœŸï¼Œå®šæœŸåœ°è·å–ç¨‹åºçš„å†…å­˜

```java
// è·å–å ç”¨çš„å†…å­˜
final long[] maxMemory = {0L};
StatsCmd statsCmd = dockerClient.statsCmd(containerId);
ResultCallback<Statistics> statisticsResultCallback = statsCmd.exec(new ResultCallback<Statistics>() {
    @Override
    public void onNext(Statistics statistics) {
        System.out.println("å†…å­˜å ç”¨ï¼š" + statistics.getMemoryStats().getUsage());
        maxMemory[0] = Math.max(statistics.getMemoryStats().getUsage(), maxMemory[0]);
    }

    @Override
    public void onStart(Closeable closeable) {

    }

    @Override
    public void onError(Throwable throwable) {

    }

    @Override
    public void onComplete() {

    }

    @Override
    public void close() throws IOException {

    }
});
statsCmd.exec(statisticsResultCallback);
```



#### Docker å®¹å™¨å®‰å…¨æ€§

æ‰§è¡Œå®¹å™¨æ—¶ï¼Œå¯ä»¥å¢åŠ è¶…æ—¶å‚æ•°æ§åˆ¶å€¼ï¼š

```java
dockerClient.execStartCmd(execId)
    .exec(execStartResultCallback)
    .awaitCompletion(TIME_OUT, TimeUnit.MILLISECONDS);
```

ä½†æ˜¯ï¼Œè¿™ç§æ–¹å¼æ— è®ºè¶…æ—¶ä¸å¦ï¼Œéƒ½ä¼šå¾€ä¸‹æ‰§è¡Œï¼Œæ— æ³•åˆ¤æ–­æ˜¯å¦è¶…æ—¶

å¯ä»¥å®šä¹‰ä¸€ä¸ªæ ‡å¿—ï¼Œå¦‚æœç¨‹åºæ‰§è¡Œå®Œæˆï¼ŒæŠŠè¶…æ—¶æ ‡å¿—è®¾ç½®ä¸º falseï¼š

```java
// åˆ¤æ–­æ˜¯å¦è¶…æ—¶
final boolean[] timeout = {true};
String execId = execCreateCmdResponse.getId();
ExecStartResultCallback execStartResultCallback = new ExecStartResultCallback() {

    @Override
    public void onComplete() {
        // å¦‚æœæ‰§è¡Œå®Œæˆï¼Œåˆ™è¡¨ç¤ºä¸è¶…æ—¶
        timeout[0] = false;
        super.onComplete();
    }

    @Override
    public void onNext(Frame frame) {
        StreamType streamType = frame.getStreamType();
        if(streamType.STDERR.equals(streamType)){
            errorMessage[0] = new String(frame.getPayload());
            System.out.println("è¾“å‡ºé”™è¯¯ç»“æœï¼š" + errorMessage[0]);
        }else {
            message[0] = new String(frame.getPayload());
            System.out.println("è¾“å‡ºç»“æœï¼š" + message[0]);
        }
        super.onNext(frame);
    }
};
```



#### å†…å­˜èµ„æº

é€šè¿‡ HostConfig çš„ withMemory ç­‰æ–¹æ³•ï¼Œè®¾ç½®å®¹å™¨çš„æœ€å¤§å†…å­˜å’Œèµ„æºé™åˆ¶ï¼š

```java
// åˆ›å»ºå®¹å™¨
CreateContainerCmd containerCmd = dockerClient.createContainerCmd(image);
HostConfig hostConfig = new HostConfig();
hostConfig.withMemory(100 * 1000 * 1000L);
hostConfig.withMemorySwap(0L);
hostConfig.withCpuCount(1L);
hostConfig.setBinds(new Bind(userCodeParentPath, new Volume("/app")));
CreateContainerResponse createContainerResponse = containerCmd
    .withHostConfig(hostConfig)
    .withAttachStdin(true)
    .withAttachStderr(true)
    .withAttachStdout(true)
    .withTty(true)
    .exec();
```



#### ç½‘ç»œèµ„æº

åˆ›å»ºå®¹å™¨æ—¶ï¼Œè®¾ç½®ç½‘ç»œé…ç½®ä¸ºå…³é—­ï¼š

```java
CreateContainerResponse createContainerResponse = containerCmd
                .withHostConfig(hostConfig)
                .withNetworkDisabled(true)
```



#### æƒé™ç®¡ç†

Docker å®¹å™¨å·²ç»åšäº†ç³»ç»Ÿå±‚é¢çš„éš”ç¦»ï¼Œæ¯”è¾ƒå®‰å…¨ï¼Œä½†ä¸èƒ½ä¿è¯ç»å¯¹å®‰å…¨



1ï¼‰ç»“åˆ Java å®‰å…¨ç®¡ç†å™¨å’Œå…¶ä»–ç­–ç•¥å»ä½¿ç”¨

2ï¼‰é™åˆ¶ç”¨æˆ·ä¸èƒ½å‘ root æ ¹ç›®å½•å†™æ–‡ä»¶ï¼š

```java
CreateContainerResponse createContainerResponse = containerCmd
                .withHostConfig(hostConfig)
                .withNetworkDisabled(true)
                .withReadonlyRootfs(true)
```

3ï¼‰Linux è‡ªå¸¦çš„å®‰å…¨ç®¡ç†æªæ–½ seccompï¼ˆSecurity Compute Modeï¼‰ï¼ŒLinux å†…æ ¸å®‰å…¨æœºåˆ¶



1ï¼‰è¶…æ—¶æ§åˆ¶

2ï¼‰é™åˆ¶ç»™ç”¨æˆ·åˆ†é…çš„èµ„æº

3ï¼‰é™åˆ¶ä»£ç  - é»‘ç™½åå•

4ï¼‰é™åˆ¶ç”¨æˆ·çš„æ“ä½œæƒé™ï¼ˆæ–‡ä»¶ã€ç½‘ç»œã€æ‰§è¡Œï¼‰

5ï¼‰è¿è¡Œç¯å¢ƒéš”ç¦»





## ä¸ƒæœŸ

1ã€æ¨¡æ¿æ–¹æ³•ä¼˜åŒ–ä»£ç æ²™ç®±

2ã€ä»£ç æ²™ç®±æä¾› API

3ã€è·‘é€šå®Œæ•´çš„å•æœºé¡¹ç›®æµç¨‹

* è¡¥å……å‰ç«¯æäº¤åˆ—è¡¨é¡µé¢

4ã€å•æœºé¡¹ç›®æ”¹é€ æˆå¾®æœåŠ¡

5ã€æŠŠé¡¹ç›®çš„æ¨¡å—è°ƒç”¨æ”¹ä¸ºæ¶ˆæ¯é˜Ÿåˆ—çš„è§£è€¦



### æ¨¡æ¿æ–¹æ³•ä¼˜åŒ–ä»£ç æ²™ç®±

æ¨¡æ¿æ–¹æ³•ï¼šå®šä¹‰ä¸€å¥—é€šç”¨çš„æ‰§è¡Œæµç¨‹ï¼Œè®©å­ç±»è´Ÿè´£æ¯ä¸ªæ‰§è¡Œæ­¥éª¤çš„å…·ä½“å®ç°

é€‚ç”¨åœºæ™¯ï¼šé€‚ç”¨äºæœ‰è§„èŒƒçš„æµç¨‹ï¼Œä¸”æ‰§è¡Œæµç¨‹å¯ä»¥å¤ç”¨

ä½œç”¨ï¼šå¤§å¹…èŠ‚çœé‡å¤ä»£ç é‡ï¼Œä¾¿äºé¡¹ç›®æ‰©å±•ã€æ›´å¥½ç»´æŠ¤



#### 1ã€æŠ½è±¡å‡ºå…·ä½“æµç¨‹

å®šä¹‰ä¸€ä¸ªæ¨¡æ¿æ–¹æ³•æŠ½è±¡ç±»

å…ˆå¤åˆ¶å…·ä½“çš„å®ç°ç±»ï¼ŒæŠŠä»£ç ä»å®Œæ•´çš„æ–¹æ³•æŠ½ç¦»æˆä¸€ä¸ªå­å†™æ³•

```java
@Override
public ExecuteCodeResponse executeCode(ExecuteCodeRequest executeCodeRequest) {
    List<String> inputList = executeCodeRequest.getInputList();
    String code = executeCodeRequest.getCode();
    String language = executeCodeRequest.getLanguage();

    // 1. æŠŠç”¨æˆ·çš„ä»£ç ä¿å­˜ä¸ºæ–‡ä»¶
    File userCodeFile = saveCodeToFile(code);

    // 2. ç¼–è¯‘ä»£ç ï¼Œå¾—åˆ° class æ–‡ä»¶
    ExecuteMessage compileFileExecuteMessage = compileFile(userCodeFile);
    System.out.println(compileFileExecuteMessage);

    // 3. æ‰§è¡Œä»£ç ï¼Œå¾—åˆ°è¾“å‡ºç»“æœ
    List<ExecuteMessage> executeMessageList = runFile(userCodeFile, inputList);

    // 4. æ”¶é›†æ•´ç†è¾“å‡ºç»“æœ
    ExecuteCodeResponse outputResponse = getOutputResponse(executeMessageList);

    // 5. æ–‡ä»¶æ¸…ç†
    boolean b = deleteFile(userCodeFile);
    if (!b) {
        log.error("delete file error, userCodeFilePath:{}", userCodeFile.getAbsolutePath());
    }

    return outputResponse;
}
```



#### 2ã€å®šä¹‰å­ç±»çš„å…·ä½“å®ç°

Java åŸç”Ÿä»£ç æ²™ç®±å®ç°ï¼Œç›´æ¥å¤ç”¨æ¨¡æ¿æ–¹æ³•å®šä¹‰å¥½çš„æ–¹æ³•å®ç°ï¼š

```java
/**
 * Java åŸç”Ÿä»£ç æ²™ç®±å®ç°ï¼ˆç›´æ¥å¤ç”¨æ¨¡æ¿æ–¹æ³•ï¼‰
 */
public class JavaNativeCodeSandbox extends JavaCodeSandboxTemplate {

    @Override
    public ExecuteCodeResponse executeCode(ExecuteCodeRequest executeCodeRequest) {
        return super.executeCode(executeCodeRequest);
    }
}
```

Docker ä»£ç æ²™ç®±å®ç°ï¼Œéœ€è¦è‡ªè¡Œé‡å†™ RunFileï¼š

```java
    /**
     * 3. åˆ›å»ºå®¹å™¨ï¼ŒæŠŠæ–‡ä»¶å¤åˆ¶åˆ°å®¹å™¨å†…
     * @param userCodeFile
     * @param inputList
     * @return
     */
    @Override
    public List<ExecuteMessage> runFile(File userCodeFile, List<String> inputList) {
        String userCodeParentPath = userCodeFile.getParentFile().getAbsolutePath();

        // è·å–é»˜è®¤çš„ Docker Client
        DockerClient dockerClient = DockerClientBuilder.getInstance().build();
        // æ‹‰å–é•œåƒ
        String image = "openjdk:8-alpine";
        if (FIRST_INIT) {
            PullImageCmd pullImageCmd = dockerClient.pullImageCmd(image);
            PullImageResultCallback pullImageResultCallback = new PullImageResultCallback() {
                @Override
                public void onNext(PullResponseItem item) {
                    System.out.println("ä¸‹è½½é•œåƒï¼š" + item.getStatus());
                    super.onNext(item);
                }
            };
            try {
                pullImageCmd
                        .exec(pullImageResultCallback)
                        .awaitCompletion();
            } catch (InterruptedException e) {
                System.out.println("æ‹‰å–é•œåƒå¼‚å¸¸");
                throw new RuntimeException(e);
            }
        }
        System.out.println("ä¸‹è½½å®Œæˆ");

        // åˆ›å»ºå®¹å™¨
        CreateContainerCmd containerCmd = dockerClient.createContainerCmd(image);
        HostConfig hostConfig = new HostConfig();
        hostConfig.withMemory(100 * 1000 * 1000L);
        hostConfig.withMemorySwap(0L);
        hostConfig.withCpuCount(1L);
        hostConfig.withSecurityOpts(Arrays.asList("seccomp=å®‰å…¨ç®¡ç†é…ç½®å­—ç¬¦ä¸²"));
        hostConfig.setBinds(new Bind(userCodeParentPath, new Volume("/app")));
        CreateContainerResponse createContainerResponse = containerCmd
                .withHostConfig(hostConfig)
                .withNetworkDisabled(true)
                .withReadonlyRootfs(true)
                .withAttachStdin(true)
                .withAttachStderr(true)
                .withAttachStdout(true)
                .withTty(true)
                .exec();
        System.out.println(createContainerResponse);
        String containerId = createContainerResponse.getId();

        // å¯åŠ¨å®¹å™¨
        dockerClient.startContainerCmd(containerId).exec();

        // docker exec fervent_hugle java -cp /app Main 1 3
        // æ‰§è¡Œå‘½ä»¤å¹¶è·å–ç»“æœ
        List<ExecuteMessage> executeMessageList = new ArrayList<>();
        for (String inputArgs : inputList) {
            StopWatch stopWatch = new StopWatch();
            String[] inputArgsArray = inputArgs.split(" ");
            String[] cmdArray = ArrayUtil.append(new String[]{"java", "-cp", "/app", "Main", "1", "3"}, inputArgsArray) ;
            ExecCreateCmdResponse execCreateCmdResponse = dockerClient.execCreateCmd(containerId)
                    .withCmd(cmdArray)
                    .withAttachStderr(true)
                    .withAttachStdin(true)
                    .withAttachStdout(true)
                    .exec();
            System.out.println("åˆ›å»ºæ‰§è¡Œå‘½ä»¤ï¼š" + execCreateCmdResponse);

            ExecuteMessage executeMessage = new ExecuteMessage();
            final String[] message = {null};
            final String[] errorMessage = {null};
            long time = 0L;
            // åˆ¤æ–­æ˜¯å¦è¶…æ—¶
            final boolean[] timeout = {true};
            String execId = execCreateCmdResponse.getId();
            ExecStartResultCallback execStartResultCallback = new ExecStartResultCallback() {

                @Override
                public void onComplete() {
                    // å¦‚æœæ‰§è¡Œå®Œæˆï¼Œåˆ™è¡¨ç¤ºä¸è¶…æ—¶
                    timeout[0] = false;
                    super.onComplete();
                }

                @Override
                public void onNext(Frame frame) {
                    StreamType streamType = frame.getStreamType();
                    if(streamType.STDERR.equals(streamType)){
                        errorMessage[0] = new String(frame.getPayload());
                        System.out.println("è¾“å‡ºé”™è¯¯ç»“æœï¼š" + errorMessage[0]);
                    }else {
                        message[0] = new String(frame.getPayload());
                        System.out.println("è¾“å‡ºç»“æœï¼š" + message[0]);
                    }
                    super.onNext(frame);
                }
            };

            // è·å–å ç”¨çš„å†…å­˜
            final long[] maxMemory = {0L};
            StatsCmd statsCmd = dockerClient.statsCmd(containerId);
            ResultCallback<Statistics> statisticsResultCallback = statsCmd.exec(new ResultCallback<Statistics>() {
                @Override
                public void onNext(Statistics statistics) {
                    System.out.println("å†…å­˜å ç”¨ï¼š" + statistics.getMemoryStats().getUsage());
                    maxMemory[0] = Math.max(statistics.getMemoryStats().getUsage(), maxMemory[0]);
                }

                @Override
                public void onStart(Closeable closeable) {

                }

                @Override
                public void onError(Throwable throwable) {

                }

                @Override
                public void onComplete() {

                }

                @Override
                public void close() throws IOException {

                }
            });
            statsCmd.exec(statisticsResultCallback);

            try {
                stopWatch.start();
                dockerClient.execStartCmd(execId).exec(execStartResultCallback).awaitCompletion(TIME_OUT, TimeUnit.MILLISECONDS);
                stopWatch.stop();
                time = stopWatch.getLastTaskTimeMillis();
                statsCmd.close();
            } catch (InterruptedException e) {
                System.out.println("ç¨‹åºæ‰§è¡Œå¼‚å¸¸ ");
                throw new RuntimeException(e);
            }
            executeMessage.setMessage(message[0]);
            executeMessage.setErrorMessage(errorMessage[0]);
            executeMessage.setTime(time);
            executeMessage.setMemory(maxMemory[0]);
            executeMessageList.add(executeMessage);
        }
        return executeMessageList;
    }

```



### ç»™ä»£ç æ²™ç®±æä¾›å¼€æ”¾ API

ç›´æ¥åœ¨ controller æš´éœ² CodeSandbox å®šä¹‰çš„æ¥å£ï¼š

```java
/**
     * æ‰§è¡Œä»£ç 
     *
     * @param executeCodeRequest
     * @return
     */
@PostMapping("/executeCode")
ExecuteCodeResponse executeCode(@RequestBody ExecuteCodeRequest executeCodeRequest){
    if(executeCodeRequest == null){
        throw new RuntimeException("è¯·æ±‚å‚æ•°ä¸ºç©º");
    }
    return javaNativeCodeSandbox.executeCode(executeCodeRequest);
}
```



#### è°ƒç”¨å®‰å…¨æ€§

å¦‚æœå°†æœåŠ¡ä¸åšä»»ä½•çš„æƒé™æ ¡éªŒï¼Œç›´æ¥å‘åˆ°å…¬ç½‘ï¼Œæ˜¯ä¸å®‰å…¨çš„



1ï¼‰è°ƒç”¨æ–¹ä¸çº¦å®šæœåŠ¡æ–¹ä¹‹é—´çº¦å®šä¸€ä¸ªå­—ç¬¦ä¸²ï¼ˆæœ€å¥½åŠ å¯†ï¼‰

ä¼˜ç‚¹ï¼šå®ç°æœ€ç®€å•ï¼Œæ¯”è¾ƒé€‚åˆå†…éƒ¨ç³»ç»Ÿä¹‹é—´ç›¸äº’è°ƒç”¨ï¼ˆç›¸å¯¹å¯ä¿¡çš„ç¯å¢ƒå†…éƒ¨è°ƒç”¨ï¼‰

ç¼ºç‚¹ï¼šä¸å¤Ÿçµæ´»ï¼Œå¦‚æœ key æ³„éœ²æˆ–å˜æ›´ï¼Œéœ€è¦é‡å¯ä»£ç 

ä»£ç æ²™ç®±æœåŠ¡ï¼Œå…ˆå®šä¹‰çº¦å®šçš„å­—ç¬¦ä¸²ï¼š

```java
// å®šä¹‰é‰´æƒè¯·æ±‚å¤´å’Œå¯†é’¥    
private static final String AUTH_REQUEST_HEADER = "auth";
private static final String AUTH_REQUEST_SECRET = "secretKey";
```

æ”¹é€ è¯·æ±‚ï¼Œä»è¯·æ±‚å¤´ä¸­è·å–è®¤è¯ä¿¡æ¯ï¼Œå¹¶æ ¡éªŒï¼š

```java
@PostMapping("/executeCode")
ExecuteCodeResponse executeCode(@RequestBody ExecuteCodeRequest executeCodeRequest, HttpServletRequest request, HttpServletResponse response){
    String authHeader = request.getHeader(AUTH_REQUEST_HEADER);
    if (!AUTH_REQUEST_SECRET.equals(authHeader)) {
        response.setStatus(403);
        return null;
    }
    if(executeCodeRequest == null){
        throw new RuntimeException("è¯·æ±‚å‚æ•°ä¸ºç©º");
    }
    return javaNativeCodeSandbox.executeCode(executeCodeRequest);
}
```

è°ƒç”¨æ–¹ï¼Œåœ¨è°ƒç”¨æ—¶å¸¦ä¸Šè¯·æ±‚å¤´ï¼š

```java
@Override
public ExecuteCodeResponse executeCode(ExecuteCodeRequest executeCodeRequest) {
    System.out.println("è¿œç¨‹ä»£ç æ²™ç®±");
    String url = "http://localhost:8090/executeCode";
    String json = JSONUtil.toJsonStr(executeCodeRequest);
    String responseStr = HttpUtil.createPost(url)
        .header(AUTH_REQUEST_HEADER, AUTH_REQUEST_SECRET)
        .body(json)
        .execute()
        .body();
    if (StringUtils.isBlank(responseStr)) {
        throw new BusinessException(ErrorCode.API_REQUEST_ERROR, "executeCode remoteSandbox error, message = " + responseStr);
    }
    return JSONUtil.toBean(responseStr, ExecuteCodeResponse.class);
}
```



2ï¼‰API ç­¾åè®¤è¯ï¼Œç»™å…è®¸è°ƒç”¨çš„äººå‘˜åˆ†é… accessKeyã€secretKeyï¼Œç„¶åæ ¡éªŒè¿™ä¸¤ç»„ key æ˜¯å¦åŒ¹é…

è¯¦ç»†ï¼šAPI å¼€æ”¾å¹³å°é¡¹ç›®



### è·‘é€šæ•´ä¸ªé¡¹ç›®æµç¨‹

1ï¼‰ç§»åŠ¨ questionSubmitController åˆ° questionController

2ï¼‰åç«¯æ”¹äº†æ¥å£åœ°å€ï¼Œå‰ç«¯éœ€è¦é‡æ–°ç”Ÿæˆæ¥å£è°ƒç”¨ä»£ç 

```shell
node node_modules/openapi-typescript-codegen/bin/index.js --input http://localhost:8121/api/v2/api-docs --output ./generated --client axios
```

è¿˜éœ€è¦å°†å‰ç«¯æ‰€æœ‰è°ƒç”¨çš„ QuestionSubmitControllerService æ”¹ä¸º QuestionControllerService

3ï¼‰åç«¯è°ƒè¯•

4ï¼‰å¼€å‘æäº¤åˆ—è¡¨é¡µé¢



### å•æœºé¡¹ç›®æ”¹é€ æˆå¾®æœåŠ¡

æ–°å»ºä¸€ä¸ªé¡¹ç›®



#### ä»€ä¹ˆæ˜¯å¾®æœåŠ¡

æœåŠ¡ï¼šæä¾›æŸç±»åŠŸèƒ½çš„ä»£ç 

å¾®æœåŠ¡ï¼šä¸“æ³¨äºæä¾›æŸç±»ç‰¹å®šåŠŸèƒ½çš„ä»£ç ï¼Œè€Œä¸æ˜¯æŠŠæ‰€æœ‰çš„ä»£ç å…¨éƒ¨æ”¾åˆ°åŒä¸€ä¸ªé¡¹ç›®é‡Œã€‚ä¼šæŠŠæ•´ä¸ªå¤§çš„é¡¹ç›®æŒ‰ç…§ä¸€å®šçš„åŠŸèƒ½ã€é€»è¾‘è¿›è¡Œæ‹†åˆ†ï¼Œæ‹†åˆ†ä¸ºå¤šä¸ªå­æ¨¡å—ï¼Œæ¯ä¸ªå­æ¨¡å—å¯ä»¥ç‹¬ç«‹è¿è¡Œã€ç‹¬ç«‹è´Ÿè´£ä¸€ç±»åŠŸèƒ½ã€å­æ¨¡å—ä¹‹é—´ç›¸äº’è°ƒç”¨ã€äº’ä¸å½±å“



#### å¾®æœåŠ¡å®ç°æŠ€æœ¯

Spring Cloud

Spring Cloud Alibaba

Dubboï¼ˆDubboXï¼‰

RPCï¼ˆGRPCã€TRPCï¼‰

æœ¬è´¨ä¸Šæ˜¯é€šè¿‡ HTTP æˆ–è€…å…¶ä»–çš„ç½‘ç»œåè®®è¿›è¡Œé€šè®¯æ¥å®ç°çš„



å¾®æœåŠ¡çš„å‡ ä¸ªé‡è¦çš„å®ç°å› ç´ ï¼šæœåŠ¡ç®¡ç†ã€æœåŠ¡è°ƒç”¨ã€æœåŠ¡æ‹†åˆ†



#### Spring Cloud Alibaba

å®˜ç½‘ï¼š[Spring Cloud Alibabaå®˜ç½‘](https://sca.aliyun.com/)

æœ¬è´¨ï¼šå®åœ¨ Spring Cloud çš„åŸºç¡€ä¸Šï¼Œè¿›è¡Œäº†è¡¥å¼ºï¼Œè¡¥å……äº†ä¸€äº›é¢å¤–çš„èƒ½åŠ›ï¼Œæ ¹æ®é˜¿é‡Œå¤šå¹´çš„ä¸šåŠ¡æ²‰æ·€åšäº†ä¸€äº›å®šåˆ¶åŒ–çš„å¼€å‘



1. Spring Cloud Gatewayï¼šç½‘å…³
2. Nacosï¼šæœåŠ¡æ³¨å†Œå’Œé…ç½®ä¸­å¿ƒ
3. Sentinelï¼šç†”æ–­é™æµ
4. Seataï¼šåˆ†å¸ƒå¼äº‹åŠ¡
5. RocketMQï¼šæ¶ˆæ¯é˜Ÿåˆ—ï¼Œå‰Šå³°å¡«è°·
6. Dockerï¼šä½¿ç”¨Dockerè¿›è¡Œå®¹å™¨åŒ–éƒ¨ç½²
7. Kubernetesï¼šä½¿ç”¨k8sè¿›è¡Œå®¹å™¨åŒ–éƒ¨ç½²



<img src="C:\Users\xtt\AppData\Roaming\Typora\typora-user-images\image-20240922095518906.png" alt="image-20240922095518906" style="zoom: 80%;" />



æ³¨æ„ï¼Œè¦é€‰æ‹© spring boot å¯¹åº”ç‰ˆæœ¬çš„ spring cloud alibabaï¼š[ç‰ˆæœ¬å‘å¸ƒè¯´æ˜-é˜¿é‡Œäº‘Spring Cloud Alibabaå®˜ç½‘](https://sca.aliyun.com/docs/2021/overview/version-explain/?spm=5176.29160081.0.0.74801d28mXVIgD)

æ­¤å¤„é€‰æ‹© 2021.0.5.0

<img src="C:\Users\xtt\AppData\Roaming\Typora\typora-user-images\image-20240922100531823.png" alt="image-20240922100531823" style="zoom:50%;" />

<img src="C:\Users\xtt\AppData\Roaming\Typora\typora-user-images\image-20240922100551199.png" alt="image-20240922100551199" style="zoom:50%;" />

<img src="C:\Users\xtt\AppData\Roaming\Typora\typora-user-images\image-20240922100806145.png" alt="image-20240922100806145" style="zoom: 33%;" />



#### æ”¹é€ å‰æ€è€ƒ

ä»ä¸šåŠ¡éœ€æ±‚å‡ºå‘ï¼Œæ€è€ƒå•æœºå’Œåˆ†å¸ƒå¼çš„åŒºåˆ«

ç”¨æˆ·ç™»å½•åŠŸèƒ½ï¼šéœ€è¦æ”¹é€ ä¸ºåˆ†å¸ƒå¼ç™»å½•

å…¶ä»–å†…å®¹ï¼š

* æœ‰æ²¡æœ‰ç”¨åˆ°å•æœºçš„é”ï¼Ÿæ”¹é€ ä¸ºåˆ†å¸ƒå¼é”
* æœ‰æ²¡æœ‰ç”¨åˆ°æœ¬åœ°ç¼“å­˜ï¼Ÿæ”¹é€ ä¸ºåˆ†å¸ƒå¼ç¼“å­˜ï¼ˆRedisï¼‰
* éœ€ä¸éœ€è¦ç”¨åˆ°åˆ†å¸ƒå¼äº‹åŠ¡ï¼Ÿæ¯”å¦‚æ“ä½œå¤šä¸ªåº“



#### æ”¹é€ åˆ†å¸ƒå¼ç™»å½•

1ï¼‰å®‰è£…redis.msiï¼š[Releases Â· tporadowski/redis](https://github.com/tporadowski/redis/releases)

2ï¼‰application.yml å¢åŠ  redis é…ç½®

```yml
spring:
# Redis é…ç½®
  redis:
    database: 1
    host: localhost
    port: 6379
    timeout: 5000
```

3ï¼‰pom.xml è¡¥å……ä¾èµ–ï¼š

```xml
<!-- redis -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-data-redis</artifactId>
</dependency>
<dependency>
    <groupId>org.springframework.session</groupId>
    <artifactId>spring-session-data-redis</artifactId>
</dependency>
```

4ï¼‰ä¸»ç±»å–æ¶ˆ Redis è‡ªåŠ¨é…ç½®çš„ç§»é™¤

```java
// å¦‚éœ€å¼€å¯ Redisï¼Œé¡»ç§»é™¤ exclude ä¸­çš„å†…å®¹
@SpringBootApplication(exclude = {RedisAutoConfiguration.class})
```

5ï¼‰application.yml ä¿®æ”¹ session å­˜å‚¨æ–¹å¼ï¼š

```yml
spring.session.store-type: redis
```

6ï¼‰ ä½¿ç”¨ QuickRedis æˆ–è€… redis-cli æŸ¥çœ‹æ˜¯å¦æœ‰ç™»å½•åçš„ä¿¡æ¯

[QuickOfficial - QuickRedis](https://quick123.net/)



#### å¾®æœåŠ¡çš„åˆ’åˆ†

ä»ä¸šåŠ¡å‡ºå‘ï¼Œæƒ³ä¸€ä¸‹å“ªäº›åŠŸèƒ½/èŒè´£æ˜¯ä¸€èµ·çš„

> å…¬å¸è€æ¿ç»™å‘˜å·¥åˆ†å·¥



ä¾èµ–æœåŠ¡ï¼š

* æ³¨å†Œä¸­å¿ƒï¼šNacos
* å¾®æœåŠ¡ç½‘å…³ï¼ˆdanoj-backend-gatewayï¼‰ï¼šGateway èšåˆæ‰€æœ‰çš„æ¥å£ï¼Œç»Ÿä¸€æ¥æ”¶å¤„ç†å‰ç«¯çš„è¯·æ±‚



å…¬å…±æœåŠ¡ï¼š

* common å…¬å…±æ¨¡å—ï¼ˆdanoj-backend-commonï¼‰ï¼šå…¨å±€å¼‚å¸¸å¤„ç†å™¨ã€è¯·æ±‚å“åº”å°è£…ç±»ã€å…¬ç”¨çš„å·¥å…·ç±»ç­‰
* model æ¨¡å‹æ¨¡å—ï¼ˆdanoj-backend-modelï¼‰ï¼šå¾ˆå¤šæœåŠ¡å…¬ç”¨çš„å®ä½“ç±»
* å…¬ç”¨æ¥å£æ¨¡å—ï¼ˆdanoj-backend-service-clientï¼‰ï¼šåªå­˜æ”¾æ¥å£ï¼Œä¸å­˜æ”¾å®ç°ï¼ˆå¤šä¸ªæœåŠ¡ä¹‹é—´è¦å…±äº«ï¼‰



ä¸šåŠ¡åŠŸèƒ½ï¼š

1. é¢˜ç›®æ¨¡å—ï¼ˆdanoj-backend-question-serviceï¼š8102 ç«¯å£ï¼‰
   1. åˆ›å»ºé¢˜ç›®ï¼ˆç®¡ç†å‘˜ï¼‰
   2. åˆ é™¤é¢˜ç›®ï¼ˆç®¡ç†å‘˜ï¼‰
   3. ä¿®æ”¹é¢˜ç›®ï¼ˆç®¡ç†å‘˜ï¼‰
   4. æœç´¢é¢˜ç›®ï¼ˆç”¨æˆ·ï¼‰
   5. åœ¨çº¿åšé¢˜ï¼ˆé¢˜ç›®è¯¦æƒ…é¡µï¼‰
   6. æäº¤é¢˜ç›®ï¼ˆç”¨æˆ·ï¼‰
2. ç”¨æˆ·æ¨¡å—ï¼ˆdanoj-backend-user-serviceï¼š8103 ç«¯å£ï¼‰
   1. æ³¨å†Œ
   2. ç™»å½•
3. åˆ¤é¢˜æ¨¡å—ï¼ˆdanoj-backend-judge-serviceï¼š8104 ç«¯å£ï¼Œè¾ƒé‡çš„æ“ä½œï¼‰
   1. æäº¤åˆ¤é¢˜ï¼ˆç»“æœæ˜¯å¦æ­£ç¡®ä¸é”™è¯¯ï¼‰
   2. é”™è¯¯å¤„ç†ï¼ˆå†…å­˜æº¢å‡ºã€å®‰å…¨æ€§ã€è¶…æ—¶ï¼‰
   3. è‡ªä¸»å®ç° ä»£ç æ²™ç®±ï¼ˆå®‰å…¨æ²™ç®±ï¼‰
   4. å¼€æ”¾æ¥å£ï¼ˆæä¾›ä¸€ä¸ªç‹¬ç«‹çš„æ–°æœåŠ¡ï¼‰

> ä»£ç æ²™ç®±æœåŠ¡æœ¬èº«å°±æ˜¯ç‹¬ç«‹çš„ï¼Œä¸éœ€è¦çº³å…¥ Spring Cloud çš„ç®¡ç†



#### è·¯ç”±åˆ’åˆ†

ç”¨ springboot çš„ context-path ç»Ÿä¸€ä¿®æ”¹å„é¡¹ç›®çš„æ¥å£å‰ç¼€ï¼Œæ¯”å¦‚ï¼š

ç”¨æˆ·æœåŠ¡ï¼š

* /api/user
* /api/user/innerï¼ˆå†…éƒ¨è°ƒç”¨ï¼Œç½‘ç®¡å±‚é¢è¦åšé™åˆ¶ï¼‰

é¢˜ç›®æœåŠ¡ï¼š

* /api/questionï¼ˆä¹ŸåŒ…æ‹¬é¢˜ç›®æäº¤ä¿¡æ¯ï¼‰
* /api/question/innerï¼ˆå†…éƒ¨è°ƒç”¨ï¼Œç½‘ç®¡å±‚é¢è¦åšé™åˆ¶ï¼‰

åˆ¤é¢˜æœåŠ¡ï¼š

* /api/judge
* /api/judge/innerï¼ˆå†…éƒ¨è°ƒç”¨ï¼Œç½‘ç®¡å±‚é¢è¦åšé™åˆ¶ï¼‰

#### Nacos æ³¨å†Œä¸­å¿ƒå¯åŠ¨

<img src="C:\Users\xtt\AppData\Roaming\Typora\typora-user-images\image-20240923102451173.png" alt="image-20240923102451173" style="zoom:50%;" />

[æ¦‚è¿°-é˜¿é‡Œäº‘Spring Cloud Alibabaå®˜ç½‘](https://sca.aliyun.com/docs/2021/user-guide/nacos/overview/)

Nacos æ–‡æ¡£ï¼š[Nacos å¿«é€Ÿå¼€å§‹](https://nacos.io/zh-cn/docs/quick-start.html)

å®˜ç½‘ä¸‹è½½ï¼š[Release 2.2.0 (Dec 14, 2022) Â· alibaba/nacos](https://github.com/alibaba/nacos/releases/tag/2.2.0)

è§£å‹åˆ°è‹±æ–‡ä¸å«æ•°å­—çš„ç›®å½•ï¼Œåœ¨ bin ç›®å½•ä¸‹å¯åŠ¨æœåŠ¡å™¨ï¼š

```shell
startup.cmd -m standalone
```

å…³é—­æœåŠ¡å™¨ï¼š

```shell
shutdown.cmd
```



#### æ–°å»ºå·¥ç¨‹

Spring Cloud æœ‰ç›¸å½“å¤šçš„ä¾èµ–ï¼Œå‚å·®ä¸é½ï¼Œä¸å»ºè®®éšæ„æ‰¾ä¸€å¥—é…ç½®æˆ–è€…è‡ªå·±å†™

å»ºè®®ç”¨è„šæ‰‹æ¶ï¼š[Cloud Native App Initializer](https://start.aliyun.com/)

ç»™é¡¹ç›®å¢åŠ å…¨å±€ä¾èµ–é…ç½®æ–‡ä»¶

åˆ›å»ºå®Œåˆå§‹é¡¹ç›®åï¼Œè¡¥å…… Spring Cloud ä¾èµ–ï¼š

```xml
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-dependencies</artifactId>
    <version>2021.0.5</version>
    <type>pom</type>
    <scope>import</scope>
</dependency>
```

ä¾æ¬¡ä½¿ç”¨ new moudules å’Œ spring boot åˆ›å»ºå„æ¨¡å—

<img src="C:\Users\xtt\AppData\Roaming\Typora\typora-user-images\image-20240923132100499.png" alt="image-20240923132100499" style="zoom:50%;" />

éœ€è¦ç»™å„æ¨¡å—ä¹‹é—´ç»‘å®šå­çˆ¶ä¾èµ–å…³ç³»ï¼š

<img src="C:\Users\xtt\AppData\Roaming\Typora\typora-user-images\image-20240923132112730.png" alt="image-20240923132112730" style="zoom:50%;" />

çˆ¶æ¨¡å—å®šä¹‰ modulesï¼Œå­æ¨¡å—å¼•å…¥ parent è¯­æ³•ï¼Œå¯ä»¥é€šè¿‡çˆ¶æ¨¡å—é…ç½®ï¼Œç»Ÿä¸€é¡¹ç›®çš„å®šä¹‰å’Œç‰ˆæœ¬å·



#### åŒæ­¥ä»£ç å’Œä¾èµ–

1ï¼‰common å…¬å…±æ¨¡å—ï¼ˆdanoj-backend-commonï¼‰ï¼šå…¨å±€å¼‚å¸¸å¤„ç†å™¨ã€è¯·æ±‚å“åº”å°è£…ç±»ã€å…¬ç”¨çš„å·¥å…·ç±»ç­‰

<img src="C:\Users\xtt\AppData\Roaming\Typora\typora-user-images\image-20240924122445129.png" alt="image-20240924122445129" style="zoom:50%;" />

åœ¨å¤–å±‚çš„ pom.xml ä¸­å¼•å…¥å…¬å…±ç±»ï¼š

```xml
<!-- https://mvnrepository.com/artifact/org.apache.commons/commons-lang3 -->
<dependency>
    <groupId>org.apache.commons</groupId>
    <artifactId>commons-lang3</artifactId>
</dependency>
<!-- https://mvnrepository.com/artifact/com.google.code.gson/gson -->
<dependency>
    <groupId>com.google.code.gson</groupId>
    <artifactId>gson</artifactId>
    <version>2.9.1</version>
</dependency>
<!-- https://github.com/alibaba/easyexcel -->
<dependency>
    <groupId>com.alibaba</groupId>
    <artifactId>easyexcel</artifactId>
    <version>3.1.1</version>
</dependency>
<!-- https://hutool.cn/docs/index.html#/-->
<dependency>
    <groupId>cn.hutool</groupId>
    <artifactId>hutool-all</artifactId>
    <version>5.8.8</version>
</dependency>
<!-- https://mvnrepository.com/artifact/org.apache.commons/commons-collections4 -->
<dependency>
    <groupId>org.apache.commons</groupId>
    <artifactId>commons-collections4</artifactId>
    <version>4.4</version>
</dependency>
<!-- https://mvnrepository.com/artifact/com.baomidou/mybatis-plus-boot-starter -->
<dependency>
    <groupId>com.baomidou</groupId>
    <artifactId>mybatis-plus-boot-starter</artifactId>
    <version>3.5.2</version>
</dependency>
```



2ï¼‰model æ¨¡å‹æ¨¡å—ï¼ˆdanoj-backend-modelï¼‰ï¼šå¾ˆå¤šæœåŠ¡å…¬ç”¨çš„å®ä½“ç±»

ç›´æ¥å¤åˆ¶ model åŒ…ï¼Œæ³¨æ„ä»£ç æ²™ç®± model ä¹Ÿè¦å¼•å…¥

<img src="C:\Users\xtt\AppData\Roaming\Typora\typora-user-images\image-20240924122512798.png" alt="image-20240924122512798" style="zoom:50%;" />

éœ€è¦å¼•å…¥ commonï¼š

```xml
<dependency>
    <groupId>com.dantalian</groupId>
    <artifactId>danoj-backend-common</artifactId>
    <version>0.0.1-SNAPSHOT</version>
</dependency>
```



3ï¼‰å…¬ç”¨æ¥å£æ¨¡å—ï¼ˆdanoj-backend-service-clientï¼‰ï¼šåªå­˜æ”¾æ¥å£ï¼Œä¸å­˜æ”¾å®ç°ï¼ˆå¤šä¸ªæœåŠ¡ä¹‹é—´è¦å…±äº«ï¼‰

å…ˆæ¬è¿æ‰€æœ‰çš„ service

<img src="C:\Users\xtt\AppData\Roaming\Typora\typora-user-images\image-20240924174518984.png" alt="image-20240924174518984" style="zoom:50%;" />

éœ€è¦å¼•å…¥ commonã€modelï¼š

```xml
<dependency>
    <groupId>com.dantalian</groupId>
    <artifactId>danoj-backend-common</artifactId>
    <version>0.0.1-SNAPSHOT</version>
</dependency>
<dependency>
    <groupId>com.dantalian</groupId>
    <artifactId>danoj-backend-model</artifactId>
    <version>0.0.1-SNAPSHOT</version>
</dependency>
<dependency>
    <groupId>com.dantalian</groupId>
    <artifactId>danoj-backend-service-client</artifactId>
    <version>0.0.1-SNAPSHOT</version>
</dependency>
```

ç»™æ‰€æœ‰æ¨¡å—éƒ½å¼•å…¥ä¸Šè¿°ä¾èµ–



4ï¼‰å…·ä½“ä¸šåŠ¡æœåŠ¡å®ç°

ä¸»ç±»å¼•å…¥æ³¨è§£

å¼•å…¥ application.yml é…ç½®

<img src="C:\Users\xtt\AppData\Roaming\Typora\typora-user-images\image-20240924180538224.png" alt="image-20240924180538224" style="zoom:50%;" />

<img src="C:\Users\xtt\AppData\Roaming\Typora\typora-user-images\image-20240924180556022.png" alt="image-20240924180556022" style="zoom:50%;" />

<img src="C:\Users\xtt\AppData\Roaming\Typora\typora-user-images\image-20240924180609860.png" alt="image-20240924180609860" style="zoom:50%;" />



#### æœåŠ¡å†…éƒ¨è°ƒç”¨

ç°åœ¨çš„é—®é¢˜æ˜¯ï¼Œé¢˜ç›®æœåŠ¡ä¾èµ–ç”¨æˆ·æœåŠ¡ï¼Œä½†æ˜¯ä»£ç å·²ç»åˆ†åˆ°ä¸åŒçš„åŒ…ï¼Œæ‰¾ä¸åˆ°å¯¹åº”çš„ Bean

å¯ä»¥ä½¿ç”¨ Open Feign ç»„ä»¶å®ç°è·¨æœåŠ¡çš„è¿œç¨‹è°ƒç”¨

Open Feignï¼šHttp è°ƒç”¨å®¢æˆ·ç«¯ï¼Œæä¾›äº†æ›´æ–¹ä¾¿çš„æ–¹å¼æ¥è¿œç¨‹è°ƒç”¨å…¶ä»–æœåŠ¡

Nacos æ³¨å†Œä¸­å¿ƒè·å–æœåŠ¡è°ƒç”¨åœ°å€



1ï¼‰æ¢³ç†æœåŠ¡çš„è°ƒç”¨å…³ç³»ï¼Œç¡®å®šå“ªäº›æœåŠ¡ï¼ˆæ¥å£ï¼‰éœ€è¦ç»™å†…éƒ¨è°ƒç”¨



ç”¨æˆ·æœåŠ¡ï¼šæ²¡æœ‰å…¶ä»–çš„ä¾èµ–

é¢˜ç›®æœåŠ¡ï¼š

* userService.getById(userId)

* userService.getUserVO(user)

* userService.listByIds(userIdSet)

* userService.isAdmin(loginUser)

* userService.getLoginUser(request)

* questionService.getById(questionId)

* judgeService.doJudge(questionSubmitId)


åˆ¤é¢˜æœåŠ¡ï¼š

* 
  questionService.getById(questionId)

* questionSubmitService.getById(questionSubmitId)

* questionSubmitService.updateById(questionSubmitUpdate)




2ï¼‰ç¡®è®¤è¦æä¾›å“ªäº›æœåŠ¡

ç”¨æˆ·æœåŠ¡ï¼šæ²¡æœ‰å…¶ä»–çš„ä¾èµ–

* 
  userService.getById(userId)

* userService.getUserVO(user)

* userService.listByIds(userIdSet)

* userService.isAdmin(loginUser)

* userService.getLoginUser(request)


é¢˜ç›®æœåŠ¡ï¼š

* 
  questionService.getById(questionId)

* questionSubmitService.getById(questionSubmitId)

* questionSubmitService.updateById(questionSubmitUpdate)


åˆ¤é¢˜æœåŠ¡ï¼š

* 
  judgeService.doJudge(questionSubmitId)




3ï¼‰å®ç° client æ¥å£

å¯¹äºç”¨æˆ·æœåŠ¡ï¼Œæœ‰ä¸€äº›ä¸åˆ©äºè¿œç¨‹è°ƒç”¨å‚æ•°ä¼ é€’ï¼Œæˆ–è€…å®ç°èµ·æ¥éå¸¸ç®€å•ï¼ˆå·¥å…·ç±»ï¼‰çš„æ–¹æ³•ï¼Œå¯ä»¥ç›´æ¥ç”¨é»˜è®¤æ–¹æ³•ï¼ˆdefault ä¿®é¥°ï¼‰ï¼Œæ— éœ€è¿œç¨‹è°ƒç”¨ï¼ŒèŠ‚çº¦æ€§èƒ½



å¼€å¯ openfeign çš„æ”¯æŒï¼ŒæŠŠæ¥å£æš´éœ²å‡ºå»ï¼ˆæœåŠ¡æ³¨å†Œåˆ°æ³¨å†Œä¸­å¿ƒä¸Šï¼‰ï¼Œä½œä¸º API ç»™å…¶ä»–æœåŠ¡è°ƒç”¨ï¼ˆå…¶ä»–æœåŠ¡ä»æ³¨å†Œä¸­å¿ƒå¯»æ‰¾ï¼‰



éœ€è¦ä¿®æ”¹æ¯ä¸ªæœåŠ¡æä¾›è€…çš„ server.servlet.context-path å…¨å±€è¯·æ±‚è·¯å¾„ï¼Œå¦‚åˆ¤é¢˜æœåŠ¡ï¼š

```yml
server:
  address: 0.0.0.0
  port: 8104
  servlet:
    context-path: /api/judge
```

æœåŠ¡æä¾›è€…ï¼šç†è§£ä¸ºæ¥å£çš„å®ç°ç±»ï¼Œå®é™…æä¾›æœåŠ¡çš„æ¨¡å—

æœåŠ¡æ¶ˆè´¹è€…ï¼šç†è§£ä¸ºæ¥å£çš„è°ƒç”¨æ–¹ï¼Œéœ€è¦å»æ‰¾åˆ°æœåŠ¡æä¾›è€…ç„¶åè°ƒç”¨



æ³¨æ„äº‹é¡¹ï¼š

1. è¦ç»™æ¥å£çš„æ¯ä¸ªæ–¹æ³•æ‰“ä¸Šè¯·æ±‚æ³¨è§£ï¼Œæ³¨æ„åŒºåˆ† Getã€Post
2. è¦ç»™è¯·æ±‚å‚æ•°æ‰“ä¸Šæ³¨è§£ï¼Œæ¯”å¦‚ RequestParamã€RequestBody
3. FeignClient å®šä¹‰çš„è¯·æ±‚è·¯å¾„ä¸€å®šè¦å’ŒæœåŠ¡æä¾›æ–¹å®é™…çš„è¯·æ±‚è·¯å¾„ä¿æŒä¸€è‡´

ç¤ºä¾‹ä»£ç ï¼š

```java
/**
 * ç”¨æˆ·æœåŠ¡
 *
 * @author <a href="https://github.com/Dantalian624">Dantalian</a>
 * @from <a href="https://github.com/Dantalian624/Dan-OJ">Dan-OJ</a>
 */
@FeignClient(name = "danoj-backend-user-service", path = "/api/user/inner")
public interface UserFeignClient {

    /**
     * æ ¹æ® id è·å–ç”¨æˆ·
     * @param userId
     * @return
     */
    @GetMapping("/get/id")
    User getById(@RequestParam("userId") long userId);

    /**
     * æ ¹æ® id è·å–ç”¨æˆ·åˆ—è¡¨
     * @param idList
     * @return
     */
    @GetMapping("/get/idList")
    List<User> listByIds(@RequestParam("idList") Collection<Long> idList);

    /**
     * è·å–å½“å‰ç™»å½•ç”¨æˆ·
     *
     * @param request
     * @return
     */
    default User getLoginUser(HttpServletRequest request){
        // å…ˆåˆ¤æ–­æ˜¯å¦å·²ç™»å½•
        Object userObj = request.getSession().getAttribute(USER_LOGIN_STATE);
        User currentUser = (User) userObj;
        if (currentUser == null || currentUser.getId() == null) {
            throw new BusinessException(ErrorCode.NOT_LOGIN_ERROR);
        }
        return currentUser;
    }

    /**
     * æ˜¯å¦ä¸ºç®¡ç†å‘˜
     *
     * @param user
     * @return
     */
    default boolean isAdmin(User user){
        return user != null && UserRoleEnum.ADMIN.getValue().equals(user.getUserRole());
    }

    /**
     * è·å–è„±æ•çš„ç”¨æˆ·ä¿¡æ¯
     *
     * @param user
     * @return
     */
    default UserVO getUserVO(User user){
        if (user == null) {
            return null;
        }
        UserVO userVO = new UserVO();
        BeanUtils.copyProperties(user, userVO);
        return userVO;
    }
}
```



4ï¼‰ä¿®æ”¹å„ä¸šåŠ¡æœåŠ¡çš„è°ƒç”¨ä»£ç ä¸º FeignClient 

5ï¼‰ç¼–å†™æœåŠ¡å®ç°ç±»ï¼Œæ³¨æ„è¦å’Œä¹‹å‰å®šä¹‰çš„å®¢æˆ·ç«¯ä¿æŒä¸€è‡´

```java
@RestController
@RequestMapping("/inner")
public class UserInnerController implements UserFeignClient {
    
    @Resource
    private UserService userService;
    
    /**
     * æ ¹æ® id è·å–ç”¨æˆ·
     * @param userId
     * @return
     */
    @Override
    @GetMapping("/get/id")
    public User getById(@RequestParam("userId") long userId){
        return userService.getById(userId);
    }

    /**
     * æ ¹æ® id è·å–ç”¨æˆ·åˆ—è¡¨
     * @param idList
     * @return
     */
    @Override
    @GetMapping("/get/idList")
    public List<User> listByIds(@RequestParam("idList") Collection<Long> idList){
        return userService.listByIds(idList);
    }
}
```

6ï¼‰å¼€å¯ Nacos çš„é…ç½®ï¼Œè®©æœåŠ¡ä¹‹é—´èƒ½å¤Ÿäº’ç›¸å®ç°

æ‰€æœ‰æ¨¡å—å¼•å…¥ nacos ä¾èµ–ï¼Œç„¶åç»™ä¸šåŠ¡æœåŠ¡ï¼ˆåŒ…æ‹¬ç½‘å…³ï¼‰å¢åŠ é…ç½®ï¼š

```xml
<dependency>
    <groupId>com.alibaba.cloud</groupId>
    <artifactId>spring-cloud-starter-alibaba-nacos-discovery</artifactId>
</dependency>
```

```yml
spring:
  cloud:
    nacos:
      discovery:
        server-addr: 127.0.0.1:8848
```

ç»™ä¸šåŠ¡å¯åŠ¨ç±»æ‰“ä¸Šæ³¨è§£ï¼Œå¼€å¯æœåŠ¡å‘ç°ã€æ‰¾åˆ°å¯¹åº”çš„å®¢æˆ·ç«¯ Bean çš„ä½ç½®

```java
@EnableDiscoveryClient
@EnableFeignClients(basePackages = {"com.dantalian.danojbackendserviceclient.service"})
```

å…¨å±€å¼•å…¥è´Ÿè½½å‡è¡¡å™¨ä¾èµ–ï¼š

```xml
<dependency>
    <groupId>org.springframework.cloud</groupId>
    <artifactId>spring-cloud-loadbalancer</artifactId>
    <version>3.1.5</version>
</dependency>
```

7ï¼‰å¯åŠ¨é¡¹ç›®ï¼Œæµ‹è¯•ä¾èµ–èƒ½å¦æ³¨å…¥ï¼Œèƒ½å¦å®Œæˆäº’ç›¸è°ƒç”¨



#### å¾®æœåŠ¡ç½‘å…³

å¾®æœåŠ¡ç½‘å…³ï¼ˆdanoj-backend-gatewayï¼‰ï¼šGateway èšåˆæ‰€æœ‰çš„æ¥å£ï¼Œç»Ÿä¸€æ¥æ”¶å¤„ç†å‰ç«¯çš„è¯·æ±‚

ä¸ºä»€ä¹ˆï¼š

* æ‰€æœ‰çš„æœåŠ¡ç«¯å£ä¸åŒï¼Œå¢å¤§äº†å‰ç«¯è°ƒç”¨æˆæœ¬
* æ‰€æœ‰çš„æœåŠ¡æ˜¯åˆ†æ•£çš„ï¼Œå¯èƒ½éœ€è¦é›†ä¸­è¿›è¡Œç®¡ç†ã€æ“ä½œï¼Œæ¯”å¦‚é›†ä¸­è§£å†³è·¨åŸŸã€é‰´æƒã€æ¥å£æ–‡æ¡£ã€æœåŠ¡çš„è·¯ç”±ã€æ¥å£å®‰å…¨æ€§ã€æµé‡æŸ“è‰²

> Gatewayï¼šæƒ³è‡ªå®šä¹‰ä¸€äº›åŠŸèƒ½ï¼Œéœ€è¦å¯¹è¿™ä¸ªæŠ€æœ¯æœ‰æ¯”è¾ƒæ·±çš„ç†è§£

Gateway æ˜¯åº”ç”¨å±‚ç½‘å…³ï¼šä¼šæœ‰ä¸€å®šçš„ä¸šåŠ¡é€»è¾‘

Nginx æ˜¯æ¥å…¥å±‚ç½‘å…³ï¼šæ¯”å¦‚æ¯ä¸ªè¯·æ±‚çš„æ—¥å¿—ï¼Œé€šå¸¸æ²¡æœ‰ä¸šåŠ¡é€»è¾‘



##### æ¥å£è·¯ç”±

ç»Ÿä¸€åœ°æ¥æ”¶å‰ç«¯çš„è¯·æ±‚ï¼Œè½¬å‘è¯·æ±‚åˆ°å¯¹åº”çš„æœåŠ¡

å¦‚ä½•æ‰¾åˆ°è·¯ç”±ï¼Ÿå¯ä»¥ç¼–å†™ä¸€å¥—è·¯ç”±é…ç½®ï¼Œé€šè¿‡ api åœ°å€å‰ç¼€æ¥æ‰¾åˆ°å¯¹åº”çš„æœåŠ¡

```yml
spring:
  cloud:
    nacos:
      discovery:
        server-addr: 127.0.0.1:8848
    gateway:
      routes:
        - id: danoj-backend-user-service
          uri: lb://danoj-backend-user-service
          predicates:
            - Path=/api/user/**
        - id: danoj-backend-question-service
          uri: lb://danoj-backend-question-service
          predicates:
            - Path=/api/question/**
        - id: danoj-backend-judge-service
          uri: lb://danoj-backend-judge-service
          predicates:
            - Path=/api/judge/**
  application:
    name: danoj-backend-gateway
  main:
    web-application-type: reactive
server:
  port: 8101
```



##### èšåˆæ–‡æ¡£

ä»¥ä¸€ä¸ªå…¨å±€çš„è§†è§’é›†ä¸­æŸ¥çœ‹ç®¡ç†æ¥å£æ–‡æ¡£

ä½¿ç”¨ knife4j æ¥å£æ–‡æ¡£ç”Ÿæˆå™¨ï¼š[Spring Cloud Gatewayç½‘å…³èšåˆ | Knife4j](https://doc.xiaominfo.com/docs/middleware-sources/spring-cloud-gateway/spring-gateway-introduction)

1ï¼‰å…ˆç»™æ‰€æœ‰æœåŠ¡å¼•å…¥ä¾èµ–ï¼ŒåŒæ—¶å¼€å¯æ¥å£æ–‡æ¡£çš„é…ç½®

```xml
<dependency>
    <groupId>com.github.xiaoymin</groupId>
    <artifactId>knife4j-openapi2-spring-boot-starter</artifactId>
    <version>4.3.0</version>
</dependency>
```

```yml
knife4j:
  enable: true
```



2ï¼‰ç»™ç½‘å…³é…ç½®é›†ä¸­ç®¡ç†æ¥å£æ–‡æ¡£ 

```xml
<dependency>
    <groupId>com.github.xiaoymin</groupId>
    <artifactId>knife4j-gateway-spring-boot-starter</artifactId>
    <version>4.3.0</version>
</dependency>
```

```yml
knife4j:
  gateway:
    # â‘  ç¬¬ä¸€ä¸ªé…ç½®ï¼Œå¼€å¯gatewayèšåˆç»„ä»¶
    enabled: true
    # â‘¡ ç¬¬äºŒè¡Œé…ç½®ï¼Œè®¾ç½®èšåˆæ¨¡å¼é‡‡ç”¨discoveræœåŠ¡å‘ç°çš„æ¨¡å¼
    strategy: discover
    discover:
      # â‘¢ ç¬¬ä¸‰è¡Œé…ç½®ï¼Œå¼€å¯discoveræ¨¡å¼
      enabled: true
      # â‘£ ç¬¬å››è¡Œé…ç½®ï¼Œèšåˆå­æœåŠ¡å…¨éƒ¨ä¸ºSwagger2è§„èŒƒçš„æ–‡æ¡£
      version: swagger2
```

3ï¼‰æŸ¥çœ‹èšåˆæ¥å£æ–‡æ¡£ï¼š<http://localhost:8101/doc.html>

å…¨å±€æ·»åŠ  redis ä¾èµ–ï¼š

```xml
<!-- redis -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-data-redis</artifactId>
</dependency>
<dependency>
    <groupId>org.springframework.session</groupId>
    <artifactId>spring-session-data-redis</artifactId>
</dependency>
```

è§£å†³ cookie è·¨è·¯å¾„é—®é¢˜ï¼Œè®¾ç½®ç»Ÿä¸€çš„ session.pathï¼š

```yml
server:
  address: 0.0.0.0
  port: 8104
  servlet:
    context-path: /api/judge
    # cookie 30 å¤©è¿‡æœŸ
    session:
      cookie:
        max-age: 2592000
        path: /api
```



##### è·¨åŸŸè§£å†³

å…¨å±€è§£å†³è·¨åŸŸé…ç½®ï¼š

```java
package com.dantalian.danojbackendgateway.config;

import org.springframework.context.annotation.Bean;
import org.springframework.context.annotation.Configuration;
import org.springframework.web.cors.CorsConfiguration;
import org.springframework.web.cors.reactive.CorsWebFilter;
import org.springframework.web.cors.reactive.UrlBasedCorsConfigurationSource;
import org.springframework.web.util.pattern.PathPatternParser;

import java.util.Arrays;

@Configuration
public class CorsConfig {
    
    @Bean
    public CorsWebFilter corsWebFilter() {
        CorsConfiguration config = new CorsConfiguration();
        config.addAllowedHeader("*");
        config.setAllowCredentials(true);
        config.setAllowedOriginPatterns(Arrays.asList("*"));
        config.addAllowedHeader("*");
        UrlBasedCorsConfigurationSource source = new UrlBasedCorsConfigurationSource(new PathPatternParser());
        source.registerCorsConfiguration("/**", config);
        return new CorsWebFilter(source);
    }
}
```



##### æƒé™æ ¡éªŒ

å¯ä»¥ä½¿ç”¨ Spring Cloud Gateway 

```java
package com.dantalian.danojbackendgateway.filter;

import org.springframework.cloud.gateway.filter.GatewayFilterChain;
import org.springframework.cloud.gateway.filter.GlobalFilter;
import org.springframework.core.Ordered;
import org.springframework.core.io.buffer.DataBuffer;
import org.springframework.core.io.buffer.DataBufferFactory;
import org.springframework.http.HttpStatus;
import org.springframework.http.server.reactive.ServerHttpRequest;
import org.springframework.http.server.reactive.ServerHttpResponse;
import org.springframework.stereotype.Component;
import org.springframework.util.AntPathMatcher;
import org.springframework.web.server.ServerWebExchange;
import reactor.core.publisher.Mono;

import java.nio.charset.StandardCharsets;

@Component
public class GlobalAuthFilter implements GlobalFilter, Ordered {

    private final AntPathMatcher antPathMatcher = new AntPathMatcher();

    @Override
    public Mono<Void> filter(ServerWebExchange exchange, GatewayFilterChain chain) {
        ServerHttpRequest serverHttpRequest = exchange.getRequest();
        String path = serverHttpRequest.getURI().getPath();
        // åˆ¤æ–­è·¯å¾„ä¸­æ˜¯å¦åŒ…å« innerï¼Œåªå…è®¸å†…éƒ¨è°ƒç”¨
        if (antPathMatcher.match("/**/inner/**", path)) {
            ServerHttpResponse response = exchange.getResponse();
            response.setStatusCode(HttpStatus.FORBIDDEN);
            DataBufferFactory dataBufferFactory = response.bufferFactory();
            DataBuffer dataBuffer = dataBufferFactory.wrap("æ— æƒé™".getBytes(StandardCharsets.UTF_8));
            return response.writeWith(Mono.just(dataBuffer));
        }
        // todo ç»Ÿä¸€æƒé™æ ¡éªŒ
        return chain.filter(exchange);
    }

    /**
     * ä¼˜å…ˆçº§æåˆ°æœ€é«˜
     * @return
     */
    @Override
    public int getOrder() {
        return 0;
    }
}
```



> æ‰©å±•ï¼šå¯ä»¥åœ¨ç½‘å…³å®ç° Sentinel æ¥å£é™æµé™çº§ï¼Œå‚è€ƒæ•™ç¨‹ï¼š[æ¦‚è¿°-é˜¿é‡Œäº‘Spring Cloud Alibabaå®˜ç½‘](https://sca.aliyun.com/docs/2021/user-guide/sentinel/overview/)
>
> æ‰©å±•ï¼šå¯ä»¥ä½¿ç”¨ JWT Token å®ç°ç”¨æˆ·ç™»å½•ï¼Œåœ¨ç½‘å…³å±‚é¢é€šè¿‡ token è·å–ç™»å½•ä¿¡æ¯ï¼Œå®ç°é‰´æƒ



Redisson RateLimiter ä¹Ÿå¯ä»¥å®ç°é™æµï¼Œçœ‹æ™ºèƒ½ BI é¡¹ç›®



#### æ€è€ƒ

çœŸçš„æœ‰å¿…è¦ç”¨å¾®æœåŠ¡å—ï¼Ÿ

çœŸçš„æœ‰å¿…è¦ç”¨ Spring Cloud å®ç°å¾®æœåŠ¡å—ï¼Ÿ

ä¼ä¸šå†…éƒ¨ä¸€èˆ¬ä½¿ç”¨ APIï¼ˆRPCã€HTTPï¼‰å®ç°è·¨éƒ¨é—¨ã€è·¨æœåŠ¡çš„è°ƒç”¨ï¼Œæ•°æ®æ ¼å¼å’Œè°ƒç”¨ä»£ç å…¨éƒ¨è‡ªåŠ¨ç”Ÿæˆï¼Œä¿æŒç»Ÿä¸€ï¼ŒåŒæ—¶è§£è€¦



### æ¶ˆæ¯é˜Ÿåˆ—è§£è€¦

æ­¤å¤„é€‰ç”¨æ¶ˆæ¯é˜Ÿåˆ—æ”¹é€ é¡¹ç›®ï¼Œè§£è€¦åˆ¤é¢˜æœåŠ¡å’Œé¢˜ç›®æœåŠ¡ï¼Œé¢˜ç›®æœåŠ¡åªéœ€è¦å‘æ¶ˆæ¯é˜Ÿåˆ—å‘æ¶ˆæ¯ï¼Œåˆ¤é¢˜æœåŠ¡ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­å–æ¶ˆæ¯å»æ‰§è¡Œåˆ¤é¢˜ï¼Œç„¶åå¼‚æ­¥æ›´æ–°æ•°æ®åº“å³å¯

å®‰è£… RabbitMQï¼š[Installing on Windows â€” RabbitMQ](https://v3-12.rabbitmq.com/install-windows.html)

éœ€è¦å…ˆå®‰è£… Erlangï¼š[Otp 25.3.2 - Erlang/OTP](https://www.erlang.org/patches/otp-25.3.2)

æ£€æŸ¥ rabbit æœåŠ¡æ˜¯å¦æ­£å¸¸å¯åŠ¨

å®‰è£… rabbimq ç›‘æ§é¢æ¿ï¼Œåœ¨å®‰è£…ç›®å½•çš„ sbin ç›®å½•ä¸‹è¾“å…¥ï¼š

```shell
rabbitmq-plugins.bat enable rabbitmq_management
```

å®Œæˆåé‡å¯ rabbitmq æœåŠ¡

è®¿é—® [RabbitMQ Management](http://localhost:15672)ï¼Œç”¨æˆ·åå¯†ç éƒ½æ˜¯ guest

![image-20240926174639982](C:\Users\xtt\AppData\Roaming\Typora\typora-user-images\image-20240926174639982.png)

RabbitMQ ç«¯å£å ç”¨ï¼š

5672ï¼šç¨‹åºè¿æ¥çš„ç«¯å£

15672ï¼šwebUI

<img src="C:\Users\xtt\AppData\Roaming\Typora\typora-user-images\image-20240926175123465.png" alt="image-20240926175123465" style="zoom: 50%;" />

å¿«é€Ÿå…¥é—¨ï¼š[RabbitMQ Tutorials â€” RabbitMQ](https://v3-12.rabbitmq.com/getstarted.html)

åˆ¤é¢˜æœåŠ¡å’Œé¢˜ç›®æœåŠ¡å¼•å…¥ä¾èµ–ï¼š

```xml
<!-- https://mvnrepository.com/artifact/org.springframework.boot/spring-boot-starter-amqp -->
<dependency>
    <groupId>org.springframework.boot</groupId>
    <artifactId>spring-boot-starter-amqp</artifactId>
</dependency>
```

æ·»åŠ é…ç½®ï¼š

```yml
spring: 
  rabbitmq:
    host: localhost
    port: 5672
    password: guest
    username: guest
```

ç¼–å†™ç›¸å…³ä»£ç ï¼š

```java
package com.dantalian.danojbackendjudgeservice.rabbitmq;

import com.rabbitmq.client.Channel;
import com.rabbitmq.client.Connection;
import com.rabbitmq.client.ConnectionFactory;
import lombok.extern.slf4j.Slf4j;

@Slf4j
public class InitRabbitMq {

    public static void doInit(){
        try{
            ConnectionFactory factory = new ConnectionFactory();
            factory.setHost("localhost");
            Connection connection = factory.newConnection();
            Channel channel = connection.createChannel();
            String EXCHANGE_NAME = "code_exchange";
            channel.exchangeDeclare(EXCHANGE_NAME, "direct");

            //åˆ›å»ºé˜Ÿåˆ—ï¼Œéšæœºåˆ†é…ä¸€ä¸ªé˜Ÿåˆ—åç§°
            String queueName = "code_queue";
            channel.queueDeclare(queueName, true, false, false, null);
            channel.queueBind(queueName, EXCHANGE_NAME, "my_routingKey");
            log.info("æ¶ˆæ¯é˜Ÿåˆ—å¯åŠ¨æˆåŠŸ");
        }catch (Exception e){
            log.error("æ¶ˆæ¯é˜Ÿåˆ—å¯åŠ¨å¤±è´¥");
        }
    }

    public static void main(String[] args) {
        doInit();
    }
}
```

ç”Ÿäº§è€…ï¼š

```java
package com.dantalian.danojbackendquestionservice.rabbitmq;

import org.springframework.amqp.rabbit.core.RabbitTemplate;
import org.springframework.stereotype.Component;

import javax.annotation.Resource;

@Component
public class MessageProducer {

    @Resource
    private RabbitTemplate rabbitTemplate;

    public void sendMessage(String exchange, String routingKey, String message) {
        rabbitTemplate.convertAndSend(exchange, routingKey, message);
    }
}
```

æ¶ˆè´¹è€…ï¼š

```java
package com.dantalian.danojbackendjudgeservice.rabbitmq;

import com.rabbitmq.client.Channel;
import lombok.SneakyThrows;
import lombok.extern.slf4j.Slf4j;
import org.springframework.amqp.rabbit.annotation.RabbitListener;
import org.springframework.amqp.support.AmqpHeaders;
import org.springframework.messaging.handler.annotation.Header;
import org.springframework.stereotype.Component;

@Component
@Slf4j
public class MessageConsumer {

    // æŒ‡å®šç¨‹åºç›‘å¬çš„æ¶ˆæ¯é˜Ÿåˆ—å’Œç¡®è®¤æœºåˆ¶
    @SneakyThrows
    @RabbitListener(queues = {"code_queue"}, ackMode = "MANUAL")
    public void receiveMessage(String message, Channel channel, @Header(AmqpHeaders.DELIVERY_TAG) long deliveryTag) {
        log.info("Received message: {}", message);
        channel.basicAck(deliveryTag, false);
    }
}
```



è¦ä¼ é€’çš„æ¶ˆæ¯ï¼Ÿ







